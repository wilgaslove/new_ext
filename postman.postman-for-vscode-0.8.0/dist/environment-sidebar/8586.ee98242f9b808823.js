(self.webpackChunkenvironment_sidebar=self.webpackChunkenvironment_sidebar||[]).push([[8586],{4492:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(9730),o=n.n(r);const a=Object.assign({},o(),{DISABLE_ANALYTICS:!1,ANALYTICS_URL:"https://events.getpostman.com/events",IDENTITY_URL:"https://identity.getpostman.com",ARTEMIS_URL:"https://go.postman.co",HTTPS_GATEWAY_PRIVATE_URL:"https://bifrost-extension-https-global.gw.postman.com",WEBSOCKET_GATEWAY_URL:"wss://bifrost-extension-global.gw.postman.com",WEB_URL:"https://www.getpostman.com",DASHBOARD_URL:"https://go.postman.co",EXPLORE_URL:"https://www.postman.com",SENTRY_DSN:"https://0fd0f21b182549f18b0e01ce62f8adb0@o1224273.ingest.sentry.io/4505072910139392",OAUTH2_CALLBACK_URL:"https://oauth.pstmn.io/v1/vscode-callback"})},8586:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ActiveEnvironmentSelector:()=>Mt,ENVIRONMENTS_SIDEBAR_PERMISSIONS_QUERY_KEY_PREFIX:()=>g,ENVIRONMENT_BROADCAST_EVENT_ACTIONS:()=>A,ENVIRONMENT_ITEM_BROADCAST_EVENT_ACTIONS:()=>T,ENVIRONMENT_ITEM_QUERY_KEY_PREFIX:()=>b,ENVIRONMENT_LIST_QUERY_KEY_PREFIX:()=>v,ENVIRONMENT_SELECTOR_PERMISSIONS_QUERY_KEY_PREFIX:()=>E,ENVIRONMENT_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>f,GLOBALS_BROADCAST_EVENT_ACTIONS:()=>x,GLOBALS_ITEM_QUERY_KEY_PREFIX:()=>y,GLOBALS_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>w,SECRET:()=>le,VariablesContextProvider:()=>H,VariablesContextStore:()=>l,WORKSPACE_BROADCAST_EVENT_ACTIONS:()=>R,WORKSPACE_QUERY_KEY_PREFIX:()=>h,environmentItemsQuery:()=>F,environmentVariablesHandler:()=>rn,environmentsSubscriptionHandler:()=>cn,getActiveEnvironment:()=>D,getActiveEnvironmentSession:()=>an,getActiveGlobalsSession:()=>sn,getDuplicateEntityName:()=>ne,getEnvironmentItemQuery:()=>dt,getEnvironmentItemQuerySafe:()=>ut,getEnvironmentSelectorPermissionsQuery:()=>Rt,getEnvironmentSidebarPermissionsQuery:()=>gt,getEnvironmentWorkbenchPermissionsQuery:()=>It,getGlobalsItemQuery:()=>pt,getGlobalsWorkbenchPermissionsQuery:()=>xt,globalVariablesHandler:()=>on,isEnvironmentItemLoading:()=>Lt,resolveVariablesInObject:()=>en,setActiveEnvironment:()=>P,unZipVariables:()=>se,updateEnvironment:()=>tn,updateEnvironmentCacheAndSession:()=>S,updateEnvironmentMutation:()=>Ht,updateEnvironmentNameMutation:()=>Xt,updateEnvironmentWithSessionMutation:()=>Gt,updateGlobals:()=>nn,updateGlobalsCacheAndSession:()=>O,updateGlobalsMutation:()=>Kt,updateGlobalsWithSessionMutation:()=>Yt,useActiveEnvironment:()=>B,useActiveVariables:()=>ue,useCreateNewEnvironment:()=>Y,useCurrentEnvironmentId:()=>he,useEnvironmentDelete:()=>K,useEnvironmentDuplicate:()=>re,useEnvironmentFeatureFlag:()=>Q,useEnvironmentItems:()=>U,useEnvironmentListSubscription:()=>J,useEnvironmentSubscription:()=>oe,useSetAsActiveEnvironment:()=>ee,useUpdateEnvironmentName:()=>ve,zipVariables:()=>ie});var r=n(2932),o=n(747);const a=new o.KVStorage("last-used-active-environment"),i=async e=>await a.get(e)||null,s={queryFn:()=>Promise.reject(),enabled:!1,useErrorBoundary:!1};class l{constructor({collectionFetchOptions:e},t){this.activeEnvironment=null,this.collectionFetchOptions=void 0,this.meta=void 0,this.useActiveEnvironmentFromContext=void 0,this.loadLastUsedActiveEnvironment=()=>{i(this.meta.workspaceId).then((e=>{(0,r.runInAction)((()=>{this.activeEnvironment=e}))})).catch((()=>{}))},this.setActiveEnvironment=e=>{this.activeEnvironment=e,(async(e,t)=>(await a.set(e,t),t))(this.meta.workspaceId,e).catch((()=>{}))},this.meta=t,this.useActiveEnvironmentFromContext=!e,this.collectionFetchOptions=e||s,(0,r.makeObservable)(this,{activeEnvironment:r.observable,setActiveEnvironment:r.action}),this.useActiveEnvironmentFromContext&&this.loadLastUsedActiveEnvironment()}}var c=n(540),d=n.n(c),u=n(4958),p=n(9972),m=n(8079);const v="environments",b="environment",h="workspace",y="globals",g="environment-sidebar-permissions",f="environment-workbench-permissions",w="globals-workbench-permissions",E="environment-selector-permissions",C=new class{constructor(){var e=this;this.observer=null,this.environmentId="",this.abortController=null,this.asyncObserver=null,this.changeEnvironment=e=>{this.environmentId&&this.unsubscribe(),this.environmentId=e},this.subscribe=async function({environmentId:t=e.environmentId,subscriptionHandler:n}){if(""===t)return;if(e.environmentId!==t&&e.changeEnvironment(t),e.observer||e.asyncObserver)return;const{asyncObserver:r,abortController:o}=(e=>{const t=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/environment/${e}/subscribe`,data:{}},subscriptionEvents:["update"],responseFilter:e=>{var t;return null==e||null==(t=e.body)?void 0:t.model_id},broadcastFilter:e=>null==e?void 0:e.model_id,unsubscribeRequest:{method:"delete",service:"sync",url:`/environment/${e}/subscribe`,data:{}}}),abortController:t}})(t);e.abortController=o,e.asyncObserver=r,e.observer=await r,e.abortController=null,(0,u.invalidateCache)([b,t]),e.observer.subscribe({next:e=>{n(e,{environmentId:t})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:n,environmentId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};var k=n(3154),I=n(4492);const _=e=>Object.assign({},e,{id:`${e.owner}-${e.id}`}),S=async(e,t)=>{const n=_(t);(0,u.updateCache)({key:[b,e],updater:e=>e?Object.assign({},e,n):e}),await(0,k.updateDependentSession)({model:"environment",modelId:n.id},n)},O=async(e,t)=>{(0,u.updateCache)({key:[y,e],updater:e=>e?Object.assign({},e,t):e}),await(0,k.updateDependentSession)({model:"globals",modelId:t.id},t)};let x=function(e){return e.UPDATE="update",e}({}),A=function(e){return e.DELETE="delete",e.CREATE="create",e.UPDATE="update",e}({}),T=function(e){return e.UPDATE="update",e}({}),R=function(e){return e.UPDATE="update",e.UPDATE_ROLES="update_roles",e}({});const N=(e,{environmentId:t})=>{var n;const r=null==e||null==(n=e.meta)?void 0:n.action,o=null==e?void 0:e.data;r&&o&&r===T.UPDATE&&S(t,o)},L=new o.KVStorage("active-environment"),D=async e=>L.get(j(e)),P=async(e,t)=>{return L.set(j(e),(n=t,JSON.parse(JSON.stringify(n))));var n},j=({model:e,modelId:t})=>[e,t].join("/"),V=()=>L,F=e=>({queryKey:[v,e],queryFn:({signal:t})=>(async({signal:e,workspaceId:t})=>{const n=await m.postmanGateway.post({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/list/environment`,headers:{"Content-type":"text/plain"},signal:e,query:{workspace:t}});if(!Array.isArray(null==n?void 0:n.data))throw new TypeError("Received invalid response from server");return n.data})({signal:t,workspaceId:e}),select:e=>(Array.isArray(e)&&e.sort(((e,t)=>e.name.localeCompare(t.name))),e),useErrorBoundary:!1}),U=({workspaceId:e})=>(0,u.useDataFetch)(F(e)),B=()=>{const e=(0,p.useActiveWorkspaceId)(),t=(0,c.useContext)(W);if(!t)throw new Error("useActiveEnvironment must be used within a VariablesContextProvider");const[n,a]=(0,c.useState)(t.activeEnvironment);(0,c.useEffect)((()=>{if(t.useActiveEnvironmentFromContext)return(0,r.reaction)((()=>t.activeEnvironment),a)}),[t]);const{data:i}=(0,u.useDataFetch)(t.collectionFetchOptions),s=i?j({model:"collection",modelId:i.id}):"",{value:l}=(0,o.useKVStorage)(V(),s),d=t.useActiveEnvironmentFromContext?n:l,{data:m}=U({workspaceId:e}),v=(null==d?void 0:d.id)&&(null==m?void 0:m.some((({id:e})=>e===d.id)));return v?{data:d}:{data:null}};var M=n(2322);const W=(0,c.createContext)(void 0),$=()=>{const{data:e}=B();return(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e.id,subscriptionHandler:N}),()=>C.unsubscribe()}),[e]),null},H=({store:e,children:t})=>((e=>{const t=(0,p.useActiveWorkspaceId)(),{data:n}=(0,u.useDataFetch)(e.collectionFetchOptions);(0,c.useEffect)((()=>{null!=n&&n.id&&(async e=>L.has(j(e)))({model:"collection",modelId:n.id}).then((e=>{if(!e)return i(t).then((e=>P({model:"collection",modelId:n.id},e)))}))}),[n])})(e),(0,M.jsxs)(W.Provider,{value:e,children:[(0,M.jsx)($,{}),t]}));var G=n(8722),Z=n(6081),q=n(5837);const Q=()=>!0,K=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:({environmentId:e})=>(async e=>{const t=await m.postmanGateway.delete({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`});return await(0,k.deleteDependentSession)({model:"environment",modelId:e}),t})(e),onMutate:async({workspaceId:t,environmentId:n})=>{const r=[v,t];await e.cancelQueries({queryKey:r}),(0,u.updateCache)({key:r,updater:e=>e?e.filter((({id:e})=>e!==n)):e})},onSettled:(e,t,{workspaceId:n})=>{(0,u.invalidateCache)([v,n])}})},Y=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:({workspaceId:e,requestBody:t})=>(async(e,t)=>await m.postmanGateway.post({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/import`,body:JSON.stringify(t),query:{workspace:e}}))(e,t),onMutate:async({workspaceId:t,requestBody:n})=>{const r=[v,t];await e.cancelQueries({queryKey:r}),e.setQueryData(r,(e=>[...null!=e?e:[],{id:window.USER_ID+"-"+n.id,name:n.name,isLoading:!0}]))},onSettled:(e,t,{workspaceId:n})=>{(0,u.invalidateCache)([v,n])},useErrorBoundary:!1})},z=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:n}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:r,abortController:o}=(e=>{const t=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",url:`/list/environment?workspace=${e}&subscribe=true`,service:"sync"},subscriptionEvents:["broadcast"],responseFilter:e=>{var t;return null==e||null==(t=e.body)||null==(t=t.subscription)?void 0:t.id},broadcastFilter:e=>{var t;return null==e||null==(t=e.data)||null==(t=t.subscription)?void 0:t.id},unsubscribeRequest:{data:{},method:"delete",url:`/list/environment/subscribe?workspace=${e}`,service:"sync"}}),abortController:t}})(t);e.abortController=o,e.asyncObserver=r,e.observer=await r,e.abortController=null,(0,u.invalidateCache)([v,t]),e.observer.subscribe({next:e=>{n(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(r){e.cleanup(),await e.subscribe({subscriptionHandler:n,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},X=(e,{workspaceId:t})=>{var n;const r=null==e||null==(n=e.data)?void 0:n.data;if(!Array.isArray(r))return;const o=[],a=[],i=[];for(const e of r)switch(e.action){case A.CREATE:a.push(e.id);break;case A.DELETE:o.push(e.id);break;case A.UPDATE:i.push(e.id)}a.length>0||i.length>0?(0,u.invalidateCache)([v,t]):o.length>0&&((e,t)=>{0!==e.length&&(0,u.updateCache)({key:[v,t],updater:t=>Array.isArray(t)?t.filter((t=>!e.includes(t.id))):t})})(o,t)},J=e=>{(0,c.useEffect)((()=>{if(e)return z.subscribe({workspaceId:e,subscriptionHandler:X}),()=>{z.unsubscribe()}}),[e])},ee=()=>{const e=(0,c.useContext)(W);if(!e)throw new Error("useSetAsActiveEnvironment must be used within a VariablesProvider");const{data:t}=(0,u.useDataFetch)(e.collectionFetchOptions),n=t?j({model:"collection",modelId:t.id}):"",{setValue:r}=(0,o.useKVStorage)(V(),n);return{mutate:t=>{e.setActiveEnvironment(t),!e.useActiveEnvironmentFromContext&&n&&r(t)}}},te=e=>{const t=e.split(" "),n=t.length,r=t[n-1],o=Number.parseInt(r);return n>=2&&"Copy"===r?e+" 2":n>=3&&"Copy"===t[n-2]&&!Number.isNaN(o)?(t[n-1]=`${o+1}`,t.join(" ")):e+" Copy"},ne=(e,t="")=>{const n=new Set(e);let r=t;for(;n.has(r);)r=te(r);return r},re=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:e=>(async({environmentId:e,workspaceId:t})=>await m.postmanGateway.post({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}/duplicate`,query:{workspace:t},data:{}}))(e),onMutate:async({workspaceId:t,environmentId:n})=>{const r=[v,t];await e.cancelQueries({queryKey:r});const o=e.getQueryData(r);if(!o)return;const{name:a}=o.find((({id:e})=>e===n));(0,u.updateCache)({key:r,updater:e=>e?[...e,{id:window.USER_ID+"-"+n,name:ne([a],a),isLoading:!0}]:e})},onSettled:(e,t,{workspaceId:n})=>{(0,u.invalidateCache)([v,n])}})},oe=(e="")=>{(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e,subscriptionHandler:N}),()=>{C.unsubscribe()}}),[e])},ae=(e,t=new Set)=>n=>{var r;const o=e.findIndex(((e,r)=>e.key===n.key&&e.enabled===n.enabled&&!t.has(r)));let a;return-1===o?a={value:n.value}:(t.add(o),a=e[o]),{key:n.key,value:n.value,sessionValue:a.value,isSessionValueDeleted:null==(r=a)?void 0:r.deleted,enabled:n.enabled,type:n.type}},ie=(e,t)=>e.map(ae(t)),se=e=>e.reduce((({initialValues:e,sessionValues:t},n)=>{const{key:r,value:o,sessionValue:a,enabled:i,type:s,isSessionValueDeleted:l}=n;return t.push({key:r,value:a,enabled:i,type:s,deleted:!!l||void 0}),e.push({key:r,value:o,enabled:i,type:s}),{initialValues:e,sessionValues:t}}),{initialValues:[],sessionValues:[]}),le="secret",ce={queryKey:["empty-collection"],queryFn:()=>Promise.reject(),enabled:!1},de=(e,t,n=ae(t))=>t=>t.map((t=>Object.assign({},n(t),{scope:e}))),ue=()=>{const{data:e}=(()=>{var e;const t=(0,p.useActiveWorkspaceId)(),{collectionFetchOptions:n}=null!=(e=(0,c.useContext)(W))?e:{collectionFetchOptions:ce},{data:r}=(0,u.useDataFetch)(pt(t)),{data:o}=(0,u.useDataFetch)(n),{data:a}=B(),{data:i}=(0,u.useDataFetch)(ut(null==a?void 0:a.id)),s=(0,k.useSessionSafe)({model:"environment",modelId:null==i?void 0:i.id}),l=(0,k.useSessionSafe)({model:"globals",modelId:null==r?void 0:r.id}),d=(0,k.useSessionSafe)({model:"collection",modelId:null==o?void 0:o.id});return(0,c.useMemo)((()=>{var e,t,n,a,c,u,p,m,v;return{data:[...de("globals",null!=(e=null==(t=l.value)?void 0:t.values)?e:[])(null!=(n=null==r?void 0:r.values)?n:[]),...de("collection",null!=(a=null==(c=d.value)?void 0:c.values)?a:[])(null!=(u=null==o?void 0:o.variables)?u:[]),...de("environment",null!=(p=null==(m=s.value)?void 0:m.values)?p:[])(null!=(v=null==i?void 0:i.values)?v:[])].map(((e,t)=>Object.assign({},e,{id:`${e.scope}::${t}`})))}}),[o,d.value,i,s.value,r,l.value])})();return(0,c.useMemo)((()=>{if(!e)return{};const t=e.filter((e=>{return"boolean"!=typeof(t=e).enabled||t.enabled;var t})),n=(e=>{const t=new Map(e.map((e=>[e.key,e])));return e=>{const n=t.get(e.key);return n&&n.id!==e.id?Object.assign({},e,{overriddenBy:{id:n.id,scope:n.scope}}):e}})(t);return{data:t.map((e=>n(e)))}}),[e])},pe=async({environmentId:e,name:t})=>await m.postmanGateway.put({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,data:{name:t}}),me=(e,t,n)=>{(0,u.updateCache)({key:e,updater:e=>e?e.map((e=>e.id===t?Object.assign({},e,{name:n}):e)):e})},ve=()=>{const e=(0,u.useCacheClient)();return(0,u.useMutation)({mutationFn:e=>pe(e),onMutate:async({workspaceId:t,environmentId:n,name:r})=>{const o=[v,t],a=e.getQueryData(o);if(!a)return;const i=a.find((({id:e})=>e===n));return me(o,n,r),()=>{i&&me(o,n,i.name)}},onSuccess:(e,{workspaceId:t,environmentId:n})=>{me([v,t],n,e.data.name)},onError:(e,t,n)=>{n&&n()}})};var be=n(607);const he=()=>{const{pathname:e}=(0,be.useLocation)(),{environmentId:t}=(0,be.useParams)();return t||(null!=e&&e.endsWith("/globals")?"globals":void 0)};var ye=n(5892),ge=n.n(ye),fe=n(4047),we=n(2229),Ee=n.n(we),Ce=n(9721),ke=n(5577),Ie=["click","mouseenter","focus","focusin"],_e=ge()(Ce.ZP).withConfig({displayName:"Popover__StyledPopover",componentId:"xu341w-0"})(["& .tippy-content{min-width:120px;z-index:1000;background-color:",";border-radius:",";padding:",";box-shadow:",";font-family:",";font-size:",";line-height:",";font-weight:",";}& .tippy-svg-arrow > svg{filter:",";}& .tippy-svg-arrow > svg > path{fill:",";}"],(function(e){return e.theme["popover-background-color"]}),(function(e){return e.theme["border-radius-default"]}),(function(e){return e.theme[e.padding]}),(function(e){return e.theme["popover-box-shadow"]}),(function(e){return e.theme["text-family-default"]}),(function(e){return e.theme["text-size-m"]}),(function(e){return e.theme["line-height-m"]}),(function(e){return e.theme["text-weight-regular"]}),(function(e){return e.theme["popover-pointer-filter"]}),(function(e){return e.theme["popover-background-color"]}));function Se(e){var t=(0,c.useState)({}),n=(0,fe.Z)(t,2),r=n[0],o=n[1],a=e.children,i=e.className,s=e.delay,l=e.openAnimationDuration,u=e.closeAnimationDuration,p=e.isOpen,m=e.onOpen,v=e.onClose,b=e.gap,h=e.maxWidth,y=e.onClickOutside,g=e.padding,f=e.placement,w=e.trigger,E=e.triggerEvent,C=e.triggerRef,k=e.appendTo,I=e.pointer,_=e.xOffset,S=e.getReferenceClientRect,O=e["data-testid"],x=e["data-click"],A=I?b+11:b;function T(e){27===e.keyCode&&("boolean"==typeof p&&y?y(e):r&&r.hide())}function R(){document.addEventListener("keydown",T),m&&m()}function N(){document.removeEventListener("keydown",T),v&&v()}function L(){y&&y()}return null!==p?d().createElement(_e,{visible:p,onCreate:function(e){return o(e)},content:a,placement:f,interactive:!0,delay:[s,null],duration:[l,u],maxWidth:h,className:"aether-popover ".concat(i),"data-aether-id":"aether-popover","data-testid":O,"data-click":x,arrow:!!I&&'<svg\n        width="20"\n        height="11"\n        viewBox="0 0 20 11"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M11.5365 0.843729L20.0001 11L8.91685e-05 11L8.46365 0.843731C9.26324 -0.115777 10.7369 -0.115779 11.5365 0.843729Z"\n        />\n      </svg>',appendTo:k||document.getElementById("aether-popover-portal"),reference:C,onShow:R,onHide:N,padding:g,offset:[_,A],onClickOutside:L,getReferenceClientRect:S},w):d().createElement(_e,{onCreate:function(e){return o(e)},content:a,placement:f,trigger:E,interactive:!0,delay:[s,null],duration:[l,u],maxWidth:h,className:"aether-popover ".concat(i),"data-aether-id":"aether-popover","data-testid":O,"data-click":x,arrow:!!I&&'<svg\n      width="20"\n      height="11"\n      viewBox="0 0 20 11"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M11.5365 0.843729L20.0001 11L8.91685e-05 11L8.46365 0.843731C9.26324 -0.115777 10.7369 -0.115779 11.5365 0.843729Z"\n      />\n    </svg>',appendTo:k||document.getElementById("aether-popover-portal"),reference:C,onShow:R,onHide:N,padding:g,offset:[_,A],onClickOutside:L,getReferenceClientRect:S},w)}Se.defaultProps={children:null,className:"",delay:0,openAnimationDuration:275,closeAnimationDuration:250,isOpen:null,gap:4,xOffset:0,maxWidth:320,onClickOutside:null,padding:"spacing-s",placement:"bottom-end",trigger:null,triggerEvent:"click",triggerRef:null,appendTo:null,pointer:!1,getReferenceClientRect:null,onOpen:null,onClose:null,"data-testid":"aether-popover","data-click":""},Se.propTypes={children:Ee().oneOfType([Ee().arrayOf(Ee().node),Ee().node]),className:Ee().string,delay:Ee().number,openAnimationDuration:Ee().number,closeAnimationDuration:Ee().number,isOpen:Ee().bool,gap:Ee().number,xOffset:Ee().number,maxWidth:Ee().oneOfType([Ee().number,Ee().string]),onClickOutside:Ee().func,onOpen:Ee().func,onClose:Ee().func,padding:Ee().oneOf(Object.keys(ke.globals.spacing)),placement:Ee().oneOf(["auto","top","top-start","top-end","bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end"]),trigger:Ee().object,triggerRef:Ee().object,appendTo:Ee().oneOfType([Ee().oneOf(["parent"]),Ee().object]),triggerEvent:function(e){var t=e.triggerEvent;return"string"!=typeof t?new Error("Popover: triggerEvent prop only accepts string as a valid value."):"string"==typeof t&&t.split(" ").filter((function(e){return!Ie.includes(e)})).length?new Error("Popover: the value of triggerEvent prop must be from ".concat(Ie,".")):null},pointer:Ee().bool,getReferenceClientRect:Ee().func,"data-testid":Ee().string,"data-click":Ee().string};var Oe=n(3903),xe=n(6415),Ae=n(605);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Re=ge().div.withConfig({displayName:"SplitButton__StyledSplitButton",componentId:"sc-1uqtf3s-0"})(["width:max-content;box-sizing:border-box;cursor:pointer;user-select:none;display:inline-flex;align-items:center;border-radius:",";height:",";",";& .aether-split-button__primary-btn:disabled{border-top-right-radius:0;border-bottom-right-radius:0;}& .aether-split-button__secondary-btn:disabled{border-top-left-radius:0;border-bottom-left-radius:0;}&:hover{& .aether-split-button__splitter{border-left-color:transparent;}}&:active{& .aether-split-button__splitter{border-left-color:transparent;}}"],(function(e){return e.theme["border-radius-default"]}),(function(e){return e.theme["size-m"]}),(function(e){return function(e,t){switch(e){case"primary":return"\n        background-color: ".concat(t["button-primary-background-color"],";\n\n        & .aether-split-button__splitter {\n          border-left-color: ").concat(t["splitbutton-primary-splitter-color"],";\n        }\n      ");case"secondary":return"\n        background-color: ".concat(t["button-secondary-background-color"],";\n\n        & .aether-split-button__splitter {\n          border-left-color: ").concat(t["splitbutton-secondary-splitter-color"],";\n        }\n      ");case"tertiary":return"\n        background-color: ".concat(t["button-tertiary-background-color"],";\n\n        & .aether-split-button__splitter {\n          border-left-color: ").concat(t["splitbutton-tertiary-splitter-color"],";\n        }\n      ");default:return null}}(e.type,e.theme)})),Ne=ge().div.withConfig({displayName:"SplitButton__StyledButtonSplitter",componentId:"sc-1uqtf3s-1"})(["border-width:",";border-left-style:",";height:20px;"],(function(e){return"".concat(e.theme["border-width-default"])}),(function(e){return"".concat(e.theme["border-style-solid"])}));function Le(e){var t=(0,c.useRef)(),n=e.text,r=e.onClick,o=e.children,a=e.type,i=e.icon,s=e.tooltip,l=e.minWidth,u=e.className,p=e.isLoading,m=e.isDisabled,v=e.secondaryButton,b=e.autoFocus,h=e["data-testid"],y=e["data-click"],g=d().Children.map(o,(function(e){return d().isValidElement(e)&&e.type===Se?d().cloneElement(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){(0,Oe.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({placement:"bottom-end"},!v&&{triggerRef:t})):e}));return d().createElement(Re,{type:a,className:u,"data-aether-id":"aether-splitButton","data-testid":h,"data-click":y},d().createElement(Ae.Z,{type:a,text:n,icon:i,isLoading:p,isDisabled:m,minWidth:l,onClick:r,tooltip:s,className:"aether-split-button__primary-btn",autoFocus:b}),!m&&!p&&d().createElement(Ne,{className:"aether-split-button__splitter"}),function(e,t,n){if(e&&e.type===Ae.Z){var r=e.props.icon;return d().cloneElement(e,{type:t,icon:r||d().createElement(xe.Z,null),className:"aether-split-button__secondary-btn"})}return d().createElement(Ae.Z,{type:t,icon:d().createElement(xe.Z,null),ref:n,className:"aether-split-button__secondary-btn"})}(v,a,t),g)}Le.displayName="SplitButton";const De=Le;Le.defaultProps={text:"",type:"secondary",icon:null,tooltip:"",minWidth:"",className:"",isLoading:!1,isDisabled:!1,secondaryButton:null,autoFocus:!1,"data-testid":"aether-split-button","data-click":""},Le.propTypes={text:Ee().string,onClick:Ee().func.isRequired,children:Ee().node.isRequired,type:Ee().oneOf(["primary","secondary","tertiary"]),icon:Ee().node,tooltip:Ee().oneOfType([Ee().string,Ee().object]),minWidth:Ee().string,className:Ee().string,isLoading:Ee().bool,isDisabled:Ee().bool,secondaryButton:Ee().node,autoFocus:Ee().bool,"data-testid":Ee().string,"data-click":Ee().string};var Pe=n(7560),je=n(207),Ve=d().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d().createElement("g",{clipPath:"url(#clip0_3652_80)"},d().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 2L2 2.00004V14H6V15H2C1.44772 15 1 14.5523 1 14V2.00004C1 1.44776 1.44771 1.00004 2 1.00004L14 1C14.5523 0.999998 15 1.44771 15 2V9H14V2ZM11 16C7.875 16 6 12.5 6 12.5C6 12.5 7.5625 9 11 9C14.4375 9 16 12.5 16 12.5C16 12.5 14.125 16 11 16ZM7.94047 11.4339C7.59128 11.8064 7.33019 12.182 7.15622 12.4663L7.16698 12.482C7.36759 12.7751 7.66306 13.1639 8.04157 13.5493C8.81714 14.339 9.82494 15 11 15C12.1751 15 13.1829 14.339 13.9584 13.5493C14.3369 13.1639 14.6324 12.7751 14.833 12.482L14.8438 12.4663C14.6698 12.182 14.4087 11.8064 14.0595 11.4339C13.3515 10.6787 12.3472 10 11 10C9.65281 10 8.64852 10.6787 7.94047 11.4339ZM12.5 12.5C12.5 13.3284 11.8284 14 11 14C10.1716 14 9.5 13.3284 9.5 12.5C9.5 11.6716 10.1716 11 11 11C11.8284 11 12.5 11.6716 12.5 12.5ZM3 4H6V3H3V4ZM6 7H3V6H6V7ZM3 10H6V9H3V10ZM13 4H8V3H13V4ZM8 7H13V6H8V7Z",fill:"#6B6B6B"})),d().createElement("defs",null,d().createElement("clipPath",{id:"clip0_3652_80"},d().createElement("rect",{width:"16",height:"16",fill:"white"})))),Fe=d().forwardRef((function(e,t){return d().createElement(je.Z,(0,Pe.Z)({},e,{svg:Ve,ref:t}))}));Fe.getName=function(){return"icon-action-viewEnvironment-stroke"};const Ue=Fe,Be=ge()(Ue).withConfig({displayName:"dropdown-button__QuickLookIcon",componentId:"sc-b97miz-0"})(["padding:0 var(--spacing-xs);"]),Me=ge()(De).withConfig({displayName:"dropdown-button__StyledSplitButton",componentId:"sc-b97miz-1"})(["flex:1;min-width:0;button:first-child > span{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}&:hover{.aether-split-button__splitter{border-left-color:var(--vscode-button-separator);}}"]),We=({value:e,isLoading:t,onClick:n,isSecondaryButtonDisabled:r,onSecondaryButtonClick:o,ref:a})=>{const{label:i,forkLabel:s}=e,l=s?`${i} [${s}]`:i;return(0,M.jsx)(Me,{ref:a,type:"secondary",minWidth:"0px",tooltip:l,text:l,secondaryButton:(0,M.jsx)(Ae.Z,{type:"secondary",icon:(0,M.jsx)(Be,{}),onClick:o,"data-testid":"quick-look-button",isDisabled:r}),isLoading:t,onClick:n})},$e=ge().div.withConfig({displayName:"dropdown-menu-footer__DropdownMenuFooterWrapper",componentId:"sc-1nhsm47-0"})(["display:flex;padding:var(--spacing-l);background-color:var(--highlight-background-color-secondary);border-radius:0 0 var(--border-radius-default) var(--border-radius-default);"]),He=({text:e,isLoading:t,isDisabled:n,onClick:r})=>(0,M.jsx)($e,{children:(0,M.jsx)(Ae.Z,{type:"text",text:e,onClick:r,isLoading:t,isDisabled:n})});var Ge=n(8069);const Ze=ge()(Ge.Z).withConfig({displayName:"dropdown-menu-filter__FilterInput",componentId:"sc-29ferf-0"})(["border-color:transparent;border-radius:var(--border-radius-default) var(--border-radius-default) 0 0;&:active,&:focus,&:hover,&:focus-within{box-shadow:none;border-color:transparent;}"]),qe=({value:e,onChange:t})=>{const n=d().useRef(null);return d().useEffect((()=>{n.current&&n.current.focus()}),[]),(0,M.jsx)(Ze,{ref:n,type:"search",value:e,onChange:t,placeholder:"Search"})};var Qe=n(1397),Ke=n(7691);const Ye=ge().div.withConfig({displayName:"menu-item-label__LabelWrapper",componentId:"sc-levdfs-0"})(["box-sizing:border-box;display:flex;align-items:center;overflow:hidden;cursor:pointer;"]),ze=ge().p.withConfig({displayName:"menu-item-label__Label",componentId:"sc-levdfs-1"})(["flex:2;margin:0;margin-right:var(--spacing-s);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:fit-content;"]),Xe=ge().p.withConfig({displayName:"menu-item-label__ForkLabel",componentId:"sc-levdfs-2"})(["flex:1;white-space:nowrap;overflow:hidden;margin:0;margin-left:var(--spacing-xs);font-size:var(--text-size-s);font-weight:var(--text-weight-regular);text-overflow:ellipsis;color:var(--content-color-tertiary);max-width:fit-content;"]),Je=({label:e,forkLabel:t})=>e?(0,M.jsxs)(Ye,{children:[(0,M.jsx)(Qe.Z,{content:e,openDelay:1e3,placement:"bottom",children:(0,M.jsx)(ze,{children:e})}),t&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(Ke.Z,{color:"content-color-tertiary",size:"small","data-testid":"fork-icon"}),(0,M.jsx)(Qe.Z,{content:t,openDelay:1e3,placement:"bottom",children:(0,M.jsx)(Xe,{children:t})})]})]}):null,et=ge().div.withConfig({displayName:"dropdown-menu-item__DropdownMenuItemWrapper",componentId:"sc-1id443p-0"})(["flex:1;color:var(--content-color-primary);min-height:28px;box-sizing:border-box;padding:var(--spacing-xs) var(--spacing-s);border-radius:var(--border-radius-default);display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;user-select:none;"," &:hover{background-color:var(--highlight-background-color-secondary);}&:active{background-color:var(--highlight-background-color-tertiary);}"],(({isSelected:e})=>e&&"background-color: var(--highlight-background-color-primary);")),tt=({isSelected:e,label:t,forkLabel:n,onSelect:r})=>(0,M.jsx)(et,{isSelected:e,role:"menuitem",onClick:r,tabIndex:0,onKeyPress:e=>{if("Enter"===e.key||" "===e.key)return e.preventDefault(),e.stopPropagation(),r()},children:(0,M.jsx)(Je,{label:t,forkLabel:n})}),nt=ge().div.withConfig({displayName:"dropdown-menu__DropdownMenuWrapper",componentId:"sc-186uy9h-0"})(["display:flex;flex-direction:column;max-height:75vh;width:90vw;max-width:320px;"]),rt=ge().div.withConfig({displayName:"dropdown-menu__MenuList",componentId:"sc-186uy9h-1"})(["flex:1;display:flex;flex-direction:column;padding:var(--spacing-s);overflow-y:auto;background:var(--background-color-primary);:empty::before{content:'No items found';flex:1;min-height:28px;box-sizing:border-box;padding:var(--spacing-xs) var(--spacing-s);color:var(--content-color-tertiary);}"]),ot=ge().div.withConfig({displayName:"dropdown-menu__HeaderInfoText",componentId:"sc-186uy9h-2"})(["padding:var(--spacing-s) var(--spacing-l);color:var(--content-color-secondary);background-color:var(--highlight-background-color-secondary);font-weight:var(--text-weight-bold);user-select:none;"]),at=ge().div.withConfig({displayName:"dropdown-menu__LoadingErrorWrapper",componentId:"sc-186uy9h-3"})(["text-align:center;padding:var(--spacing-m);"]),it=ge().div.withConfig({displayName:"dropdown-menu__FilterWrapper",componentId:"sc-186uy9h-4"})(["border-radius:var(--border-radius-default) var(--border-radius-default) 0 0;",";"],(e=>e.isBleed?" ":"border-bottom: var(--border-width-default) var(--border-style-solid) var(--border-color-default);")),st=({options:e,onChange:t,value:n,isError:r,refetch:o,headerInfoText:a,isCreateNewLoading:i,isCreateNewDisabled:s,onCreateNew:l,createNewText:c="Create New"})=>{const[u,p]=d().useState(""),m=e.filter((({label:e})=>e.toLowerCase().includes(String(u).toLowerCase())));return(0,M.jsxs)(nt,{role:"menu",id:"selectormenu","aria-labelledby":"menubutton",children:[(0,M.jsx)(it,{isBleed:Boolean(a),children:(0,M.jsx)(qe,{value:u,onChange:e=>p(e.target.value)})}),a&&(0,M.jsx)(ot,{children:a}),r?(0,M.jsxs)(at,{children:["Failed to load. ",(0,M.jsx)(Ae.Z,{type:"text",text:"Retry",onClick:o})]}):(0,M.jsx)(rt,{children:m.map((e=>(0,M.jsx)(tt,{value:e.value,label:e.label,forkLabel:e.forkLabel,onSelect:()=>(p(""),t(e)),isSelected:e.value===n.value},e.value)))}),l&&(0,M.jsx)(He,{text:c,onClick:l,isLoading:i,isDisabled:s})]})},lt=ge().div.withConfig({displayName:"selector__TriggerWrapper",componentId:"sc-1tclpid-0"})(["display:flex;flex:1;max-width:260px;"]),ct=({value:e,options:t,onChange:n,isLoading:r,isError:o,refetch:a,headerInfoText:i,isCreateNewLoading:s,isCreateNewDisabled:l,onCreateNew:c,isQuickLookDisabled:u,onQuickLookClick:p,menuPlacement:m,"aria-label":v})=>{const[b,h]=d().useState(!1),y=(0,M.jsx)(lt,{children:(0,M.jsx)(We,{value:e,isLoading:r,onClick:()=>h((e=>!e)),isSecondaryButtonDisabled:u,onSecondaryButtonClick:()=>(b&&h(!1),p()),"aria-haspopup":"menu","aria-controls":"selectormenu","aria-expanded":b,"aria-label":v})});return(0,M.jsx)(Se,{placement:m,trigger:y,isOpen:b,onClickOutside:()=>h(!1),padding:"0",appendTo:"parent",children:b&&(0,M.jsx)(st,{isCreateNewLoading:s,isCreateNewDisabled:l,onCreateNew:c,headerInfoText:i,options:t,isError:o,refetch:a,onChange:(...e)=>(h(!1),n(...e)),value:e})})},dt=e=>({queryKey:[b,e],queryFn:({signal:t})=>(async(e,{signal:t}={})=>{var n,r;if(!e)throw new Error("Invalid environment id");const o=await m.postmanGateway.get({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,signal:t});null==o||o.data;const a=_(o.data);return await(0,k.updateDependentSession)({model:"environment",modelId:a.id},a),Object.assign({},a,{forkedFrom:null!=(n=null==(r=o.meta)?void 0:r.forkedFrom)?n:null})})(e,{signal:t}),useErrorBoundary:!1}),ut=e=>Object.assign({},dt(null!=e?e:""),{enabled:!!e}),pt=e=>({queryKey:[y,e],queryFn:({signal:t})=>(async(e,{signal:t}={})=>{var n;const r=await m.postmanGateway.get({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/workspace/${e}/globals`,signal:t});if(!Array.isArray(null==r||null==(n=r.data)?void 0:n.values))throw new TypeError("Received invalid globals data from server");const o=r.data;return await(0,k.updateDependentSession)({model:"globals",modelId:o.id},o),o})(e,{signal:t}),useErrorBoundary:!1}),mt=async({signal:e,permissionsPayload:t})=>{const n=await m.postmanGateway.post({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:Object.assign({},t)}},signal:e});if(null==n||!n.results)throw new Error("Received invalid permissions");return n.results},vt="workspace",bt="ADD_ENVIRONMENT_TO_WORKSPACE",ht="UPDATE_GLOBALS",yt=(e,t)=>{const n={};for(const[r,o]of Object.entries(t))n[o]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:vt,permission:r};return n},gt=e=>({queryKey:[h,g,e],queryFn:async({signal:t})=>{if(!window.USER_ID)return{userCanCreateEnvironment:!0,userCanUpdateGlobals:!0};const n={[bt]:`${vt}/${e}/${bt}`,[ht]:`${vt}/${e}/${ht}`},r=await mt({signal:t,permissionsPayload:yt(e,n)});return{userCanCreateEnvironment:r[n[bt]].allowed,userCanUpdateGlobals:r[n[ht]].allowed}},useErrorBoundary:!1}),ft="workspace",wt="ADD_ENVIRONMENT_TO_WORKSPACE",Et="UPDATE_ENVIRONMENT",Ct="DELETE_ENVIRONMENT",kt=e=>e.includes(ft),It=(e,t)=>({queryKey:[f,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanCreate:!0,userCanUpdate:!0,userCanDelete:!0};const r={[wt]:`${ft}/${t}/${wt}`,[Et]:`${e}:${Et}`,[Ct]:`${e}:${Ct}`},o=((e,t,n)=>{const r={};for(const[o,a]of Object.entries(n))r[a]={entityId:window.USER_ID,entityType:"user",permission:o,objectId:kt(a)?t:e,objectType:kt(a)?ft:"environment"};return r})(e,t,r),a=await mt({signal:n,permissionsPayload:o});return{userCanCreate:a[r[wt]].allowed,userCanUpdate:a[r[Et]].allowed,userCanDelete:a[r[Ct]].allowed}},useErrorBoundary:!1}),_t="workspace",St="UPDATE_GLOBALS",Ot=(e,t)=>{const n={};for(const[r,o]of Object.entries(t))n[o]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:_t,permission:r};return n},xt=e=>({queryKey:[w,e],queryFn:async({signal:t})=>{if(!window.USER_ID)return{userCanUpdate:!0};const n={[St]:`${_t}/${e}/${St}`};return{userCanUpdate:(await mt({signal:t,permissionsPayload:Ot(e,n)}))[n[St]].allowed}},useErrorBoundary:!1}),At="workspace",Tt="ADD_ENVIRONMENT_TO_WORKSPACE",Rt=e=>({queryKey:[E,e],queryFn:async({signal:t})=>{if(!window.USER_ID)return{userCanCreate:!0};const n={[Tt]:`${At}/${e}/${Tt}`},r=((e,t)=>{const n={};for(const[r,o]of Object.entries(t))n[o]={entityId:window.USER_ID,entityType:"user",permission:r,objectId:e,objectType:At};return n})(e,n);return{userCanCreate:(await mt({signal:t,permissionsPayload:r}))[n[Tt]].allowed}},useErrorBoundary:!1}),Nt={userCanCreate:!0},Lt=e=>Boolean(e.isLoading);var Dt=n(3720);const Pt="environment-selector-value-paint-mark",{PerfContext:jt,PerformanceMarkPaint:Vt}=Dt.perfComponents,Ft=()=>{performance.measure("environment-selector-value-paint-time",{},Pt),(0,Dt.sendMeasureEvent)({name:Pt,entityType:"generic-selector"})},Ut=Object.freeze({label:"No Environment",value:"",forkLabel:""}),Bt=()=>{var e;const t=(0,Z.useNavigate)(),n=(0,p.useActiveWorkspaceId)(),r=(0,c.useContext)(W),o=r&&!r.useActiveEnvironmentFromContext;J(n);const{data:a,isError:i,refetch:s}=U({workspaceId:n}),l=!a,{data:d}=B(),m=ee(),v=(0,c.useMemo)((()=>{var e;return[Ut,...null!=(e=null==a?void 0:a.map((e=>{var t;const n=Lt(e)?null:null==(t=e.attributes)||null==(t=t.fork)?void 0:t.forkLabel;return{label:e.name,value:e.id,forkLabel:null!=n?n:""}})))?e:[]]}),[a]),b=Y(),{isLoading:h,userCanCreate:y}=(()=>{const e=(0,p.useActiveWorkspaceId)(),{data:t,error:n}=(0,u.useDataFetch)(Rt(e));return n?Object.assign({isLoading:!1},Nt):t?Object.assign({isLoading:!1},t):Object.assign({isLoading:!0},Nt)})(),g=(e,r)=>{const o={rename:(null==r?void 0:r.showRenameOptionOnOpen)||!1};t(`/workspace/${n}/environment/${e}`,{state:JSON.stringify({additionalContext:o})},{customNavEvent:Z.OPEN_EXTENSION_URL,additionalContext:o})},f=null!=(e=v.find((e=>e.value===(null==d?void 0:d.id))))?e:Ut,w=l&&!i,{markName:E,callback:C}=(0,c.useContext)(jt);return(0,M.jsx)("div",{"data-testid":"active-environment-selector",children:(0,M.jsx)(Vt,{condition:!w,markName:E||Pt,callback:C||Ft,children:(0,M.jsx)(ct,{options:v,value:f,isLoading:w,isError:i,refetch:s,onChange:e=>{m.mutate(null!=e&&e.value?{id:e.value}:null)},menuPlacement:"bottom-end","aria-label":"active-environment",isQuickLookDisabled:!d||l,onQuickLookClick:()=>{d&&g(d.id)},headerInfoText:o?"Switch environment for the entire collection":void 0,isCreateNewLoading:b.isLoading||h,isCreateNewDisabled:!y,onCreateNew:()=>{b.mutate({workspaceId:n,requestBody:{id:(0,G.v4)(),name:"New Environment",values:[]}},{onSuccess:({data:e})=>{q.AnalyticsService.addEventV2({category:"environment",action:"create",label:"environment-selector"}),g(`${e.owner}-${e.id}`,{showRenameOptionOnOpen:!0})}})}})})})},Mt=e=>Q()?(0,M.jsx)(Bt,Object.assign({},e)):null,Wt=e=>null==e?void 0:e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),$t=async(e,t)=>{if(!e.id)throw new Error("updateEnvironment: id is required");const n=(e=>{const{values:t}=e;return Object.assign({},e,{values:Wt(t)})})(e),r=(o=(await m.postmanGateway.put({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/environment/${n.id}`,body:JSON.stringify({name:n.name,values:n.values})})).data,Object.assign({},o,{id:`${o.owner}-${o.id}`}));var o;return null!=t&&t.avoidSession||await(0,k.updateDependentSession)({model:"environment",modelId:r.id},r),r},Ht=()=>({mutationFn:$t,onSuccess:e=>{u.cacheClient.setQueryData(["environment",e.id],e)}}),Gt=()=>({mutationFn:async(e,t,n=!1)=>{const r=e.id;if(n)return await(0,k.setSession)({model:"environment",modelId:r},t),null;const[o]=await Promise.all([$t(e,{avoidSession:!0}),(0,k.setSession)({model:"environment",modelId:r},t)]);return{environment:o}},onSuccess:e=>{if(e){const{environment:t}=e;(0,u.updateCache)({key:[b,t.id],updater:e=>e?Object.assign({},e,t):e})}}}),Zt=e=>e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),qt=e=>{const{values:t,workspace:n}=e;return{workspace:n,values:Zt(t)}},Qt=async(e,t)=>{const n=e.workspace,r=(await m.postmanGateway.put({url:`${I.Z.HTTPS_GATEWAY_PRIVATE_URL}/workspace/${n}/globals`,body:JSON.stringify(qt(e))})).data;return null!=t&&t.avoidSession||await(0,k.updateDependentSession)({model:"globals",modelId:r.id},r),r},Kt=()=>({mutationFn:Qt,onSuccess:e=>{u.cacheClient.setQueryData([y,e.workspace],e)}}),Yt=()=>({mutationFn:async(e,t,n=!1)=>{if(n)return await(0,k.setSession)({model:"globals",modelId:e.id},t),null;const[r]=await Promise.all([Qt(e,{avoidSession:!0}),(0,k.setSession)({model:"globals",modelId:e.id},t)]);return{globals:Object.assign({},r,{workspace:e.workspace})}},onSuccess:e=>{if(e){const{globals:t}=e;(0,u.updateCache)({key:["globals",t.workspace],updater:t})}}}),zt=(e,t)=>{(0,u.updateCache)({key:e,updater:e=>e?Object.assign({},e,{name:t}):e})},Xt=()=>({mutationFn:e=>pe(e),onMutate:async({environmentId:e,name:t})=>{const n=[b,e],r=u.cacheClient.getQueryData(n);return zt(n,t),()=>{r&&zt(n,r.name)}},onSuccess:(e,{environmentId:t})=>{zt([b,t],e.data.name)},onError:(e,t,n)=>{n&&n()}});var Jt=n(4302);async function en(e,t,n){Jt.VSCodeCommunicationsService.postMessageToExtension({type:"RESOLVE_VARIABLES",payload:{objectToResolve:e,variables:t,id:n}})}const tn=async(...e)=>{const t=await $t(...e);return(0,u.updateCache)({key:[b,t.id],updater:()=>t}),t},nn=async(...e)=>{const t=await Qt(...e);return(0,u.updateCache)({key:[y,t.workspace],updater:()=>t}),t},rn=(0,k.createVariableUpdatesHandler)({model:"environment",hasEditPermission:async(e,{workspaceId:t})=>{var n;const r=await u.cacheClient.fetchQuery(It(e,t)).catch((()=>null));return null==(n=null==r?void 0:r.userCanUpdate)||n},getValues:async e=>await u.cacheClient.fetchQuery(dt(e)).catch((()=>null)),setValues:(e,t)=>tn({id:e,values:t})}),on=(0,k.createVariableUpdatesHandler)({model:"globals",hasEditPermission:async(e,{workspaceId:t})=>{var n;const r=await u.cacheClient.fetchQuery(xt(t)).catch((()=>null));return null==(n=null==r?void 0:r.userCanUpdate)||n},getValues:async(e,{workspaceId:t})=>await u.cacheClient.fetchQuery(pt(t)).catch((()=>null)),setValues:(e,t,{workspaceId:n})=>nn({id:e,values:t,workspace:n})}),an=async e=>{if(!e)return;const t=await u.cacheClient.fetchQuery(dt(e));return(0,k.getActiveSession)({model:"environment",modelId:t.id},t)},sn=async e=>{const t=await u.cacheClient.fetchQuery(pt(e));return(0,k.getActiveSession)({model:"globals",modelId:t.id},t)};var ln=function(e){return e.GLOBALS="globals",e.WORKSPACE="workspace",e}(ln||{});const cn=(e,{workspaceId:t})=>{var n,r;const o=null==e||null==(n=e.meta)?void 0:n.model,a=null==e||null==(r=e.meta)?void 0:r.action;if(o===ln.GLOBALS&&a===x.UPDATE){const n=null==e?void 0:e.data;O(t,n)}o===ln.WORKSPACE&&a===R.UPDATE_ROLES&&(u.cacheClient.invalidateQueries({queryKey:[f]}),(0,u.invalidateCache)([w,t]))}},9730:()=>{}}]);
//# sourceMappingURL=8586.ee98242f9b808823.js.map