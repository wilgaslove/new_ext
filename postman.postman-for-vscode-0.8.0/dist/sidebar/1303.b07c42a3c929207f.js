(self.webpackChunksidebar=self.webpackChunksidebar||[]).push([[1303],{4492:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var s=a(7560),r=a(9730),o=a.n(r);const n=(0,s.Z)({},o(),{DISABLE_ANALYTICS:!1,ANALYTICS_URL:"https://events.getpostman.com/events",IDENTITY_URL:"https://identity.getpostman.com",ARTEMIS_URL:"https://go.postman.co",HTTPS_GATEWAY_PRIVATE_URL:"https://bifrost-extension-https-global.gw.postman.com",WEBSOCKET_GATEWAY_URL:"wss://bifrost-extension-global.gw.postman.com",WEB_URL:"https://www.getpostman.com",DASHBOARD_URL:"https://go.postman.co",EXPLORE_URL:"https://www.postman.com",SENTRY_DSN:"https://0fd0f21b182549f18b0e01ce62f8adb0@o1224273.ingest.sentry.io/4505072910139392",OAUTH2_CALLBACK_URL:"https://oauth.pstmn.io/v1/vscode-callback"})},1303:(e,t,a)=>{"use strict";a.r(t),a.d(t,{CollectionPermissionNames:()=>K,CollectionPermissions:()=>H,ENABLE_COLLECTIONS:()=>st,collectionFindOneQuery:()=>L,collectionPermissionsQuery:()=>M,collectionVariablesHandler:()=>Ne,composeUID:()=>d,createCollection:()=>I,createRequest:()=>ee,decomposeUID:()=>l,deleteResponse:()=>Q,duplicateCollection:()=>q,fetchPermissions:()=>k,findOneFolder:()=>T,findOneRequest:()=>G,folderFindOneQuery:()=>O,folderFindOneSelectCollectionQuery:()=>$,getActiveCollectionSession:()=>xe,getBreadcrumbItems:()=>at,getCollectionList:()=>y,getResponseData:()=>E,getResponseMetaData:()=>j,getUserInfo:()=>te,getWorkspacePermissionsQuery:()=>V,isUID:()=>i,requestFindOneQuery:()=>U,requestFindOneSelectCollectionQuery:()=>Z,responseFindOneQuery:()=>D,responseFindOneSelectCollectionQuery:()=>W,transferResponse:()=>J,updateCollection:()=>v,updateCollectionMutation:()=>He,updateFolder:()=>_,updateFolderMutation:()=>Ke,updateRequest:()=>z,updateRequestCollection:()=>Ve,updateRequestMutation:()=>Ye,updateResponse:()=>x,updateResponseMutation:()=>Me,useCollectionList:()=>me,useCollectionListRawQuery:()=>he,useCollectionListSubscription:()=>be,useCollectionSubscription:()=>we,useCreateNewCollection:()=>_e,useCreateNewFolder:()=>Pe,useCreateRequest:()=>Ue,useCreateResponse:()=>et,useDeleteCollection:()=>Ce,useDeleteFolder:()=>Le,useDeleteRequest:()=>Ze,useDeleteResponse:()=>Xe,useDuplicateCollection:()=>Ee,useDuplicateFolder:()=>Oe,useDuplicateRequest:()=>De,useDuplicateResponse:()=>Je,useResponseMeta:()=>je,useResponseMetaUpdateMutation:()=>tt,useUpdateFolderInList:()=>Ge,useUpdateRequestInList:()=>We,useUpdateUpdateCollectionInList:()=>Ae,useWorkspacePermissions:()=>Se});var s=a(7560),r=a(8079),o=a(4492);const n="-",d=(e,t)=>{const a=e.split(n);return!a||!t||a.length>=6?e:`${t}${n}${e}`},l=e=>{const t="string"==typeof e&&e.split(n);return!t||t.length<6?{id:e}:{owner:t.shift(),id:t.join(n)}},i=e=>{const t=e.split(n);return!!(Array.isArray(t)&&t.length>=6)},c=(e,t)=>{const a=e.responses_order.map((e=>i(e)?e:d(e,t)));return(0,s.Z)({},e,{responses_order:a})},u=(e,t)=>{const a=e.folders_order.map((e=>i(e)?e:d(e,t))),r=e.order.map((e=>i(e)?e:d(e,t))),o=e.folders.map((e=>u(e,t))),n=e.requests.map((e=>c(e,t)));return(0,s.Z)({},e,{folders:o,requests:n,folders_order:a,order:r})},p=(e,t)=>{const a=e.folders_order.map((e=>i(e)?e:d(e,t))),r=e.order.map((e=>i(e)?e:d(e,t))),o=e.folders.map((e=>u(e,t))),n=e.requests.map((e=>c(e,t)));return(0,s.Z)({},e,{folders:o,requests:n,folders_order:a,order:r})},y=async({workspaceId:e,ids:t,includeResponse:a})=>e?(e=>{const t={data:[]};if(null==e||!Array.isArray(e.data))return t;for(const a of e.data){const{owner:e}=l(a.id);e?t.data.push(p(a,e)):t.data.push(a)}return t})(await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/list/collection`,query:{workspace:e},body:JSON.stringify({ids:t,exclude:{responses:!a,flags:{isArchived:!0,isFavorite:!0}}})})):{data:[]},I=async({signal:e,workspaceId:t,requestBody:a})=>await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/collection/import`,query:{workspace:t},body:JSON.stringify(a),signal:e});function f(e){return null==e?void 0:e.map((e=>e.disabled?(0,s.Z)({},e,{enabled:!1}):(0,s.Z)({},e,{enabled:!0})))}function w(e){const t=e.data.variables&&f(e.data.variables);return e.data.variables=t,e.data.id&&e.data.owner&&(e.data.id=d(e.data.id,e.data.owner)),e}function b(e,t){return e&&e.folder&&b(e.folder,t),e.id&&t&&(e.id=d(e.id,t)),e}function h(e){var t,a,s,r,o,n,l,i,c,u,p,y,I,w,h,g,v,q;return null!=e&&null!=(t=e.data)&&t.collection&&"string"==typeof e.data.collection&&null!=e&&null!=(a=e.data)&&a.owner&&(e.data.collection=d(e.data.collection,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(s=e.data)&&s.owner&&e.data.collection.id&&(e.data.collection.id=d(e.data.collection.id,e.data.owner)),"object"==typeof e.data.collection&&null!=e&&null!=(r=e.data)&&null!=(r=r.collection)&&r.variables&&(e.data.collection.variables=f(e.data.collection.variables)),null!=e&&null!=(o=e.data)&&o.id&&null!=e&&null!=(n=e.data)&&n.owner&&(e.data.id=d(e.data.id,e.data.owner)),null!=e&&null!=(l=e.data)&&l.folder&&"object"==typeof(null==e||null==(i=e.data)?void 0:i.folder)&&null!=e&&null!=(c=e.data)&&c.owner&&b(e.data.folder,e.data.owner),null!=e&&null!=(u=e.data)&&u.folder&&"string"==typeof(null==e||null==(p=e.data)?void 0:p.folder)&&null!=e&&null!=(y=e.data)&&y.owner&&(e.data.folder=d(e.data.folder,e.data.owner)),m(e)&&null!=e&&null!=(I=e.data)&&I.request&&"object"==typeof(null==e||null==(w=e.data)?void 0:w.request)&&null!=e&&null!=(h=e.data)&&h.owner&&(e.data.request.id=d(e.data.request.id,e.data.owner)),m(e)&&null!=e&&null!=(g=e.data)&&g.request&&"string"==typeof(null==e||null==(v=e.data)?void 0:v.request)&&null!=e&&null!=(q=e.data)&&q.owner&&(e.data.request=d(e.data.request,e.data.owner)),e}function m(e){return e&&e.data&&void 0!==e.data.request}var g=a(3154);const v=async({collectionId:e,patch:t,signal:a,options:n})=>{var d;if(!e)throw new Error("CollectionService~updateCollection: collectionId is a required parameter");(e=>{if(Array.isArray(e.variables)&&e.variables.length>0){var t;const a=null==(t=e.variables)?void 0:t.map((e=>"boolean"==typeof e.enabled?(0,s.Z)({},e,{disabled:!e.enabled}):(0,s.Z)({},e)));e.variables=a}})(t);const l=w(await r.postmanGateway.put({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,body:JSON.stringify(t),signal:a}));return null!=n&&n.avoidSession||null==l||null==(d=l.data)||!d.id||await(0,g.updateDependentSession)({model:"collection",modelId:l.data.id},{values:l.data.variables||[]}),l},q=async({workspaceId:e,collectionId:t,signal:a})=>await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/collection/${t}/duplicate`,query:{workspace:e},headers:{"Content-type":"text/plain"},signal:a}),k=async({permissions:e,signal:t})=>function(e){const t=Object.keys(e),a={};for(const s of t)a[s.split(":")[1]]=e[s];return a}((await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",method:"POST",service:"acs",data:{body:e},signal:t})).results),T=async({folderId:e,populate:t="parent",signal:a})=>{try{return e?h(await r.postmanGateway.get({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,query:{populate:t},signal:a})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},_=async({folderId:e,patch:t,signal:a})=>{if(!e)throw new Error("CollectionService~updateFolder: folderId is a required parameter");return h(await r.postmanGateway.put({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,body:JSON.stringify(t),signal:a}))},E=async({responseId:e,populate:t="parent",signal:a})=>{try{return e?h(await r.postmanGateway.get({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,query:{populate:t},signal:a})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}};var C=a(4958);const R="collection-find-one",A="folder-find-one",S="response-find-one",F="request-find-one",P="collection-permissions",L=({signal:e,collectionId:t})=>({queryKey:[R,t],queryFn:()=>(async({collectionId:e,signal:t})=>{var a;if(!e)return{model_id:"",meta:{},data:{}};const s=w(await r.postmanGateway.get({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,signal:t}));return null!=s&&null!=(a=s.data)&&a.variables&&await(0,g.updateDependentSession)({model:"collection",modelId:e},{values:s.data.variables}),s})({collectionId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),O=({signal:e,folderId:t})=>({queryKey:[A,t],queryFn:()=>T({folderId:t,populate:"parent",signal:e}),enabled:!!t,useErrorBoundary:!1}),$=({signal:e,folderId:t})=>(0,s.Z)({},O({signal:e,folderId:t||""}),{enabled:!!t,select:e=>e.data.collection}),G=async({requestId:e,populate:t=!1,signal:a})=>{var s;const n=h(await r.postmanGateway.get({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,query:{populate:t},signal:a}));if("object"==typeof(null==n||null==(s=n.data)?void 0:s.collection)){const e=n.data.collection;await(0,g.updateDependentSession)({model:"collection",modelId:e.id},{values:e.variables||[]})}return n},U=({requestId:e})=>({queryKey:[F,e],queryFn:async({signal:t})=>G({requestId:e,populate:"parent",signal:t}),enabled:!!e,useErrorBoundary:!1}),Z=({requestId:e})=>(0,s.Z)({},U({requestId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),D=({signal:e,responseId:t})=>({queryKey:[S,t],queryFn:async()=>E({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),W=({responseId:e})=>(0,s.Z)({},D({responseId:null!=e?e:""}),{enabled:!!e,select:e=>e.data.collection}),H={EDIT:"edit",DELETE:"delete"},K={UPDATE_COLLECTION:"UPDATE_COLLECTION",DELETE_COLLECTION:"DELETE_COLLECTION"};function B(e,t){const a={};for(const s of Object.keys(K))a[`${t}:${s}`]={entityId:e,entityType:"user",permission:s,objectType:"collection",objectId:t};return{checks:a}}const M=({signal:e,collectionId:t})=>({queryKey:[P,t],queryFn:()=>k({permissions:B(window.USER_ID,t),signal:e}),enabled:!!t,useErrorBoundary:!1}),Y="ADD_COLLECTION_TO_WORKSPACE",V=e=>({queryKey:["workspace",P,e],queryFn:({signal:t})=>(async({signal:e,workspaceId:t})=>{var a;let n={};const d=`workspace/${t}/${Y}`,l={[d]:{entityId:window.USER_ID,entityType:"user",objectId:t,objectType:"workspace",permission:Y}};try{const t=await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:(0,s.Z)({},l)}},signal:e});if(null==t||!t.results)throw new Error("Received invalid permissions");n=t.results}catch(e){return{userCanCreate:!0}}return{userCanCreate:null==(a=n[d])?void 0:a.allowed}})({signal:t,workspaceId:e}),enabled:!!e,useErrorBoundary:!1}),N=(e,t)=>{e&&(0,C.updateCache)({key:D({responseId:e}).queryKey,updater:e=>{if(!e)return;const a=t;return e.data.collection&&(a.data.collection=e.data.collection),e.data.folder&&(a.data.folder=e.data.folder),e.data.request&&(a.data.request=e.data.request),a}})},x=async({responseId:e,patch:t,signal:a})=>{if(!e)throw new Error("CollectionService~updateResponse: responseId is a required parameter");const s=await r.postmanGateway.put({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,body:JSON.stringify(t),signal:a});return N(e,s),h(s)},j=async({responseId:e,signal:t})=>{try{return e?h(await r.postmanGateway.get({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t})):{model_id:"",meta:{},data:{}}}catch(e){throw new Error(e)}},Q=async({responseId:e,signal:t})=>await r.postmanGateway.delete({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/response/${e}`,signal:t}),J=async({requestBody:e,signal:t})=>await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/transfer/response`,body:JSON.stringify(e),signal:t}),X=(e,t)=>{e&&(0,C.updateCache)({key:U({requestId:e}).queryKey,updater:e=>{if(!e)return;const a=t;return e.data.collection&&(a.data.collection=e.data.collection),e.data.folder&&(a.data.folder=e.data.folder),a}})},z=async({requestId:e,patch:t,signal:a})=>{if(!e)throw new Error("CollectionService~updateRequest: requestId is a required parameter");const s=await r.postmanGateway.put({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,body:JSON.stringify(t),signal:a});return X(e,s),h(s)},ee=async({request:e,signal:t})=>{if(!e)throw new Error("CollectionService~createRequest: invalid parameters");return h(await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/request/import?collection=${e.collection}`,body:JSON.stringify(e),signal:t}))},te=async({type:e,userIds:t,populate:a,signal:s})=>{const n={type:e,ids:t};a&&(n.populate=a);const d=await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/public_profile",service:"ums",method:"post",data:{body:n},signal:s});if(!d)throw new Error("Received invalid users");return d.users};var ae=a(540);const se=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.collectionId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({collectionId:t=e.collectionId,workspaceId:a=e.workspaceId,subscribingEntity:s=null,subscriptionHandler:o}){if(""===t)return;if(e.observer||e.asyncObserver)return;const{asyncObserver:n,abortController:d}=(e=>{const t=new AbortController;return{asyncObserver:r.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/collection/${e}/subscribe`,data:{}},subscriptionEvents:["update","update_roles","destroy"],responseFilter:e=>{var t;return null==e||null==(t=e.body)?void 0:t.model_id},broadcastFilter:e=>{var t;return l(null==e||null==(t=e.meta)||null==(t=t.timeline)?void 0:t.model_id).id},unsubscribeRequest:{method:"delete",service:"sync",url:`/collection/${e}/unsubscribe`,data:{}}}),abortController:t}})(t);e.abortController=d,e.asyncObserver=n,e.observer=await n,e.abortController=null,e.observer.subscribe({next:e=>{o(e,{collectionId:t,workspaceId:a,subscribingEntity:s})},complete:()=>{e.unsubscribe()},error:async function(a){e.cleanup(),await e.subscribe({subscriptionHandler:o,collectionId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},re=async(e,t,a)=>{switch(t.meta.action){case"update":{var s;"folder"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([A,null==a?void 0:a.id]),"request"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([F,null==a?void 0:a.id]),"response"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([S,null==a?void 0:a.id]);const r=w(t);((e,t)=>{e&&(0,C.updateCache)({key:L({collectionId:e}).queryKey,updater:e=>{if(e)return t}})})(e,r),null!=r&&null!=(s=r.data)&&s.id&&await(0,g.updateDependentSession)({model:"collection",modelId:r.data.id},{values:r.data.variables||[]});break}}},oe=(e,t)=>{e&&(0,C.updateCache)({key:O({folderId:e}).queryKey,updater:e=>{if(!e)return;const a=t;return e.data.collection&&(a.data.collection=e.data.collection),e.data.folder&&(a.data.folder=e.data.folder),a}})};var ne=a(4025);const de=(e,t,a)=>{var s;const r=`${null==e||null==(s=e.data)?void 0:s.owner}-${null==e?void 0:e.model_id}`,o=(0,ne.getTabManager)();switch(e.meta.action){case"update":"folder"===(null==a?void 0:a.type)&&(null==a?void 0:a.id)!==r&&(0,C.invalidateCache)([A,null==a?void 0:a.id]),"request"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([F,null==a?void 0:a.id]),"response"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([S,null==a?void 0:a.id]),oe(r,h(e));break;case"destroy":o.closeTabByRoute(`/workspace/${t}/folder/${r}`)}},le=(e,t,a)=>{var s;const r=`${null==e||null==(s=e.data)?void 0:s.owner}-${null==e?void 0:e.model_id}`,o=(0,ne.getTabManager)();switch(e.meta.action){case"update":"response"===(null==a?void 0:a.type)&&(0,C.invalidateCache)([S,null==a?void 0:a.id]),X(r,h(e));break;case"destroy":o.closeTabByRoute(`/workspace/${t}/request/${r}`)}},ie=(e,{collectionId:t,workspaceId:a,subscribingEntity:s})=>{switch(e.meta.model){case"collection":"update_roles"===e.meta.action&&(0,C.invalidateCache)([P,t]),s?re(t,e,s):re(t,e);break;case"folder":s?de(e,a,s):de(e,a);break;case"request":s?le(e,a,s):le(e,a);break;case"response":((e,t)=>{var a;const s=null==e||null==(a=e.data)?void 0:a.owner,r=(0,ne.getTabManager)(),o=`${s}-${null==e?void 0:e.model_id}`;switch(e.meta.action){case"update":N(o,h(e));break;case"destroy":r.closeTabByRoute(`/workspace/${t}/example/${o}`)}})(e,a)}},ce="collection-list",ue=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:a}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:s,abortController:o}=(e=>{const t=new AbortController;return{asyncObserver:r.postmanWebsocketGateway.subscribe({signal:t.signal,subscribeRequest:{method:"post",service:"sync",url:`/list/collection?workspace=${e}&subscribe=true`,data:{}},subscriptionEvents:["broadcast"],responseFilter:e=>{var t;return null==e||null==(t=e.body)||null==(t=t.subscription)?void 0:t.id},broadcastFilter:e=>{var t;return null==e||null==(t=e.data)||null==(t=t.subscription)?void 0:t.id},unsubscribeRequest:{method:"delete",service:"sync",url:`/list/collection/subscribe?workspace=${e}`,data:{}}}),abortController:t}})(t);e.abortController=o,e.asyncObserver=s,e.observer=await s,e.abortController=null,(0,C.invalidateCache)([ce,t]),e.observer.subscribe({next:e=>{a(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(s){e.cleanup(),await e.subscribe({subscriptionHandler:a,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};function pe({workspaceId:e,useErrorBoundary:t=!1,select:a}){return{enabled:!!e,queryKey:[ce,e],queryFn:async()=>y({workspaceId:e}),useErrorBoundary:t,select:a}}var ye=a(5193);const Ie=({signal:e,responseId:t})=>({queryKey:["response-meta",t],queryFn:async()=>j({responseId:t,signal:e}),enabled:!!t,useErrorBoundary:!1}),fe=(e,{workspaceId:t})=>{if("broadcast"===e.meta.action&&"workspace"===e.meta.model){const a=[],s=[];"response"===e.meta.entity&&e.meta.entity_id&&(0,C.invalidateCache)(Ie({responseId:e.meta.entity_id}).queryKey);for(const t of e.data.data)"create"===t.action||"update"===t.action?a.push(t.id):"delete"===t.action&&s.push(t.id);a.length>0&&((e,t)=>{(async(e,t)=>{if(e&&t.length>0)try{const a=(await y({workspaceId:e,ids:t})).data,s=a.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>s.has(e.id))),r=new Set(t.map((e=>e.id))),o=new Set([...s.keys()].filter((e=>!r.has(e))));return(0,ye.produce)(e,(e=>{const t=e.data.map((e=>r.has(e.id)&&s.get(e.id)||e)),n=a.filter((e=>o.has(e.id)));e.data=[...t,...n]}))}})}catch(e){}})(e,t)})(t,a),s.length>0&&((e,t)=>{(async(e,t)=>{e&&t.length>0&&(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>e?{data:e.data.filter((e=>!t.includes(e.id)))}:e})})(e,t)})(t,s)}},we=({collectionId:e,workspaceId:t,subscribingEntity:a=null})=>{(0,ae.useEffect)((()=>{if(e)return se.subscribe({collectionId:e,workspaceId:t,subscribingEntity:a,subscriptionHandler:ie}),()=>{se.unsubscribe()}}),[e])},be=({workspaceId:e})=>{(0,ae.useEffect)((()=>{if(e)return ue.subscribe({workspaceId:e,subscriptionHandler:fe}),()=>{ue.unsubscribe()}}),[e])};function he({workspaceId:e,select:t}){return(0,C.useDataFetch)(pe({workspaceId:e,select:t}))}const me=({workspaceId:e})=>{const{data:t,isError:a,refetch:s,isRefetching:r}=he({workspaceId:e});return{data:t?t.data:null,refetch:s,hasPageError:a,isRefetching:r}};var ge=a(8722);const ve=(e,t)=>{e&&(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>e?e.data.find((e=>e.id===t.id))?void 0:(0,s.Z)({},e,{data:[...e.data,t]}):e})},qe=(e,t)=>{e&&(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>e?(0,ye.produce)(e,(e=>{const a=e.data.map((e=>e.id===t.id?(0,s.Z)({},e,t):e));e.data=a})):e})},ke={permissions:{userCanDelete:!0,userCanUpdate:!0}},Te={id:(0,ge.v4)(),name:"New Collection",order:[],folders_order:[],folders:[],requests:[]},_e=()=>(0,C.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:a})=>I({workspaceId:e,requestBody:t,signal:a}),onSuccess:(e,t)=>{const a=Object.assign({},Te,e.data,{id:d(e.data.id,e.data.owner)}),r=(0,s.Z)({},a,{attributes:ke});ve(t.workspaceId,r)}}),Ee=()=>(0,C.useMutation)({mutationFn:e=>q({workspaceId:e.workspaceId,collectionId:e.collectionId,signal:e.signal}),onSuccess:async(e,t)=>{try{const a=await y({workspaceId:t.workspaceId,ids:[d(e.data.id,e.data.owner)]});ve(t.workspaceId,a.data[0])}catch(e){}}}),Ce=()=>(0,C.useMutation)({mutationFn:e=>(async({collectionId:e,signal:t})=>{const a=await r.postmanGateway.delete({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/collection/${e}`,signal:t});return await(0,g.deleteDependentSession)({model:"collection",modelId:e}),a})({collectionId:e.collectionId,signal:e.signal}),onSuccess:(e,t)=>{var a,r;a=t.workspaceId,r=t.collectionId,a&&(0,C.updateCache)({key:pe({workspaceId:a}).queryKey,updater:e=>{if(!e)return e;const t=e.data.filter((e=>e.id!==r));return(0,s.Z)({},e,{data:[...t]})}}),t.onSuccess&&t.onSuccess(e)}}),Re=["requests","folders"],Ae=()=>(0,C.useMutation)({mutationFn:e=>v({collectionId:e.collectionId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of Re)delete e[t]})(e),qe(t.workspaceId,e)}catch(e){}}}),Se=e=>{const{data:t}=(0,C.useDataFetch)(V(e));return null!=t?t:{userCanCreate:!0}},Fe=(e,t)=>{const a=e[0],s=e.slice(1);if(!a)return;const r=t.find((e=>e.id===a));return r?s.length>0?Fe(s,r.folders):r:void 0},Pe=()=>(0,C.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:a,collectionId:s})=>(async({requestBody:e,collectionId:t,signal:a})=>h(await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/folder/import`,query:{collection:t},body:JSON.stringify(e),signal:a})))({workspaceId:e,requestBody:t,signal:a,collectionId:s}),onSuccess:(e,t)=>{const a=e.data;((e,t,a,s)=>{e&&(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>e?0===a.length?(0,ye.produce)(e,(e=>{const a=e.data.find((e=>e.id===t));a&&(a.folders_order.includes(s.id)||(a.folders_order.push(s.id),a.folders.push(s)))})):(0,ye.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));if(!r)return;const o=Fe(a,r.folders);o&&(o.folders_order.includes(s.id)||(o.folders_order.push(s.id),o.folders.push(s)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds,a)}}),Le=()=>(0,C.useMutation)({mutationFn:({folderId:e,signal:t})=>(async({folderId:e,signal:t})=>await r.postmanGateway.delete({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/folder/${e}`,signal:t}))({folderId:e,signal:t}),onSuccess:(e,t)=>{var a,s,r,o;a=t.workspaceId,s=t.collectionId,r=t.parentFolderIds,o=t.folderId,a&&(0,C.updateCache)({key:pe({workspaceId:a}).queryKey,updater:e=>e?0===r.length?(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===s));t&&(t.folders_order=t.folders_order.filter((e=>e!==o)),t.folders=t.folders.filter((e=>e.id!==o)))})):(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===s));if(!t)return;const a=Fe(r,t.folders);a&&(a.folders_order=a.folders_order.filter((e=>e!==o)),a.folders=a.folders.filter((e=>e.id!==o)))})):e}),t.onSuccess&&t.onSuccess(e)}}),Oe=()=>(0,C.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:a})=>(async({requestBody:e,signal:t})=>await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/transfer/folder`,body:JSON.stringify(e),signal:t}))({workspaceId:e,requestBody:t,signal:a}),onSuccess:async(e,t)=>{try{const e=await y({workspaceId:t.workspaceId,ids:[t.collectionId]});qe(t.workspaceId,e.data[0])}catch(e){}}}),$e=["requests","folders"],Ge=()=>(0,C.useMutation)({mutationFn:e=>_({folderId:e.folderId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;(e=>{for(const t of $e)delete e[t]})(e),a=t.workspaceId,r=t.collectionId,o=t.parentFolderIds,n=e,a&&(0,C.updateCache)({key:pe({workspaceId:a}).queryKey,updater:e=>e?0===o.length?(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===r));t&&(t.folders=t.folders.map((e=>e.id===n.id?(0,s.Z)({},e,n):e)))})):(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===r));if(!t)return;const a=Fe(o,t.folders);a&&(a.folders=a.folders.map((e=>e.id===n.id?(0,s.Z)({},e,n):e)))})):e})}catch(e){}var a,r,o,n}}),Ue=()=>(0,C.useMutation)({mutationFn:({request:e,signal:t})=>ee({request:e,signal:t}),onSuccess:(e,t)=>{if(t.invalidateListCache)(0,C.invalidateCache)(pe({workspaceId:t.workspaceId}).queryKey);else{if(t.collectionId){const a=e.data;((e,t,a,s)=>{e&&(0,C.updateCache)({key:pe({workspaceId:e}).queryKey,updater:e=>e?0===a.length?(0,ye.produce)(e,(e=>{const a=e.data.find((e=>e.id===t));a&&(a.order.includes(s.id)||(a.order.push(s.id),a.requests.push(s)))})):(0,ye.produce)(e,(e=>{const r=e.data.find((e=>e.id===t));if(!r)return;const o=Fe(a,r.folders);o&&(o.order.includes(s.id)||(o.order.push(s.id),o.requests.push(s)))})):e})})(t.workspaceId,t.collectionId,t.parentFolderIds||[],a)}t.onSuccess&&t.onSuccess(e)}},onSettled:(e,t,a)=>{a.onSettled&&a.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),Ze=()=>(0,C.useMutation)({mutationFn:({requestId:e,signal:t})=>(async({requestId:e,signal:t})=>await r.postmanGateway.delete({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/request/${e}`,signal:t}))({requestId:e,signal:t}),onSuccess:(e,t)=>{var a,s,r,o;a=t.workspaceId,s=t.collectionId,r=t.parentFolderIds,o=t.requestId,a&&(0,C.updateCache)({key:pe({workspaceId:a}).queryKey,updater:e=>e?0===r.length?(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===s));t&&(t.order=t.order.filter((e=>e!==o)),t.requests=t.requests.filter((e=>e.id!==o)))})):(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===s));if(!t)return;const a=Fe(r,t.folders);a&&(a.order=a.order.filter((e=>e!==o)),a.requests=a.requests.filter((e=>e.id!==o)))})):e}),t.onSuccess&&t.onSuccess(e)}}),De=()=>(0,C.useMutation)({mutationFn:({workspaceId:e,requestBody:t,signal:a})=>(async({requestBody:e,signal:t})=>await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/transfer/request`,body:JSON.stringify(e),signal:t}))({workspaceId:e,requestBody:t,signal:a}),onSuccess:async(e,t)=>{try{const e=await y({workspaceId:t.workspaceId,ids:[t.collectionId]});qe(t.workspaceId,e.data[0])}catch(e){}}}),We=()=>(0,C.useMutation)({mutationFn:e=>z({requestId:e.requestId,patch:e.patch,signal:e.signal}),onSuccess:async(e,t)=>{try{const e=t.patch;a=t.workspaceId,r=t.collectionId,o=t.parentFolderIds,n=e,a&&(0,C.updateCache)({key:pe({workspaceId:a}).queryKey,updater:e=>e?0===o.length?(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===r));t&&(t.requests=t.requests.map((e=>e.id===n.id?(0,s.Z)({},e,n):e)))})):(0,ye.produce)(e,(e=>{const t=e.data.find((e=>e.id===r));if(!t)return;const a=Fe(o,t.folders);a&&(a.requests=a.requests.map((e=>e.id===n.id?(0,s.Z)({},e,n):e)))})):e})}catch(e){}var a,r,o,n}}),He=()=>({mutationFn:v,onSuccess:e=>{e.data.id&&e.data.owner&&C.cacheClient.setQueryData([R,d(e.data.id,e.data.owner)],e)}}),Ke=()=>({mutationFn:_,onSuccess:e=>{var t,a;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(a=e.data)&&a.owner&&oe(d(e.data.id,e.data.owner),h(e))}}),Be=(e,t)=>{e&&(0,C.updateCache)({key:Ie({responseId:e}).queryKey,updater:e=>e?(0,ye.produce)(e,(e=>{e.data.name=t.name})):e})},Me=()=>({mutationFn:x,onSuccess:e=>{var t,a;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(a=e.data)&&a.owner&&(C.cacheClient.setQueryData([S,d(e.data.id,e.data.owner)],e),Be(d(e.data.id,e.data.owner),e.data))}}),Ye=()=>({mutationFn:z,onSuccess:e=>{var t,a;null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(a=e.data)&&a.owner&&C.cacheClient.setQueryData([F,d(e.data.id,e.data.owner)],e)}}),Ve=async(e,t)=>{const a=await v(t);return(0,C.updateCache)({key:U({requestId:e}).queryKey,updater:e=>{if(e&&e.data)return(0,s.Z)({},e,{data:(0,s.Z)({},e.data,{collection:a.data})})}}),a},Ne=(0,g.createVariableUpdatesHandler)({model:"collection",hasEditPermission:async e=>{var t,a;const s=await C.cacheClient.fetchQuery(M({collectionId:e})).catch((()=>null));return null==(t=null==s||null==(a=s[K.UPDATE_COLLECTION])?void 0:a.allowed)||t},getValues:async(e,{requestId:t})=>{const a=await C.cacheClient.fetchQuery(U({requestId:t||""})).then((e=>e.data.collection)).catch((()=>null));return a?{id:a.id,values:null==a?void 0:a.variables}:null},setValues:async(e,t,{requestId:a})=>a&&Ve(a,{collectionId:e,patch:{variables:t}})}),xe=async e=>{var t;return(0,g.getActiveSession)({model:"collection",modelId:e.id},{values:null!=(t=e.variables)?t:[]})},je=({responseId:e})=>(0,C.useDataFetch)(Ie({responseId:e})),Qe=e=>{e.workspaceId&&(0,C.updateCache)({key:pe({workspaceId:e.workspaceId}).queryKey,updater:t=>t?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,ye.produce)(t,(t=>{const a=t.data.find((t=>t.id===e.collectionId));if(!a)return;const s=Fe(e.parentFolderIds,a.folders);if(!s)return;const r=s.requests.find((t=>t.id===e.requestId));if(r){var o;const t=e.afterResponseId?r.responses_order.indexOf(e.afterResponseId):r.responses_order.length-1;r.responses_order.splice(null!=(o=e.addAtIndex)?o:t+1,0,e.responseId)}})):(0,ye.produce)(t,(t=>{const a=t.data.find((t=>t.id===e.collectionId));if(!a)return;const s=a.requests.find((t=>t.id===e.requestId));if(s){var r;const t=e.afterResponseId?s.responses_order.indexOf(e.afterResponseId):s.responses_order.length-1;s.responses_order.splice(null!=(r=e.addAtIndex)?r:t+1,0,e.responseId)}})):t})},Je=()=>(0,C.useMutation)({mutationFn:e=>J({requestBody:{ids:[e.responseId],location:{position:"after",model:"response",id:e.responseId},target:{model:"request",id:e.requestId},mode:"copy"}}),onSuccess:async(e,t)=>{Qe({collectionId:t.collectionId,afterResponseId:t.responseId,requestId:t.requestId,responseId:e.data.ids[0],workspaceId:t.workspaceId,parentFolderIds:t.parentFolderIds})}}),Xe=()=>(0,C.useMutation)({mutationFn:e=>Q({responseId:e.responseId,signal:e.signal}),onMutate:e=>({indexOfRemovedResponse:(e=>{if(e.workspaceId){let t=null;return(0,C.updateCache)({key:pe({workspaceId:e.workspaceId}).queryKey,updater:a=>a?e.parentFolderIds&&0!==e.parentFolderIds.length?(0,ye.produce)(a,(a=>{const s=a.data.find((t=>t.id===e.collectionId));if(!s)return;const r=Fe(e.parentFolderIds,s.folders);if(!r)return;const o=r.requests.find((t=>t.id===e.requestId));o&&(t=o.responses_order.indexOf(e.responseId),o.responses_order=o.responses_order.filter((t=>t!==e.responseId)))})):(0,ye.produce)(a,(a=>{const s=a.data.find((t=>t.id===e.collectionId));if(!s)return;const r=s.requests.find((t=>t.id===e.requestId));r&&(t=r.responses_order.indexOf(e.responseId),r.responses_order=r.responses_order.filter((t=>t!==e.responseId)))})):a}),t}return null})({responseId:e.responseId,requestId:e.requestId,collectionId:e.collectionId,parentFolderIds:e.parentFolderIds,workspaceId:e.workspaceId})}),onSuccess:(e,t)=>{C.cacheClient.removeQueries([{queryKey:Ie({responseId:t.responseId}),exact:!0}]),t.onSuccess&&t.onSuccess()},onError:(e,t,a)=>{Qe({responseId:t.responseId,requestId:t.requestId,collectionId:t.collectionId,parentFolderIds:t.parentFolderIds,workspaceId:t.workspaceId,addAtIndex:null==a?void 0:a.indexOfRemovedResponse})}}),ze=async({response:e,populateRequestObject:t,signal:a})=>{if(!e)throw new Error("CollectionService~createResponse: invalid parameters");let s;return t&&(s={populateRequestObject:!0}),h(await r.postmanGateway.post({url:`${o.Z.HTTPS_GATEWAY_PRIVATE_URL}/response/import`,query:s,body:JSON.stringify(e),signal:a}))},et=()=>(0,C.useMutation)({mutationFn:async e=>{if(e.responsePayload)return ze({response:e.responsePayload,signal:e.signal});const t={id:(0,ge.v4)(),request:e.requestId,name:e.name||"Untitled"};return ze({response:t,populateRequestObject:!0,signal:e.signal})},onSuccess:(e,t)=>{if(t.collectionId&&t.workspaceId){const a=e.data;Qe({workspaceId:t.workspaceId,collectionId:t.collectionId,requestId:t.requestId,parentFolderIds:t.parentFolderIds,responseId:a.id})}t.onSuccess&&t.onSuccess(e)},onSettled:(e,t,a)=>{a.onSettled&&a.onSettled()},onError:(e,t)=>{t.onError&&t.onError(e)}}),tt=()=>(0,C.useMutation)({mutationFn:e=>x(e),onMutate:e=>{const t=C.cacheClient.getQueryData(Ie({responseId:e.responseId}).queryKey);if(t){const a={id:t.data.id,name:t.data.name};return Be(e.responseId,{id:e.responseId,name:e.patch.name}),{reversePatch:a}}return{}},onSuccess:e=>{var t,a;if(null!=e&&null!=(t=e.data)&&t.id&&null!=e&&null!=(a=e.data)&&a.owner){const t=C.cacheClient.getQueryData([S,d(e.data.id,e.data.owner)]);if(t){const a=(0,ye.produce)(t,(t=>{t.data.name=e.data.name}));C.cacheClient.setQueryData([S,d(e.data.id,e.data.owner)],a)}Be(d(e.data.id,e.data.owner),e.data)}},onError:(e,t,a)=>{null!=a&&a.reversePatch&&Be(t.responseId,a.reversePatch)}}),at=(e,t,a,s)=>{const r=[];let o,n;if(t&&"object"==typeof t){const{id:a,name:s}=t;a&&s&&(o={id:a,name:s,entityType:"collection",workspaceId:e},r.push(o))}if(a&&"object"==typeof a){const t=a=>{if(a){const{id:s,name:o,folder:n}=a;n&&t(n),s&&o&&r.push({id:s,name:o,entityType:"folder",workspaceId:e})}};t(a)}if(s&&"object"==typeof s){const{id:t,name:a}=s;t&&a&&(n={id:t,name:a,entityType:"request",workspaceId:e},r.push(n))}return r},st=!0},9730:()=>{}}]);
//# sourceMappingURL=1303.b07c42a3c929207f.js.map