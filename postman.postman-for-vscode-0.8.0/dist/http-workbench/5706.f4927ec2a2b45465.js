(self.webpackChunkhttp_workbench=self.webpackChunkhttp_workbench||[]).push([[5706],{6282:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ACCESS_TOKENS_KEY:()=>Ke,AUTH_OPTIONS:()=>A,AuthPanel:()=>Ta,OAuth2TokenFetcher:()=>yt,composeAuthSessionId:()=>Aa,decomposeAuthSessionId:()=>ja,defaultAuthSession:()=>Va,getAllOAuth2AccessTokens:()=>Ge,getAuthSession:()=>Sa,getAuthSessionById:()=>Ra,getOAuth2AccessToken:()=>He,getStorage:()=>Ia,getTokenIdForAuthSession:()=>za,getTokenStorage:()=>Ye,getTokenValuesForAuthSession:()=>Ea,getTokenValuesForTokenId:()=>Fa,hasAuthSession:()=>Ca,isTokenAutoRefreshable:()=>ct,isTokenExpired:()=>lt,removeOAuth2AccessToken:()=>Me,removeSession:()=>Ua,setAuthSession:()=>qa,setAuthSessionById:()=>Pa,setOAuth2AccessToken:()=>Je,subscribeToAuthSession:()=>Oa,subscribeToOAuth2AccessTokens:()=>Qe,supportedAuthOptions:()=>j,updateOAuth2Token:()=>We,useAuthSession:()=>Na,useAuthSessionSafe:()=>Ba,useOAuth2Tokens:()=>bt});var n=a(40540),r=a.n(n),s=a(25892),o=a.n(s),i=a(7560),l=a(50916),u=a(58560),c=a(37110),h=a(68206),d=a(64382),p=a(63622),k=a(79233),m=a(52322);let v,f,y,b=e=>e;const g=o()(h.Z)(v||(v=b`
  &:not(:focus) {
    border-color: var(--border-color-default);
    background-color: var(--background-color-secondary);
  }
`)),x=({name:e,label:t,onChange:a,value:n,type:r="text"})=>(0,k.usePostmanInputFeatureFlag)()?(0,m.jsx)(k.AuthInput,{onChange:t=>{a(t,e)},suggestions:[],value:n,placeholder:t,ariaLabel:t,dataTestId:`${e}-input`}):(0,m.jsx)(g,{onChange:t=>{a(t.target.value,e)},name:e,value:n,placeholder:t,type:r,"data-testid":`${e}-input`}),_=o()(d.Z)(f||(f=b`
  .aether-dropdown__control:not(:focus) {
    border-color: var(--border-color-default);
    background-color: var(--background-color-secondary);
  }
  .aether-dropdown__control .aether-dropdown__single-value {
    color: var(--content-color-secondary);
    font-weight: 600;
    font-size: var(--text-size-s);
  }
`)),T=o()(p.ZP)(y||(y=b`
  color: var(--content-color-primary);
`)),A={apikey:"apikey",basic:"basic",bearer:"bearer",noauth:"noauth",inherit:"inherit"},j=[{label:"Inherit auth from parent",value:"inherit"},{label:"No Auth",value:"noauth"},{label:"API Key",value:"apikey"},{label:"Basic Auth",value:"basic"},{label:"Bearer Token",value:"bearer"},{label:"OAuth 2.0",value:"oauth2"}],w=[{label:"JWT Bearer",value:"jwt"},{label:"Digest Auth",value:"digest"},{label:"OAuth 1.0",value:"oauth1"},{label:"Hawk Authentication",value:"hawk"},{label:"AWS Signature",value:"awsv4"},{label:"NTLM Authentication [Beta]",value:"ntlm"},{label:"Akamai EdgeGrid",value:"edgegrid"}];var R=a(26081),S=a(71453);let C;const P=o()(R.Link)(C||(C=(e=>e)`
  display: inline-flex;
  align-items: center;
  text-decoration: underline;
  color: var(--content-color-secondary);
`)),q=()=>(0,m.jsxs)(P,{type:"link-default",to:"https://go.pstmn.io/docs-auth",target:"_blank",rel:"noopener noreferer",children:["authorization",(0,m.jsx)(S.Z,{})]}),U=()=>{const e=(0,n.useContext)(_a).authState;return(0,n.useMemo)((()=>w.find((t=>t.value===e.activeAuthType))),[e])},O=()=>{const e=r().useContext(_a).disabledAuthTypes;return j.filter((t=>!(null!=e&&e.includes(t.value))))};let I,Z,E,z,F=e=>e;const V=o().div(I||(I=F`
  flex: 0.35;
  padding: var(--spacing-m);
  border-right: var(--border-width-default) var(--border-style-solid)
    var(--border-color-default);
  height: 100%;
  box-sizing: border-box;
`)),N=o()(u.Z)(Z||(Z=F`
  align-items: center;
  padding: var(--spacing-s) var(--spacing-zero);
  flex-wrap: wrap;
`)),B=o().div(E||(E=F`
  flex: 1;
`)),D=o().div(z||(z=F`
  padding: var(--spacing-s) var(--spacing-zero);
`)),L=(0,l.observer)((()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,n=O(),s=U();return(0,m.jsxs)(V,{"data-testid":"auth-type-selector",children:[(0,m.jsxs)(N,{children:[(0,m.jsx)(B,{children:(0,m.jsx)(c.Z,{text:"Type",htmlFor:"auth-type-selector-dropdown"})}),(0,m.jsx)(B,{children:(0,m.jsx)(_,{onChange:({value:e})=>{a((0,i.Z)({},t,{activeAuthType:e}))},options:n,value:n.find((e=>e.value===t.activeAuthType)),id:"auth-type-selector-dropdown",isSearchable:!1,isClearable:!1,viaPortal:!0,placeholder:s?s.label:""})})]}),"noauth"!==t.activeAuthType&&(0,m.jsxs)(D,{children:["The authorization header will be automatically generated when you send the request. Learn more about"," ",(0,m.jsx)(q,{})]})]})}));let $;const K=o()(u.Z)($||($=(e=>e)`
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;
`)),H=()=>(0,m.jsx)(K,{children:"This request is not inheriting any authorization helper at the moment."});let G,J,M=e=>e;const W=o()(u.Z)(G||(G=M`
  align-items: center;
  padding-top: var(--spacing-s);
  max-width: 500px;
`)),Q=o().div(J||(J=M`
  flex: 1;
`)),Y=(0,l.observer)((()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,s=(0,n.useCallback)((e=>{if(!e)return a((0,i.Z)({},t,{bearer:[]}));a((0,i.Z)({},t,{bearer:[{key:"token",value:e}]}))}),[t,a]),o=(0,n.useMemo)((()=>{var e;return(null==(e=t.bearer)||null==(e=e.find((e=>"token"===e.key)))?void 0:e.value)||""}),[t]);return(0,m.jsxs)(W,{"data-testid":"bearer-auth",children:[(0,m.jsx)(Q,{children:(0,m.jsx)(T,{children:"Token"})}),(0,m.jsx)(Q,{children:(0,m.jsx)(x,{name:"token",label:"token",value:o,onChange:s})})]})}));let X,ee,te=e=>e;const ae=o()(u.Z)(X||(X=te`
  align-items: center;
  padding-top: var(--spacing-s);
  max-width: 500px;
`)),ne=o().div(ee||(ee=te`
  flex: 1;
`)),re=[{key:"username",label:"Username",type:"text"},{key:"password",label:"Password",type:"password"}],se=(0,l.observer)((()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,s=(0,n.useCallback)(((e,n)=>{var r;if(!e)return a((0,i.Z)({},t,{basic:(null==(r=t.basic)?void 0:r.filter((e=>e.key!==n)))||null}));const s=[...t.basic||[]],o=s.findIndex((e=>e.key===n));if(-1===o)return a((0,i.Z)({},t,{basic:[...t.basic||[],{key:n,value:e}]}));s[o].value=e,a((0,i.Z)({},t,{basic:s}))}),[t,a]),o=e=>{var a;return(null==(a=t.basic)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,m.jsx)(m.Fragment,{children:re.map((({key:e,label:t,type:a})=>(0,m.jsxs)(ae,{"data-testid":"basic-input",children:[(0,m.jsx)(ne,{children:(0,m.jsx)(T,{children:t})}),(0,m.jsx)(ne,{children:(0,m.jsx)(x,{name:e,label:t,value:o(e),onChange:s,type:a})})]},e)))})}));let oe,ie,le=e=>e;const ue=o()(u.Z)(oe||(oe=le`
  align-items: center;
  padding-top: var(--spacing-s);
  max-width: 500px;
`)),ce=o().div(ie||(ie=le`
  flex: 1;
`)),he=[{key:"key",label:"Key"},{key:"value",label:"Value"},{key:"in",label:"Add To",type:"select",options:[{label:"Headers",value:""},{label:"Query Params",value:"query"}]}],de=(0,l.observer)((()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,s=(0,n.useCallback)(((e,n)=>{var r;if(!e)return a((0,i.Z)({},t,{apikey:(null==(r=t.apikey)?void 0:r.filter((e=>e.key!==n)))||null}));const s=[...t.apikey||[]],o=s.findIndex((e=>e.key===n));if(-1===o)return a((0,i.Z)({},t,{apikey:[...t.apikey||[],{key:n,value:e}]}));s[o].value=e,a((0,i.Z)({},t,{apikey:s}))}),[t,a]),o=(0,n.useCallback)((e=>{var n;return e.value?a((0,i.Z)({},t,{apikey:[...t.apikey||[],{key:"in",value:e.value}]})):a((0,i.Z)({},t,{apikey:(null==(n=t.apikey)?void 0:n.filter((e=>"in"!==e.key)))||null}))}),[t,a]),l=e=>{var a;return(null==(a=t.apikey)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,m.jsx)(m.Fragment,{children:he.map((({key:e,label:a,type:n,options:r})=>{return(0,m.jsxs)(ue,{"data-testid":"apikey-input",children:[(0,m.jsx)(ce,{children:(0,m.jsx)(T,{children:a})}),(0,m.jsx)(ce,{children:"select"===n&&null!=r&&r.length?(0,m.jsx)(_,{isClearable:!1,options:r,value:(null==(i=t.apikey)?void 0:i.find((e=>"in"===e.key)))?{label:"Query Params",value:"query"}:{label:"Headers",value:""},onChange:o,name:e,"aria-label":"add auth to",viaPortal:!0}):(0,m.jsx)(x,{name:e,label:a,value:l(e),onChange:s})})]},e);var i}))})}));var pe=a(74962),ke=a(36306),me=a(1078),ve=a(81397),fe=a(80605),ye=a(84492),be=a(32018),ge=a.n(be),xe=a(48722),_e=a(9029),Te=a(54302),Ae=a(5634);const je="authorization_code",we="authorization_code_with_pkce",Re="implicit",Se={authorization_code:"Authorization Code",authorization_code_with_pkce:"Authorization Code (With PKCE)",implicit:"Implicit",password_credentials:"Password Credentials",client_credentials:"Client Credentials"},Ce={S256:"SHA-256",plain:"Plain"},Pe={header:"Send as Basic Auth header",body:"Send client credentials in body"},qe="request_url",Ue="request_body",Oe="request_header",Ie={[Ue]:"Request Body",[qe]:"Request URL",[Oe]:"Request Headers"},Ze={grant_type:Se,client_authentication:Pe,challengeAlgorithm:Ce},Ee={header:"Request Headers",queryParams:"Request URL"},ze="id_token",Fe="access_token",Ve={[Fe]:"Access token",[ze]:"ID token"},Ne={accessTokenUrl:"",refreshTokenUrl:"",refreshToken:"",client_authentication:"header",authUrl:"",clientId:"",clientSecret:"",grant_type:"authorization_code",password:"",redirect_uri:ye.Z.OAUTH2_CALLBACK_URL,scope:"",state:"",username:"",challengeAlgorithm:"S256",code_verifier:"",name:"Untitled Token",authRequestParams:[],tokenRequestParams:[],refreshRequestParams:[],addTokenTo:"header"},Be=[{key:"tokenName",label:"Token Name"},{key:"grant_type",label:"Grant Type",type:"select",options:Object.keys(Se).map((e=>({label:Se[e],value:e})))},{key:"redirect_uri",label:"Callback URL",disabled:!0},{key:"authUrl",label:"Auth URL"},{key:"accessTokenUrl",label:"Access Token URL"},{key:"clientId",label:"Client ID"},{key:"clientSecret",label:"Client Secret"},{key:"username",label:"Username"},{key:"password",label:"Password"},{key:"challengeAlgorithm",label:"Code Challenge Method",type:"select",options:Object.keys(Ce).map((e=>({label:Ce[e],value:e})))},{key:"code_verifier",label:"Code Verifier"},{key:"scope",label:"Scope"},{key:"state",label:"State"},{key:"client_authentication",label:"Client Authentication",type:"select",options:Object.keys(Pe).map((e=>({label:Pe[e],value:e})))}],De={authorization_code:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","scope","state","client_authentication"]),authorization_code_with_pkce:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","challengeAlgorithm","code_verifier","scope","state","client_authentication"]),implicit:new Set(["tokenName","grant_type","redirect_uri","authUrl","clientId","scope","state","client_authentication"]),password_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","username","password","scope","client_authentication"]),client_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","scope","client_authentication"])};var Le=a(50747);const $e=new Le.KVStorage("oauth2-access-tokens"),Ke="access-tokens",He=async e=>{const t=await $e.get(Ke);return t?t[e]:null},Ge=async()=>await $e.get(Ke)||{},Je=async(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;let r=await $e.get(Ke);return r||(r={}),r[e]=a,$e.set(Ke,r)},Me=async e=>{let t=await $e.get(Ke);return t||(t={}),delete t[e],$e.set(Ke,t)},We=async(e,t)=>{const a=await $e.get(Ke);if(!a||a&&!a[e])return;const n=(0,i.Z)({},a[e].data,t.data),r=(0,i.Z)({},a[e],t);r.data=n,await Je(e,r)},Qe=e=>$e.subscribe(Ke,e),Ye=()=>$e,Xe=(e,t)=>{const a=[];for(const n of e)if(n){const e={key:n.key,value:n.value,enabled:n.enabled,send_as:t};n.options&&(e.send_as=n.options.value),a.push(e)}return a};function et(e){const t=[];for(const a of e)if(a){const e={key:a.key,value:a.value,type:"text",enabled:a.enabled};a.send_as&&(e.options={value:a.send_as,label:Ie[a.send_as]}),t.push(e)}return t}function tt(e,t){if(!e||!Array.isArray(e))return;const a=e.find((e=>(null==e?void 0:e.key)===t&&!0===(null==e?void 0:e.enabled)));return null==a?void 0:a.value}function at(e,t){let a=t;for(const t of e)t.enabled&&(a=`${a}${a.includes("?")?"&":"?"}${t.key}=${t.value}`);return a}function nt(e,t){for(const a of e)if(a.enabled)switch(a.send_as){case qe:t.url=at([a],t.url);break;case Oe:if(!a.key)continue;t.headerData.push({key:a.key,value:a.value,enabled:!0,type:"text"});break;default:t.data.push({key:a.key,value:a.value,enabled:!0,type:"text"})}return t}var rt=a(21219),st=a(24926);const ot=e=>{var t;const a=null==e?void 0:e.timestamp,n=null==e||null==(t=e.data)?void 0:t.expires_in;if(a&&n)return Number(a)+1e3*Number(n)},it=e=>e?{refresh_token:e.data.refresh_token||"",accessTokenUrl:e.data.accessTokenUrl||"",refreshTokenUrl:e.data.refreshTokenUrl||"",clientId:e.data.clientId||"",clientSecret:e.data.clientSecret||"",refreshRequestParams:e.data.refreshRequestParams||""}:null,lt=(e,t)=>{if(!e)return!1;t||(t=0);const a=ot(e);return!!a&&a<Date.now()+1e3*t},ut=e=>{if(!e)return!1;const t=it(e);return(null==t?void 0:t.refresh_token)&&((null==t?void 0:t.refreshTokenUrl)||(null==t?void 0:t.accessTokenUrl))},ct=e=>!!e&&lt(e,59)&&(null==e?void 0:e.isTokenAutoRefreshEnabled)&&ut(e),ht=e=>{let t=e.toString("base64");return t=t.split("=")[0],t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t},dt=e=>{for(const t of Object.keys(Ne))e[t]||(e[t]=ge()(Ne[t]));const{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:r,refreshTokenUrl:s,refresh_token:o,client_authentication:i,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:k,challengeAlgorithm:m,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:b}=e;return{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:r,refreshTokenUrl:s,refreshToken:o,client_authentication:i,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:k,challengeAlgorithm:m,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:b}},pt=new Set(["iso-2022-cn","iso-2022-cn-ext"]),kt="authorization_code",mt="authorization_code_with_pkce",vt="implicit",ft="client_credentials",yt=new class{constructor(){this.tokenGenerationCallback=null,this.tokenRefreshCallback=null,this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null,this.timeoutId=null,this.id=null,this.params=null,Te.VSCodeCommunicationsService.subscribe("OAUTH2_CALLBACK",(e=>{this.handleAuthCallback(e)})),Te.VSCodeCommunicationsService.subscribe("RESOLVED_VARIABLES",(e=>{var t;if(!e)return;const{id:a,resolvedObject:n}=e;a===this.id&&(null==(t=this.resolveVariablesPromiseResolve)||t.call(this,n))}))}async getResolvedParams(e,t,a){if(!t||0===t.length)return e;const n=function(){const e={};return e.promise=new Promise(((t,a)=>{e.resolve=t,e.reject=a})),e}();return this.resolveVariablesPromise=n.promise,this.resolveVariablesPromiseResolve=n.resolve,this.resolveVariablesPromiseReject=n.reject,(0,rt.resolveVariablesInObject)(e,t,a),setTimeout((()=>{var e;null==(e=this.resolveVariablesPromiseReject)||e.call(this,new Error("Failed to resolve variables"))}),1e4),this.resolveVariablesPromise}handleRedirectToBrowser(e){if(!e.startsWith("https")&&!e.startsWith("http"))return this.finishAuthorizationFlow(new Error("Invalid protocol for auth URL. Only HTTP and HTTPS protocol are allowed."));(0,R.openExternalLink)(e)}async startAuthorization(e,t,a){var n;if(this.id)throw new Error("OAuth2 authorization already in progress");let r=e;if(this.id=(0,xe.v4)(),a)try{r=await this.getResolvedParams(ge()(e),a,this.id)}finally{this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null}var s;if(this.params=dt(r),!this.params)return null==(s=this.finishAuthorizationFlow)?void 0:s.call(this,new Error("OAuth2 authorization params not provided"));switch(this.tokenGenerationCallback=t,this.timeoutId=setTimeout((()=>{this.finishAuthorizationFlow(new Error("OAuth2 authorization timed out"))}),3e4),this.params.grant_type){case kt:case mt:return this.handleAuthorizationCodeType();case vt:return this.handleImplicitType();case"password_credentials":return this.handlePasswordCredentialsType();case ft:return this.handleClientCredentialsType();default:return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("Could not complete OAuth 2.0 authorization, grant type is invalid"))}}async refreshTokenByTokenId(e,t){const a=await He(e),n=a&&it(a);n&&this.refreshToken(n,t)}async refreshToken(e,t){if(this.id)throw new Error("OAuth2 authorization already in progress");this.params=dt(e);const a=(0,xe.v4)();var n;if(this.id=a,this.tokenRefreshCallback=t,!this.params)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2 authorization params not provided"));this.timeoutId=setTimeout((()=>{this.finishRefreshFlow(new Error("OAuth2 authorization timed out"))}),3e4);const r=this.params.refreshTokenUrl||this.params.accessTokenUrl,s=tt(this.params.refreshRequestParams,"grant_type"),o=tt(this.params.refreshRequestParams,"refresh_token"),i=this.getOAuth2TokenRequest(r);!o&&i.data.push({key:"refresh_token",value:this.params.refreshToken,enabled:!0,type:"text"}),!s&&i.data.push({key:"grant_type",value:"refresh_token",enabled:!0,type:"text"}),this.addClientAuthentication(i,this.params);const l=nt(this.params.refreshRequestParams,i);this.requestAccessToken(l,{refresh:!0})}handleClientCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),r=tt(e.tokenRequestParams,"grant_type"),s=tt(e.tokenRequestParams,"scope"),o=tt(e.tokenRequestParams,"client_id"),i=tt(e.tokenRequestParams,"client_secret");!r&&n.data.push({key:"grant_type",value:ft,type:"text",enabled:!0}),!s&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),(!o||!i)&&this.addClientAuthentication(n,e);const l=nt(e.tokenRequestParams,n);this.requestAccessToken(l)}handlePasswordCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl||"string"!=typeof e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),r=tt(e.tokenRequestParams,"grant_type"),s=tt(e.tokenRequestParams,"username"),o=tt(e.tokenRequestParams,"password"),i=tt(e.tokenRequestParams,"scope"),l=tt(e.tokenRequestParams,"client_id"),u=tt(e.tokenRequestParams,"client_secret"),c=tt(e.tokenRequestParams,"redirect_uri");(!l||!u)&&this.addClientAuthentication(n,e),!r&&n.data.push({key:"grant_type",value:"password",type:"text",enabled:!0}),!s&&n.data.push({key:"username",value:e.username,type:"text",enabled:!0}),!o&&n.data.push({key:"password",value:e.password,type:"text",enabled:!0}),!i&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),!c&&n.data.push({key:"redirect_uri",value:e.redirect_uri,type:"text",enabled:!0});const h=nt(e.tokenRequestParams,n);this.requestAccessToken(h)}handleAuthorizationCodeType(){if(!this.params)return;let e=this.params.authUrl;if(!e)return this.finishAuthorizationFlow(new Error("Auth URL not found"));const t=tt(this.params.authRequestParams,"response_type"),a=tt(this.params.authRequestParams,"client_id"),n=tt(this.params.authRequestParams,"state"),r=tt(this.params.authRequestParams,"scope"),s=tt(this.params.authRequestParams,"redirect_uri");if(e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("code")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!r&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!s&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),this.params.grant_type===mt){const t=tt(this.params.authRequestParams,"code_challenge"),a=tt(this.params.authRequestParams,"code_challenge_method");this.params.code_verifier=this.params.code_verifier||((e=32)=>{const t=Ae.O6(e);return ht(t)})(),!t&&(e+=`&code_challenge=${encodeURIComponent(((e,t)=>{if(!e||"plain"===t)return e||"";const a=Ae.js("sha256").update(e).digest();return ht(a)})(this.params.code_verifier,this.params.challengeAlgorithm))}`),!a&&(e+=`&code_challenge_method=${encodeURIComponent(this.params.challengeAlgorithm)}`)}e=at(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleImplicitType(){if(!this.params)return;let e=this.params.authUrl;const t=tt(this.params.authRequestParams,"response_type"),a=tt(this.params.authRequestParams,"client_id"),n=tt(this.params.authRequestParams,"state"),r=tt(this.params.authRequestParams,"scope"),s=tt(this.params.authRequestParams,"redirect_uri");e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("token")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!r&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!s&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),e=at(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleAuthCallback(e){if(!this.params||!this.id)return;var t,a,n,r;if(this.params.grant_type===vt)return e.access_token?null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,null,e):null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher~Implicit: access_token not found"));if(!e.code)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2TokenFetcher: code not found"));if(!this.params.accessTokenUrl)return null==(r=this.finishAuthorizationFlow)?void 0:r.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const s=tt(this.params.tokenRequestParams,"grant_type"),o=tt(this.params.tokenRequestParams,"client_id"),i=tt(this.params.tokenRequestParams,"client_secret"),l=tt(this.params.tokenRequestParams,"redirect_uri"),u=tt(this.params.tokenRequestParams,"code_verifier"),c=tt(this.params.tokenRequestParams,"code"),h=this.getOAuth2TokenRequest(this.params.accessTokenUrl);!s&&h.data.push({key:"grant_type",value:kt,type:"text",enabled:!0}),!c&&h.data.push({key:"code",value:e.code,type:"text",enabled:!0}),!l&&h.data.push({key:"redirect_uri",value:this.params.redirect_uri,type:"text",enabled:!0}),this.params.grant_type===mt&&!u&&h.data.push({key:"code_verifier",value:this.params.code_verifier,type:"text",enabled:!0}),(!o||!i)&&this.addClientAuthentication(h,this.params);const d=nt(this.params.tokenRequestParams,h);this.requestAccessToken(d)}addClientAuthentication(e,t){if("body"!==t.client_authentication)e.auth={type:"basic",basic:[{key:"username",value:t.clientId},{key:"password",value:t.clientSecret}]};else{if(e.data.push({key:"client_id",value:t.clientId,enabled:!0,type:"string"}),t.grant_type===mt&&!t.clientSecret)return;e.data.push({key:"client_secret",value:t.clientSecret,enabled:!0,type:"string"})}}getOAuth2TokenRequest(e){if(!this.params||!this.id)throw new Error("OAuth2TokenFetcher: params or id not found");return{id:this.id,method:"POST",dataMode:"urlencoded",url:e,headerData:[{key:"Content-Type",value:"application/x-www-form-urlencoded",type:"text",enabled:!0}],auth:{type:"noauth"},data:[]}}finishAuthorizationFlow(e,t){var a;if(!this.id||!this.params)throw new Error("OAuth2TokenFetcher: params or id not found");const n=this.params.tokenName||"Untitled Token",r=this.params.accessTokenUrl,s=this.params.refreshTokenUrl,o=this.params.clientId,l=this.params.clientSecret,u=this.params.refreshRequestParams;var c,h;if(this.id=null,this.params=null,this.timeoutId&&clearTimeout(this.timeoutId),e)return null==(c=this.tokenGenerationCallback)?void 0:c.call(this,e);if(!t)return null==(h=this.tokenGenerationCallback)?void 0:h.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));const d={name:n||"Untitled Token",id:(0,xe.v4)(),timestamp:Date.now(),data:(0,i.Z)({},t,{accessTokenUrl:r,clientId:o,clientSecret:l,refreshRequestParams:u,refreshTokenUrl:s})};null==(a=this.tokenGenerationCallback)||a.call(this,null,d)}finishRefreshFlow(e,t){var a;if(this.id||this.params){var n,r;if(this.id=null,this.params=null,e)return null==(n=this.tokenRefreshCallback)?void 0:n.call(this,e);if(this.timeoutId&&clearTimeout(this.timeoutId),!t)return null==(r=this.tokenRefreshCallback)?void 0:r.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));null==(a=this.tokenRefreshCallback)||a.call(this,null,t)}}async requestAccessToken(e,t){var a=this;(0,_e.sendRequestViaAgent)(e,{variables:{},runOptionsOverrides:{timeout:{global:null,request:3e4,script:null}},exception:({error:e})=>null!=t&&t.refresh?this.finishRefreshFlow(e):this.finishAuthorizationFlow(e),response:async function({error:e,response:n}){if(e)return null!=t&&t.refresh?a.finishRefreshFlow(e):void a.finishAuthorizationFlow(e);if(!n||!n.stream)return null!=t&&t.refresh?a.finishRefreshFlow(new Error("OAuth2TokenFetcher: response not found")):a.finishAuthorizationFlow(new Error("OAuth2TokenFetcher: response not found"));n.stream instanceof ArrayBuffer&&(n.stream=new Uint8Array(n.stream));const r=(s=n.stream,o=n.contentInfo.charset,pt.has(o)?"":("utf-16"===o&&s.length>=2&&254===s[0]&&255===s[1]&&(o="utf-16be"),new TextDecoder(o||"utf8").decode(s)));var s,o;return null!=t&&t.refresh?a.finishRefreshFlow(null,JSON.parse(r)):a.finishAuthorizationFlow(null,JSON.parse(r))},console:()=>null,start:()=>null,responseStart:()=>null,assertion:()=>null,script:()=>null})}},bt=()=>{const{value:e,setValue:t}=(0,Le.useKVStorage)(Ye(),Ke),a=(a,n)=>{const r=null==e?void 0:e[a];if(r){for(const e of Object.keys(n.data))r.data[e]=n.data[e];return n.name&&(r.name=n.name),n.timestamp&&(r.timestamp=n.timestamp),e[a]=r,t(e)}};return{oAuth2Tokens:e,createOAuth2Token:(a,n)=>{const r=e||{};return r[a]=n,t(r)},updateOAuth2Token:a,updateKeyInOAuth2Token:(t,n,r)=>{const s=null==e?void 0:e[t];s&&(s.data[n]=r,a(t,s))},deleteOAuth2TokenById:a=>{if(null==e?void 0:e[a])return delete e[`${a}`],t(e)},deleteAllOAuth2Token:()=>t({}),deleteAllExpiredOAuth2Token:()=>{if(e){for(const[t,a]of Object.entries(e))lt(a)&&delete e[`${t}`];return t(e)}}}};let gt,xt,_t=e=>e;const Tt=o()(u.Z)(gt||(gt=_t`
  align-items: center;
  padding-top: var(--spacing-s);
  padding-bottom: var(--spacing-s);
  max-width: 500px;
`)),At=o().div(xt||(xt=_t`
  flex: 1;
`)),jt=()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,n=(e,n)=>{if(!e)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const r=[...t.oauth2],s=r.findIndex((e=>e.key===n));if(-1===s)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));const o=[...r];return o[s]={key:r[s].key,value:e},a((0,i.Z)({},t,{oauth2:o}))},s=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||Ne[e]},o=(e,r,o,l,u)=>"redirect_uri"===e?(0,m.jsx)(g,{onChange:e=>{n(e.target.value,e.target.name)},name:e,value:s(e),placeholder:r,isDisabled:u}):"select"===o?l&&0!==(null==l?void 0:l.length)?(0,m.jsx)(_,{isClearable:!1,options:l,value:{value:s(e),label:Ze[e][s(e)]},onChange:n=>{((e,n)=>{if(!n.value)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((t=>t.key!==e))}));const r=[...t.oauth2],s=r.findIndex((t=>t.key===e));if(-1===s)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:e,value:n.value}]}));const o=[...r];o[s]={key:r[s].key,value:n.value},a((0,i.Z)({},t,{oauth2:o}))})(e,n)},name:e,"aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1}):null:(0,m.jsx)(x,{onChange:(e,t)=>{n(e,t)},name:e,value:s(e),label:r});return(0,m.jsx)(m.Fragment,{children:Be.filter((({key:e})=>De[s("grant_type")].has(e))).map((({key:e,label:t,type:a,options:n,disabled:r})=>(0,m.jsxs)(Tt,{"data-testid":`oauth2-input-${e}`,children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:t})}),(0,m.jsx)(At,{children:o(e,t,a,n,r)})]},e)))})};var wt=a(35736),Rt=a(35482),St=a(70068),Ct=a(15837);let Pt,qt,Ut,Ot=e=>e;const It=o().div(Pt||(Pt=Ot`
  display: flex;
  margin-top: var(--spacing-xs);
  align-items: center;
  justify-content: left;
`)),Zt=o()(p.ZP)(qt||(qt=Ot`
  margin-left: var(--spacing-xs);
  margin-right: var(--spacing-xs);
`)),Et=o()(wt.Z)(Ut||(Ut=Ot`
  margin-left: var(--spacing-xs);
`)),zt=()=>{var e,t;const a=r().useContext(_a).authSessionState,[s,o]=(0,n.useState)(!1),{oAuth2Tokens:l,updateOAuth2Token:u}=bt(),c=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,h=c?null==l?void 0:l[c]:null,d=(e,t)=>{if(e)return void o(!1);if(!t)return void o(!1);const a=h;a&&(a.data=(0,i.Z)({},a.data,t.access_token&&{access_token:t.access_token},t.id_token&&{id_token:t.id_token},t.refresh_token&&{refresh_token:t.refresh_token},t.expires_in&&{expires_in:t.expires_in},t.token_type&&{token_type:t.token_type}),a.timestamp=Date.now(),u(a.id,a),o(!1),Ct.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh_successful",label:"oauth2"}))},k=()=>{if(!h)return;const e=it(h);e?(o(!0),yt.refreshToken(e,d),Ct.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh",label:"oauth2"})):o(!1)};if(null==h||null==(t=h.data)||!t.refresh_token)return null;const v=ot(h)||0,f=Date.now(),y=it(h),b=ut(h);if(!y||!b)return;if(s)return(0,m.jsxs)(It,{children:[(0,m.jsx)(p.ZP,{hasBottomSpacing:!0,color:"content-color-secondary",children:"Refreshing token"}),(0,m.jsx)(Et,{})]});if(!v)return(0,m.jsx)(It,{children:(0,m.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:k,children:"Refresh"})})});const g=Number(v),x=new Date(g).toDateString()===new Date(f).toDateString();let _=null;if(lt(h))_=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Rt.Z,{name:"icon-state-error-stroke",color:"content-color-error"}),(0,m.jsx)(Zt,{hasBottomSpacing:!0,color:"content-color-error",children:"Token expired."})]});else if(x){const e=(e=>`Expires at ${(0,st.format)(e,"h:mm aaaa")} today.`)(g);_=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(St.Z,{color:"content-color-secondary"}),(0,m.jsx)(Zt,{hasBottomSpacing:!0,color:"content-color-secondary",children:e})]})}return(0,m.jsxs)(It,{children:[_,(0,m.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:k,children:"Refresh"})})]})},Ft=()=>{var e,t;const a=r().useContext(_a).authSessionState,{oAuth2Tokens:n,updateKeyInOAuth2Token:s}=bt(),o=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,i=o?null==n?void 0:n[o]:null,l=(null==i||null==(t=i.data)?void 0:t.token_key)||Fe;if(null!=i&&i.data[ze])return(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-token-key",children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Token Type"})}),(0,m.jsx)(At,{children:(0,m.jsx)(_,{isClearable:!1,options:Object.keys(Ve).map((e=>({value:e,label:Ve[e],isOptionDisabled:e=>{var t;return null==i||null==(t=i.data)?void 0:t[null==e?void 0:e.value]}}))),placeholder:"Select Token Type",value:{value:l,label:Ve[l]},onChange:e=>(e=>{i&&s(i.id,"token_key",e.value)})(e),name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"token_key")};var Vt=a(56415),Nt=a(3341);let Bt;const Dt=o().div(Bt||(Bt=(e=>e)`
  display: flex;
  align-items: center;
  cursor: pointer;
  margin-bottom: var(--spacing-xs);
  margin-top: var(--spacing-xs);
`)),Lt=e=>{const{onToggleAdvancedFields:t,title:a,isOpen:n}=e;return(0,m.jsxs)(Dt,{onClick:()=>t(),children:[n?(0,m.jsx)(Vt.Z,{}):(0,m.jsx)(Nt.Z,{}),(0,m.jsx)("div",{children:(0,m.jsx)(c.Z,{type:"primary",text:a||"Advanced configuration"})})]})};var $t=a(96497);const Kt=()=>{const e=r().useContext(_a),t=e.authState,a=e.setAuthState,n=(e,n)=>{const r=[...t.oauth2],s=r.findIndex((t=>t.key===e));return-1===s||(r[s].value=n,a((0,i.Z)({},t,{oauth2:r}))),a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:e,value:n}]}))},s=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||Ne[e]},o=s("authRequestParams"),l=s("tokenRequestParams"),c=s("refreshRequestParams"),h=Object.keys(Ie).map((e=>({value:e,label:Ie[e]}))),d=s("grant_type"),p=[je,we,Re].includes(d),k=d!==Re;return(0,m.jsxs)(u.Z,{direction:"column",children:[(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-refreshTokenUrl",children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Refresh Token URL"})}),(0,m.jsx)(At,{children:(0,m.jsx)(x,{onChange:(e,n)=>{((e,n)=>{if(!e)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const r=[...t.oauth2],s=r.findIndex((e=>e.key===n));if(-1===s)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));r[s].value=e,a((0,i.Z)({},t,{oauth2:r}))})(e,n)},name:"refreshTokenUrl",value:s("refreshTokenUrl"),label:s("refreshTokenUrl")||"Enter Refresh Token URL"})})]},"refreshTokenUrl"),p&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tt,{"data-testid":"oauth2-input-authRequestParams",children:(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Auth Request"})})},"authRequestParams"),(0,m.jsx)(At,{children:(0,m.jsx)($t.KeyValueEditor,{tableName:"Auth Request",allowedColumns:["key","value"],showColumns:["key","value"],values:et(o),onChange:e=>{n("authRequestParams",Xe(e,qe))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:[{label:"Text",value:"text"}]})})]}),k&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tt,{"data-testid":"oauth2-input-tokenRequestParams",children:(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Token Request"})})},"tokenRequestParams"),(0,m.jsx)(At,{children:(0,m.jsx)($t.KeyValueEditor,{tableName:"Token Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:et(l),onChange:e=>{n("tokenRequestParams",Xe(e,Ue))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:h})})]}),(0,m.jsx)(Tt,{"data-testid":"oauth2-input-refreshRequestParams",children:(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Refresh Request"})})},"refreshRequestParams"),(0,m.jsx)(At,{children:(0,m.jsx)($t.KeyValueEditor,{tableName:"Refresh Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:et(c),onChange:e=>{n("refreshRequestParams",Xe(e,Ue))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:h})})]})};var Ht=a(19972);let Gt,Jt,Mt,Wt,Qt,Yt,Xt=e=>e;const ea=o().div(Gt||(Gt=Xt`
  border-bottom: 1px solid var(--border-color-default);
`)),ta=o()(pe.Z)(Jt||(Jt=Xt`
  margin-top: var(--spacing-m);
  margin-bottom: var(--spacing-m);
`)),aa=o()(u.Z)(Mt||(Mt=Xt`
  padding-right: var(--spacing-l);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
  word-break: break-all;
  white-space: nowrap;
`)),na=o().div(Wt||(Wt=Xt`
  display: flex;
  margin-top: var(--spacing-xs);
  align-items: center;
  justify-content: left;
`)),ra=o().div(Qt||(Qt=Xt`
  margin-top: var(--spacing-xxl);
`)),sa=o().div(Yt||(Yt=Xt`
  margin-top: var(--spacing-l);
  margin-right: var(--spacing-l);
  display: flex;
  justify-content: space-between;
`)),oa=()=>{var e;const t=r().useContext(_a),a=t.authState,s=t.authSessionState,o=t.setAuthSessionState,l=t.setAuthState,[u,c]=(0,n.useState)(!1),h=(0,n.useRef)(null),[d,k]=(0,n.useState)(null),[v,f]=(0,n.useState)(!1),{oAuth2Tokens:y,createOAuth2Token:b,updateKeyInOAuth2Token:A,updateOAuth2Token:j}=bt(),{data:w}=(0,rt.useActiveVariables)(),{addToast:S}=(0,ke.ZP)(),C=null==s||null==(e=s.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,P=C?null==y?void 0:y[C]:null,q=e=>{o("token_id",e)};(0,n.useEffect)((()=>{k(null)}),[y,s]);const U=(0,Ht.useActiveWorkspaceId)(),O=(0,R.useNavigate)(),I=e=>{var t;return(null==(t=a.oauth2.find((t=>t.key===e)))?void 0:t.value)||Ne[e]},Z=(e,t)=>t?t.data.error?(c(!1),void S({status:"error",description:"Authentication failed"})):(S({status:"success",description:"Authentication successful"}),b(t.id,t),(e=>{e&&q(e.id)})(t),c(!1),void Ct.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token_successful",label:"oauth2"})):(c(!1),void S({status:"error",description:"Authentication failed"})),E=()=>P&&void 0!==P?{value:null==P?void 0:P.id,label:null==P?void 0:P.name}:null;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-tokens",children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Token"})}),(0,m.jsxs)(At,{children:[(0,m.jsx)(_,{isClearable:!1,options:(()=>{const e=Object.values(y||{}).map((e=>({value:e.id,label:e.name})));return 0===e.length?[]:e})(),placeholder:"Available Tokens",customOptionComponent:e=>{const{label:t}=e;return(0,m.jsxs)(aa,{children:[" ",t," "]})},value:E(),onChange:e=>{null!=e&&e.value&&q(e.value)},name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1},`${E()}`),(0,m.jsx)(na,{children:(0,m.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:()=>{O(`/workspace/${U}/openManageTokensTab`,{},{customNavEvent:R.OPEN_EXTENSION_URL})},children:"Manage Tokens"})})})]})]},"token"),Ft(),(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-token_value",children:[(0,m.jsx)(At,{}),(0,m.jsxs)(At,{children:[(0,m.jsx)(g,{onChange:e=>{const t=e.target.value;k(t),h.current&&clearTimeout(h.current);const a=setTimeout((()=>{(e=>{var t;let a=P;if(!a)return a={id:(0,xe.v4)(),name:"Untitled Token",timestamp:Date.now(),data:{[Fe]:e,token_type:"Bearer"}},b(a.id,a),q(a.id);const n=(null==P||null==(t=P.data)?void 0:t.token_key)===ze?ze:Fe;A(a.id,n,e)})(t),h.current=null}),1e3);h.current=a},name:"access_token",value:(()=>{var e;const t=(null==P||null==(e=P.data)?void 0:e.token_key)===ze?P.data.id_token:null==P?void 0:P.data.access_token;return null!==d?d:t})(),placeholder:"Enter Token Here",isDisabled:!1}),zt()]})]},"token_value"),(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-headerPrefix",children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Header Prefix"})}),(0,m.jsx)(At,{children:(0,m.jsx)(x,{onChange:(e,t)=>{((e,t)=>{if(!e)return l((0,i.Z)({},a,{oauth2:a.oauth2.filter((e=>e.key!==t))}));const n=[...a.oauth2],r=n.findIndex((e=>e.key===t));if(-1===r)return l((0,i.Z)({},a,{oauth2:[...a.oauth2,{key:t,value:e}]}));n[r].value=e,l((0,i.Z)({},a,{oauth2:n}))})(e,t)},name:"headerPrefix",value:I("headerPrefix")||"Bearer",label:"Enter Prefix Here"})})]},"headerPrefix"),(0,m.jsxs)(Tt,{"data-testid":"oauth2-input-addTokenTo",children:[(0,m.jsx)(At,{children:(0,m.jsx)(T,{children:"Add authorization data to"})}),(0,m.jsx)(At,{children:(0,m.jsx)(_,{isClearable:!1,options:Object.keys(Ee).map((e=>({value:e,label:Ee[e]}))),value:{value:I("addTokenTo"),label:Ee[I("addTokenTo")]},onChange:e=>{((e,t)=>{if(!t.value)return l((0,i.Z)({},a,{oauth2:a.oauth2.filter((t=>t.key!==e))}));const n=[...a.oauth2],r=n.findIndex((t=>t.key===e));if(-1===r)return l((0,i.Z)({},a,{oauth2:[...a.oauth2,{key:e,value:t.value}]}));n[r].value=t.value,l((0,i.Z)({},a,{oauth2:n}))})("addTokenTo",e)},name:"addTokenTo","aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"addTokenTo"),(0,m.jsxs)(ra,{children:[(0,m.jsxs)(sa,{children:[(0,m.jsx)(pe.Z,{type:"h6",text:"Auto-refresh token",color:"content-color-secondary"}),(()=>{const e=C?null==y?void 0:y[C]:null,t=e&&ut(e),a=(0,m.jsx)(me.Z,{name:"Refresh Token",onChange:t=>{const a=e;a&&(a.isTokenAutoRefreshEnabled=t,j(C,a))},isDisabled:!t,isChecked:t&&e.isTokenAutoRefreshEnabled});if(t)return a;const n=e?it(e):null;let r;return n?n.refresh_token?n.accessTokenUrl||(r="Access token URL is not present. Generate a new token to refresh it automatically on expire."):r="Refresh token is not present. Generate a new token to refresh it automatically on expire.":r="Select a token from available tokens to refresh it automatically on expire.",(0,m.jsx)(ve.Z,{content:r,children:a})})()]}),(0,m.jsx)(p.ZP,{type:"para",hasBottomSpacing:!0,color:"content-color-secondary",children:"Your expired token will be auto-refreshed before sending a request."})]}),(0,m.jsx)(ea,{}),(0,m.jsx)(ta,{type:"h4",text:"Configure New Token"}),jt(),(0,m.jsx)(Lt,{onToggleAdvancedFields:()=>{f(!v)},isOpen:v}),v&&Kt(),(0,m.jsx)(Tt,{children:(0,m.jsx)(fe.Z,{onClick:()=>{const e={};for(const t of a.oauth2)e[t.key]=ge()(t.value);e.redirect_uri=ye.Z.OAUTH2_CALLBACK_URL,c(!0),yt.startAuthorization(e,Z,w||[]).catch((()=>{c(!1),S({status:"error",description:"Authentication failed"})})),Ct.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token",label:"oauth2"})},type:"primary",text:"Generate Access Token",isLoading:u})})]})},ia=(0,l.observer)((()=>(0,m.jsx)(ke.VW,{children:(0,m.jsx)(oa,{})})));var la=a(49437),ua=a(80047);let ca;const ha=o()(u.Z)(ca||(ca=(e=>e)`
  overflow: hidden;
`));function da({description:e}){return(0,m.jsx)(ha,{direction:"column",height:"100%",justifyContent:"center",alignItems:"center",children:(0,m.jsx)(la.Z,{title:"Coming Soon",description:e,children:(0,m.jsx)(ua.Z,{name:"illustration-no-custom-domain"})})})}let pa;const ka=o()(u.Z)(pa||(pa=(e=>e)`
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;
`)),ma=()=>{const e=r().useContext(_a).authDescriptions;return(0,m.jsx)(ka,{children:(null==e?void 0:e.inherit)||"This request is inheriting auth from parent"})};let va;const fa=o().div(va||(va=(e=>e)`
  flex: 0.65;
  padding: var(--spacing-m);
  overflow: auto;
  box-sizing: border-box;
`)),ya=(0,l.observer)((()=>{var e;const t=r().useContext(_a),a=t.authState,n=U();if(n)return(0,m.jsx)(da,{description:`Support for ${(null==n?void 0:n.label)||"this auth method"} is coming soon.`});switch(a.activeAuthType){case"noauth":return null==(e=t.authDescriptions)?void 0:e.noauth;case"bearer":return(0,m.jsx)(Y,{});case"basic":return(0,m.jsx)(se,{});case"apikey":return(0,m.jsx)(de,{});case"inherit":return(0,m.jsx)(ma,{});case"oauth2":return(0,m.jsx)(ia,{});default:return(0,m.jsx)(H,{})}})),ba=()=>(0,m.jsx)(fa,{children:(0,m.jsx)(ya,{})});let ga;const xa=o().div(ga||(ga=(e=>e)`
  display: flex;
  min-height: 0;
  flex: 1;
  font-size: var(--text-size-m);
  color: var(--content-color-secondary);
  border-top: var(--border-width-default) var(--border-style-solid)
    var(--border-color-default);
`)),_a=r().createContext({}),Ta=e=>(0,m.jsx)(_a.Provider,{value:e,children:(0,m.jsxs)(xa,{className:"auth-editor",role:"tabpanel",children:[(0,m.jsx)(L,{}),(0,m.jsx)(ba,{})]})}),Aa=({model:e,modelId:t})=>e&&t?[e,t].join("/"):"",ja=e=>{const t=String(e).split("/");if(2!==t.length)return"";const[a,n]=t;return a&&n?{model:a,modelId:n}:""},wa=new Le.KVStorage("auth-session"),Ra=e=>wa.get(e),Sa=e=>{const t=Aa(e);return Ra(t)},Ca=e=>{const t=Aa(e);return wa.has(t)},Pa=(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;return wa.set(e,a)},qa=(e,t)=>{const a=Aa(e);return Pa(a,t)},Ua=e=>{const t=Aa(e);return wa.remove(t)},Oa=(e,t)=>{const a=Aa(e);return wa.subscribe(a,t)},Ia=()=>wa,Za=async e=>{var t;const a=await He(e);if(a)return[{key:"accessToken",value:(null==(t=a.data)?void 0:t.token_key)===ze?null==a?void 0:a.data[ze]:null==a?void 0:a.data[Fe]},{key:"tokenType",value:null==a?void 0:a.data.tokenType}]},Ea=async e=>{var t;const a=Aa(e),n=await Ra(a);if(!n)return;const r=null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value;return{type:"oauth2",oauth2:await Za(r)||[]}},za=async e=>{var t;const a=Aa(e),n=await Ra(a);if(n)return null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value},Fa=async e=>({type:"oauth2",oauth2:await Za(e)||[]}),Va={id:"",type:"oauth2",oauth2:[]},Na=e=>(0,Le.useKVStorage)(Ia(),Aa(e)),Ba=({model:e,modelId:t})=>{const a=e&&t?Aa({model:e,modelId:t}):"";return(0,Le.useKVStorage)(Ia(),a)}},38087:()=>{},74854:()=>{},66602:()=>{}}]);
//# sourceMappingURL=5706.f4927ec2a2b45465.js.map