(self.webpackChunkoauth2_manage_tokens=self.webpackChunkoauth2_manage_tokens||[]).push([[5706],{84492:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var n=a(7560),s=a(69730),r=a.n(s);const o=(0,n.Z)({},r(),{DISABLE_ANALYTICS:!1,ANALYTICS_URL:"https://events.getpostman.com/events",IDENTITY_URL:"https://identity.getpostman.com",ARTEMIS_URL:"https://go.postman.co",HTTPS_GATEWAY_PRIVATE_URL:"https://bifrost-extension-https-global.gw.postman.com",WEBSOCKET_GATEWAY_URL:"wss://bifrost-extension-global.gw.postman.com",WEB_URL:"https://www.getpostman.com",DASHBOARD_URL:"https://go.postman.co",EXPLORE_URL:"https://www.postman.com",SENTRY_DSN:"https://0fd0f21b182549f18b0e01ce62f8adb0@o1224273.ingest.sentry.io/4505072910139392",OAUTH2_CALLBACK_URL:"https://oauth.pstmn.io/v1/vscode-callback"})},6282:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ACCESS_TOKENS_KEY:()=>we,AUTH_OPTIONS:()=>b,AuthPanel:()=>Nt,OAuth2TokenFetcher:()=>Qe,composeAuthSessionId:()=>Ft,decomposeAuthSessionId:()=>Vt,defaultAuthSession:()=>ea,getAllOAuth2AccessTokens:()=>Ce,getAuthSession:()=>Dt,getAuthSessionById:()=>Bt,getOAuth2AccessToken:()=>je,getStorage:()=>Mt,getTokenIdForAuthSession:()=>Qt,getTokenStorage:()=>qe,getTokenValuesForAuthSession:()=>Jt,getTokenValuesForTokenId:()=>Xt,hasAuthSession:()=>Wt,isTokenAutoRefreshable:()=>We,isTokenExpired:()=>Be,removeOAuth2AccessToken:()=>Se,removeSession:()=>Ht,setAuthSession:()=>$t,setAuthSessionById:()=>Kt,setOAuth2AccessToken:()=>Re,subscribeToAuthSession:()=>Gt,subscribeToOAuth2AccessTokens:()=>Ie,supportedAuthOptions:()=>_,updateOAuth2Token:()=>Pe,useAuthSession:()=>ta,useAuthSessionSafe:()=>aa,useOAuth2Tokens:()=>Xe});var n=a(40540),s=a.n(n),r=a(25892),o=a.n(r),i=a(7560),l=a(50916),u=a(58560),c=a(37110),h=a(98529),d=a(64382),p=a(63622),m=a(79233),k=a(52322);const v=o()(h.Z).withConfig({displayName:"components__Input",componentId:"sc-upzjhw-0"})(["&:not(:focus){border-color:var(--border-color-default);background-color:var(--background-color-secondary);}"]),f=({name:e,label:t,onChange:a,value:n,type:s="text"})=>(0,m.usePostmanInputFeatureFlag)()?(0,k.jsx)(m.AuthInput,{onChange:t=>{a(t,e)},suggestions:[],value:n,placeholder:t,ariaLabel:t,dataTestId:`${e}-input`}):(0,k.jsx)(v,{onChange:t=>{a(t.target.value,e)},name:e,value:n,placeholder:t,type:s,"data-testid":`${e}-input`}),y=o()(d.Z).withConfig({displayName:"components__Select",componentId:"sc-upzjhw-1"})([".aether-dropdown__control:not(:focus){border-color:var(--border-color-default);background-color:var(--background-color-secondary);}.aether-dropdown__control .aether-dropdown__single-value{color:var(--content-color-secondary);font-weight:600;font-size:var(--text-size-s);}"]),g=o()(p.ZP).withConfig({displayName:"components__Label",componentId:"sc-upzjhw-2"})(["color:var(--content-color-primary);"]),b={apikey:"apikey",basic:"basic",bearer:"bearer",noauth:"noauth",inherit:"inherit"},_=[{label:"Inherit auth from parent",value:"inherit"},{label:"No Auth",value:"noauth"},{label:"API Key",value:"apikey"},{label:"Basic Auth",value:"basic"},{label:"Bearer Token",value:"bearer"},{label:"OAuth 2.0",value:"oauth2"}],x=[{label:"JWT Bearer",value:"jwt"},{label:"Digest Auth",value:"digest"},{label:"OAuth 1.0",value:"oauth1"},{label:"Hawk Authentication",value:"hawk"},{label:"AWS Signature",value:"awsv4"},{label:"NTLM Authentication [Beta]",value:"ntlm"},{label:"Akamai EdgeGrid",value:"edgegrid"}];var A=a(26081),T=a(71453);const w=o()(A.Link).withConfig({displayName:"authorization-desc-link__AuthorizationLink",componentId:"sc-1qw9ls9-0"})(["display:inline-flex;align-items:center;text-decoration:underline;color:var(--content-color-secondary);"]),j=()=>(0,k.jsxs)(w,{type:"link-default",to:"https://go.pstmn.io/docs-auth",target:"_blank",rel:"noopener noreferer",children:["authorization",(0,k.jsx)(T.Z,{})]}),C=()=>{const e=(0,n.useContext)(Zt).authState;return(0,n.useMemo)((()=>x.find((t=>t.value===e.activeAuthType))),[e])},R=()=>{const e=s().useContext(Zt).disabledAuthTypes;return _.filter((t=>!(null!=e&&e.includes(t.value))))},S=o().div.withConfig({displayName:"auth-type-selector__AuthTypeSection",componentId:"sc-hfgzzs-0"})(["flex:0.35;padding:var(--spacing-m);border-right:var(--border-width-default) var(--border-style-solid) var(--border-color-default);height:100%;box-sizing:border-box;"]),P=o()(u.Z).withConfig({displayName:"auth-type-selector__AuthTypeWrapper",componentId:"sc-hfgzzs-1"})(["align-items:center;padding:var(--spacing-s) var(--spacing-zero);flex-wrap:wrap;"]),I=o().div.withConfig({displayName:"auth-type-selector__AuthFlexContentWrapper",componentId:"sc-hfgzzs-2"})(["flex:1;"]),q=o().div.withConfig({displayName:"auth-type-selector__AutoAuthTypeDescription",componentId:"sc-hfgzzs-3"})(["padding:var(--spacing-s) var(--spacing-zero);"]),U=(0,l.observer)((()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,n=R(),r=C();return(0,k.jsxs)(S,{"data-testid":"auth-type-selector",children:[(0,k.jsxs)(P,{children:[(0,k.jsx)(I,{children:(0,k.jsx)(c.Z,{text:"Type",htmlFor:"auth-type-selector-dropdown"})}),(0,k.jsx)(I,{children:(0,k.jsx)(y,{onChange:({value:e})=>{a((0,i.Z)({},t,{activeAuthType:e}))},options:n,value:n.find((e=>e.value===t.activeAuthType)),id:"auth-type-selector-dropdown",isSearchable:!1,isClearable:!1,viaPortal:!0,placeholder:r?r.label:""})})]}),"noauth"!==t.activeAuthType&&(0,k.jsxs)(q,{children:["The authorization header will be automatically generated when you send the request. Learn more about"," ",(0,k.jsx)(j,{})]})]})})),O=o()(u.Z).withConfig({displayName:"default__DefaultAuthModeContainer",componentId:"sc-197g8ur-0"})(["width:100%;height:100%;align-items:center;justify-content:center;"]),E=()=>(0,k.jsx)(O,{children:"This request is not inheriting any authorization helper at the moment."}),z=o()(u.Z).withConfig({displayName:"bearer__BearerTokenAuthWrapper",componentId:"sc-3o7qx8-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),Z=o().div.withConfig({displayName:"bearer__BearerTokenAuthContentWrapper",componentId:"sc-3o7qx8-1"})(["flex:1;"]),N=(0,l.observer)((()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)((e=>{if(!e)return a((0,i.Z)({},t,{bearer:[]}));a((0,i.Z)({},t,{bearer:[{key:"token",value:e}]}))}),[t,a]),o=(0,n.useMemo)((()=>{var e;return(null==(e=t.bearer)||null==(e=e.find((e=>"token"===e.key)))?void 0:e.value)||""}),[t]);return(0,k.jsxs)(z,{"data-testid":"bearer-auth",children:[(0,k.jsx)(Z,{children:(0,k.jsx)(g,{children:"Token"})}),(0,k.jsx)(Z,{children:(0,k.jsx)(f,{name:"token",label:"token",value:o,onChange:r})})]})})),F=o()(u.Z).withConfig({displayName:"basic__BasicAuthWrapper",componentId:"sc-yqegjr-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),V=o().div.withConfig({displayName:"basic__BasicAuthContentWrapper",componentId:"sc-yqegjr-1"})(["flex:1;"]),L=[{key:"username",label:"Username",type:"text"},{key:"password",label:"Password",type:"password"}],B=(0,l.observer)((()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)(((e,n)=>{var s;if(!e)return a((0,i.Z)({},t,{basic:(null==(s=t.basic)?void 0:s.filter((e=>e.key!==n)))||null}));const r=[...t.basic||[]],o=r.findIndex((e=>e.key===n));if(-1===o)return a((0,i.Z)({},t,{basic:[...t.basic||[],{key:n,value:e}]}));r[o].value=e,a((0,i.Z)({},t,{basic:r}))}),[t,a]),o=e=>{var a;return(null==(a=t.basic)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,k.jsx)(k.Fragment,{children:L.map((({key:e,label:t,type:a})=>(0,k.jsxs)(F,{"data-testid":"basic-input",children:[(0,k.jsx)(V,{children:(0,k.jsx)(g,{children:t})}),(0,k.jsx)(V,{children:(0,k.jsx)(f,{name:e,label:t,value:o(e),onChange:r,type:a})})]},e)))})})),D=o()(u.Z).withConfig({displayName:"api-key__APIKeyAuthWrapper",componentId:"sc-8dfplk-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),W=o().div.withConfig({displayName:"api-key__APIKeyAuthContentWrapper",componentId:"sc-8dfplk-1"})(["flex:1;"]),K=[{key:"key",label:"Key"},{key:"value",label:"Value"},{key:"in",label:"Add To",type:"select",options:[{label:"Headers",value:""},{label:"Query Params",value:"query"}]}],$=(0,l.observer)((()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)(((e,n)=>{var s;if(!e)return a((0,i.Z)({},t,{apikey:(null==(s=t.apikey)?void 0:s.filter((e=>e.key!==n)))||null}));const r=[...t.apikey||[]],o=r.findIndex((e=>e.key===n));if(-1===o)return a((0,i.Z)({},t,{apikey:[...t.apikey||[],{key:n,value:e}]}));r[o].value=e,a((0,i.Z)({},t,{apikey:r}))}),[t,a]),o=(0,n.useCallback)((e=>{var n;return e.value?a((0,i.Z)({},t,{apikey:[...t.apikey||[],{key:"in",value:e.value}]})):a((0,i.Z)({},t,{apikey:(null==(n=t.apikey)?void 0:n.filter((e=>"in"!==e.key)))||null}))}),[t,a]),l=e=>{var a;return(null==(a=t.apikey)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,k.jsx)(k.Fragment,{children:K.map((({key:e,label:a,type:n,options:s})=>{return(0,k.jsxs)(D,{"data-testid":"apikey-input",children:[(0,k.jsx)(W,{children:(0,k.jsx)(g,{children:a})}),(0,k.jsx)(W,{children:"select"===n&&null!=s&&s.length?(0,k.jsx)(y,{isClearable:!1,options:s,value:(null==(i=t.apikey)?void 0:i.find((e=>"in"===e.key)))?{label:"Query Params",value:"query"}:{label:"Headers",value:""},onChange:o,name:e,"aria-label":"add auth to",viaPortal:!0}):(0,k.jsx)(f,{name:e,label:a,value:l(e),onChange:r})})]},e);var i}))})}));var H=a(74962),G=a(69568),M=a(1078),Y=a(81397),J=a(80605),Q=a(84492),X=a(32018),ee=a.n(X),te=a(48722),ae=a(9029),ne=a(54302),se=a(5634);const re="authorization_code",oe="authorization_code_with_pkce",ie="implicit",le={authorization_code:"Authorization Code",authorization_code_with_pkce:"Authorization Code (With PKCE)",implicit:"Implicit",password_credentials:"Password Credentials",client_credentials:"Client Credentials"},ue={S256:"SHA-256",plain:"Plain"},ce={header:"Send as Basic Auth header",body:"Send client credentials in body"},he="request_url",de="request_body",pe="request_header",me={[de]:"Request Body",[he]:"Request URL",[pe]:"Request Headers"},ke={grant_type:le,client_authentication:ce,challengeAlgorithm:ue},ve={header:"Request Headers",queryParams:"Request URL"},fe="id_token",ye="access_token",ge={[ye]:"Access token",[fe]:"ID token"},be={accessTokenUrl:"",refreshTokenUrl:"",refreshToken:"",client_authentication:"header",authUrl:"",clientId:"",clientSecret:"",grant_type:"authorization_code",password:"",redirect_uri:Q.Z.OAUTH2_CALLBACK_URL,scope:"",state:"",username:"",challengeAlgorithm:"S256",code_verifier:"",name:"Untitled Token",authRequestParams:[],tokenRequestParams:[],refreshRequestParams:[],addTokenTo:"header"},_e=[{key:"tokenName",label:"Token Name"},{key:"grant_type",label:"Grant Type",type:"select",options:Object.keys(le).map((e=>({label:le[e],value:e})))},{key:"redirect_uri",label:"Callback URL",disabled:!0},{key:"authUrl",label:"Auth URL"},{key:"accessTokenUrl",label:"Access Token URL"},{key:"clientId",label:"Client ID"},{key:"clientSecret",label:"Client Secret"},{key:"username",label:"Username"},{key:"password",label:"Password"},{key:"challengeAlgorithm",label:"Code Challenge Method",type:"select",options:Object.keys(ue).map((e=>({label:ue[e],value:e})))},{key:"code_verifier",label:"Code Verifier"},{key:"scope",label:"Scope"},{key:"state",label:"State"},{key:"client_authentication",label:"Client Authentication",type:"select",options:Object.keys(ce).map((e=>({label:ce[e],value:e})))}],xe={authorization_code:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","scope","state","client_authentication"]),authorization_code_with_pkce:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","challengeAlgorithm","code_verifier","scope","state","client_authentication"]),implicit:new Set(["tokenName","grant_type","redirect_uri","authUrl","clientId","scope","state","client_authentication"]),password_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","username","password","scope","client_authentication"]),client_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","scope","client_authentication"])};var Ae=a(50747);const Te=new Ae.KVStorage("oauth2-access-tokens"),we="access-tokens",je=async e=>{const t=await Te.get(we);return t?t[e]:null},Ce=async()=>await Te.get(we)||{},Re=async(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;let s=await Te.get(we);return s||(s={}),s[e]=a,Te.set(we,s)},Se=async e=>{let t=await Te.get(we);return t||(t={}),delete t[e],Te.set(we,t)},Pe=async(e,t)=>{const a=await Te.get(we);if(!a||a&&!a[e])return;const n=(0,i.Z)({},a[e].data,t.data),s=(0,i.Z)({},a[e],t);s.data=n,await Re(e,s)},Ie=e=>Te.subscribe(we,e),qe=()=>Te,Ue=(e,t)=>{const a=[];for(const n of e)if(n){const e={key:n.key,value:n.value,enabled:n.enabled,send_as:t};n.options&&(e.send_as=n.options.value),a.push(e)}return a};function Oe(e){const t=[];for(const a of e)if(a){const e={key:a.key,value:a.value,type:"text",enabled:a.enabled};a.send_as&&(e.options={value:a.send_as,label:me[a.send_as]}),t.push(e)}return t}function Ee(e,t){if(!e||!Array.isArray(e))return;const a=e.find((e=>(null==e?void 0:e.key)===t&&!0===(null==e?void 0:e.enabled)));return null==a?void 0:a.value}function ze(e,t){let a=t;for(const t of e)t.enabled&&(a=`${a}${a.includes("?")?"&":"?"}${t.key}=${t.value}`);return a}function Ze(e,t){for(const a of e)if(a.enabled)switch(a.send_as){case he:t.url=ze([a],t.url);break;case pe:if(!a.key)continue;t.headerData.push({key:a.key,value:a.value,enabled:!0,type:"text"});break;default:t.data.push({key:a.key,value:a.value,enabled:!0,type:"text"})}return t}var Ne=a(21219),Fe=a(24926);const Ve=e=>{var t;const a=null==e?void 0:e.timestamp,n=null==e||null==(t=e.data)?void 0:t.expires_in;if(a&&n)return Number(a)+1e3*Number(n)},Le=e=>e?{refresh_token:e.data.refresh_token||"",accessTokenUrl:e.data.accessTokenUrl||"",refreshTokenUrl:e.data.refreshTokenUrl||"",clientId:e.data.clientId||"",clientSecret:e.data.clientSecret||"",refreshRequestParams:e.data.refreshRequestParams||""}:null,Be=(e,t)=>{if(!e)return!1;t||(t=0);const a=Ve(e);return!!a&&a<Date.now()+1e3*t},De=e=>{if(!e)return!1;const t=Le(e);return(null==t?void 0:t.refresh_token)&&((null==t?void 0:t.refreshTokenUrl)||(null==t?void 0:t.accessTokenUrl))},We=e=>!!e&&Be(e,59)&&(null==e?void 0:e.isTokenAutoRefreshEnabled)&&De(e),Ke=e=>{let t=e.toString("base64");return t=t.split("=")[0],t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t},$e=e=>{for(const t of Object.keys(be))e[t]||(e[t]=ee()(be[t]));const{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:s,refreshTokenUrl:r,refresh_token:o,client_authentication:i,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:m,challengeAlgorithm:k,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:g}=e;return{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:s,refreshTokenUrl:r,refreshToken:o,client_authentication:i,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:m,challengeAlgorithm:k,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:g}},He=new Set(["iso-2022-cn","iso-2022-cn-ext"]),Ge="authorization_code",Me="authorization_code_with_pkce",Ye="implicit",Je="client_credentials",Qe=new class{constructor(){this.tokenGenerationCallback=null,this.tokenRefreshCallback=null,this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null,this.timeoutId=null,this.id=null,this.params=null,ne.VSCodeCommunicationsService.subscribe("OAUTH2_CALLBACK",(e=>{this.handleAuthCallback(e)})),ne.VSCodeCommunicationsService.subscribe("RESOLVED_VARIABLES",(e=>{var t;if(!e)return;const{id:a,resolvedObject:n}=e;a===this.id&&(null==(t=this.resolveVariablesPromiseResolve)||t.call(this,n))}))}async getResolvedParams(e,t,a){if(!t||0===t.length)return e;const n=function(){const e={};return e.promise=new Promise(((t,a)=>{e.resolve=t,e.reject=a})),e}();return this.resolveVariablesPromise=n.promise,this.resolveVariablesPromiseResolve=n.resolve,this.resolveVariablesPromiseReject=n.reject,(0,Ne.resolveVariablesInObject)(e,t,a),setTimeout((()=>{var e;null==(e=this.resolveVariablesPromiseReject)||e.call(this,new Error("Failed to resolve variables"))}),1e4),this.resolveVariablesPromise}handleRedirectToBrowser(e){if(!e.startsWith("https")&&!e.startsWith("http"))return this.finishAuthorizationFlow(new Error("Invalid protocol for auth URL. Only HTTP and HTTPS protocol are allowed."));(0,A.openExternalLink)(e)}async startAuthorization(e,t,a){var n;if(this.id)throw new Error("OAuth2 authorization already in progress");let s=e;if(this.id=(0,te.v4)(),a)try{s=await this.getResolvedParams(ee()(e),a,this.id)}finally{this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null}var r;if(this.params=$e(s),!this.params)return null==(r=this.finishAuthorizationFlow)?void 0:r.call(this,new Error("OAuth2 authorization params not provided"));switch(this.tokenGenerationCallback=t,this.timeoutId=setTimeout((()=>{this.finishAuthorizationFlow(new Error("OAuth2 authorization timed out"))}),3e4),this.params.grant_type){case Ge:case Me:return this.handleAuthorizationCodeType();case Ye:return this.handleImplicitType();case"password_credentials":return this.handlePasswordCredentialsType();case Je:return this.handleClientCredentialsType();default:return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("Could not complete OAuth 2.0 authorization, grant type is invalid"))}}async refreshTokenByTokenId(e,t){const a=await je(e),n=a&&Le(a);n&&this.refreshToken(n,t)}async refreshToken(e,t){if(this.id)throw new Error("OAuth2 authorization already in progress");this.params=$e(e);const a=(0,te.v4)();var n;if(this.id=a,this.tokenRefreshCallback=t,!this.params)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2 authorization params not provided"));this.timeoutId=setTimeout((()=>{this.finishRefreshFlow(new Error("OAuth2 authorization timed out"))}),3e4);const s=this.params.refreshTokenUrl||this.params.accessTokenUrl,r=Ee(this.params.refreshRequestParams,"grant_type"),o=Ee(this.params.refreshRequestParams,"refresh_token"),i=this.getOAuth2TokenRequest(s);!o&&i.data.push({key:"refresh_token",value:this.params.refreshToken,enabled:!0,type:"text"}),!r&&i.data.push({key:"grant_type",value:"refresh_token",enabled:!0,type:"text"}),this.addClientAuthentication(i,this.params);const l=Ze(this.params.refreshRequestParams,i);this.requestAccessToken(l,{refresh:!0})}handleClientCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),s=Ee(e.tokenRequestParams,"grant_type"),r=Ee(e.tokenRequestParams,"scope"),o=Ee(e.tokenRequestParams,"client_id"),i=Ee(e.tokenRequestParams,"client_secret");!s&&n.data.push({key:"grant_type",value:Je,type:"text",enabled:!0}),!r&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),(!o||!i)&&this.addClientAuthentication(n,e);const l=Ze(e.tokenRequestParams,n);this.requestAccessToken(l)}handlePasswordCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl||"string"!=typeof e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),s=Ee(e.tokenRequestParams,"grant_type"),r=Ee(e.tokenRequestParams,"username"),o=Ee(e.tokenRequestParams,"password"),i=Ee(e.tokenRequestParams,"scope"),l=Ee(e.tokenRequestParams,"client_id"),u=Ee(e.tokenRequestParams,"client_secret"),c=Ee(e.tokenRequestParams,"redirect_uri");(!l||!u)&&this.addClientAuthentication(n,e),!s&&n.data.push({key:"grant_type",value:"password",type:"text",enabled:!0}),!r&&n.data.push({key:"username",value:e.username,type:"text",enabled:!0}),!o&&n.data.push({key:"password",value:e.password,type:"text",enabled:!0}),!i&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),!c&&n.data.push({key:"redirect_uri",value:e.redirect_uri,type:"text",enabled:!0});const h=Ze(e.tokenRequestParams,n);this.requestAccessToken(h)}handleAuthorizationCodeType(){if(!this.params)return;let e=this.params.authUrl;if(!e)return this.finishAuthorizationFlow(new Error("Auth URL not found"));const t=Ee(this.params.authRequestParams,"response_type"),a=Ee(this.params.authRequestParams,"client_id"),n=Ee(this.params.authRequestParams,"state"),s=Ee(this.params.authRequestParams,"scope"),r=Ee(this.params.authRequestParams,"redirect_uri");if(e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("code")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!s&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!r&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),this.params.grant_type===Me){const t=Ee(this.params.authRequestParams,"code_challenge"),a=Ee(this.params.authRequestParams,"code_challenge_method");this.params.code_verifier=this.params.code_verifier||((e=32)=>{const t=se.O6(e);return Ke(t)})(),!t&&(e+=`&code_challenge=${encodeURIComponent(((e,t)=>{if(!e||"plain"===t)return e||"";const a=se.js("sha256").update(e).digest();return Ke(a)})(this.params.code_verifier,this.params.challengeAlgorithm))}`),!a&&(e+=`&code_challenge_method=${encodeURIComponent(this.params.challengeAlgorithm)}`)}e=ze(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleImplicitType(){if(!this.params)return;let e=this.params.authUrl;const t=Ee(this.params.authRequestParams,"response_type"),a=Ee(this.params.authRequestParams,"client_id"),n=Ee(this.params.authRequestParams,"state"),s=Ee(this.params.authRequestParams,"scope"),r=Ee(this.params.authRequestParams,"redirect_uri");e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("token")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!s&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!r&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),e=ze(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleAuthCallback(e){if(!this.params||!this.id)return;var t,a,n,s;if(this.params.grant_type===Ye)return e.access_token?null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,null,e):null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher~Implicit: access_token not found"));if(!e.code)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2TokenFetcher: code not found"));if(!this.params.accessTokenUrl)return null==(s=this.finishAuthorizationFlow)?void 0:s.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const r=Ee(this.params.tokenRequestParams,"grant_type"),o=Ee(this.params.tokenRequestParams,"client_id"),i=Ee(this.params.tokenRequestParams,"client_secret"),l=Ee(this.params.tokenRequestParams,"redirect_uri"),u=Ee(this.params.tokenRequestParams,"code_verifier"),c=Ee(this.params.tokenRequestParams,"code"),h=this.getOAuth2TokenRequest(this.params.accessTokenUrl);!r&&h.data.push({key:"grant_type",value:Ge,type:"text",enabled:!0}),!c&&h.data.push({key:"code",value:e.code,type:"text",enabled:!0}),!l&&h.data.push({key:"redirect_uri",value:this.params.redirect_uri,type:"text",enabled:!0}),this.params.grant_type===Me&&!u&&h.data.push({key:"code_verifier",value:this.params.code_verifier,type:"text",enabled:!0}),(!o||!i)&&this.addClientAuthentication(h,this.params);const d=Ze(this.params.tokenRequestParams,h);this.requestAccessToken(d)}addClientAuthentication(e,t){if("body"!==t.client_authentication)e.auth={type:"basic",basic:[{key:"username",value:t.clientId},{key:"password",value:t.clientSecret}]};else{if(e.data.push({key:"client_id",value:t.clientId,enabled:!0,type:"string"}),t.grant_type===Me&&!t.clientSecret)return;e.data.push({key:"client_secret",value:t.clientSecret,enabled:!0,type:"string"})}}getOAuth2TokenRequest(e){if(!this.params||!this.id)throw new Error("OAuth2TokenFetcher: params or id not found");return{id:this.id,method:"POST",dataMode:"urlencoded",url:e,headerData:[{key:"Content-Type",value:"application/x-www-form-urlencoded",type:"text",enabled:!0}],auth:{type:"noauth"},data:[]}}finishAuthorizationFlow(e,t){var a;if(!this.id||!this.params)throw new Error("OAuth2TokenFetcher: params or id not found");const n=this.params.tokenName||"Untitled Token",s=this.params.accessTokenUrl,r=this.params.refreshTokenUrl,o=this.params.clientId,l=this.params.clientSecret,u=this.params.refreshRequestParams;var c,h;if(this.id=null,this.params=null,this.timeoutId&&clearTimeout(this.timeoutId),e)return null==(c=this.tokenGenerationCallback)?void 0:c.call(this,e);if(!t)return null==(h=this.tokenGenerationCallback)?void 0:h.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));const d={name:n||"Untitled Token",id:(0,te.v4)(),timestamp:Date.now(),data:(0,i.Z)({},t,{accessTokenUrl:s,clientId:o,clientSecret:l,refreshRequestParams:u,refreshTokenUrl:r})};null==(a=this.tokenGenerationCallback)||a.call(this,null,d)}finishRefreshFlow(e,t){var a;if(this.id||this.params){var n,s;if(this.id=null,this.params=null,e)return null==(n=this.tokenRefreshCallback)?void 0:n.call(this,e);if(this.timeoutId&&clearTimeout(this.timeoutId),!t)return null==(s=this.tokenRefreshCallback)?void 0:s.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));null==(a=this.tokenRefreshCallback)||a.call(this,null,t)}}async requestAccessToken(e,t){var a=this;(0,ae.sendRequestViaAgent)(e,{variables:{},runOptionsOverrides:{timeout:{global:null,request:3e4,script:null}},exception:({error:e})=>null!=t&&t.refresh?this.finishRefreshFlow(e):this.finishAuthorizationFlow(e),response:async function({error:e,response:n}){if(e)return null!=t&&t.refresh?a.finishRefreshFlow(e):void a.finishAuthorizationFlow(e);if(!n||!n.stream)return null!=t&&t.refresh?a.finishRefreshFlow(new Error("OAuth2TokenFetcher: response not found")):a.finishAuthorizationFlow(new Error("OAuth2TokenFetcher: response not found"));n.stream instanceof ArrayBuffer&&(n.stream=new Uint8Array(n.stream));const s=(r=n.stream,o=n.contentInfo.charset,He.has(o)?"":("utf-16"===o&&r.length>=2&&254===r[0]&&255===r[1]&&(o="utf-16be"),new TextDecoder(o||"utf8").decode(r)));var r,o;return null!=t&&t.refresh?a.finishRefreshFlow(null,JSON.parse(s)):a.finishAuthorizationFlow(null,JSON.parse(s))},console:()=>null,start:()=>null,responseStart:()=>null,assertion:()=>null,script:()=>null})}},Xe=()=>{const{value:e,setValue:t}=(0,Ae.useKVStorage)(qe(),we),a=(a,n)=>{const s=null==e?void 0:e[a];if(s){for(const e of Object.keys(n.data))s.data[e]=n.data[e];return n.name&&(s.name=n.name),n.timestamp&&(s.timestamp=n.timestamp),e[a]=s,t(e)}};return{oAuth2Tokens:e,createOAuth2Token:(a,n)=>{const s=e||{};return s[a]=n,t(s)},updateOAuth2Token:a,updateKeyInOAuth2Token:(t,n,s)=>{const r=null==e?void 0:e[t];r&&(r.data[n]=s,a(t,r))},deleteOAuth2TokenById:a=>{if(null==e?void 0:e[a])return delete e[`${a}`],t(e)},deleteAllOAuth2Token:()=>t({}),deleteAllExpiredOAuth2Token:()=>{if(e){for(const[t,a]of Object.entries(e))Be(a)&&delete e[`${t}`];return t(e)}}}},et=o()(u.Z).withConfig({displayName:"oauth2-standard-wrappers__OAuth2AuthWrapper",componentId:"sc-gjg45q-0"})(["align-items:center;padding-top:var(--spacing-s);padding-bottom:var(--spacing-s);max-width:500px;"]),tt=o().div.withConfig({displayName:"oauth2-standard-wrappers__OAuth2AuthContentWrapper",componentId:"sc-gjg45q-1"})(["flex:1;"]),at=()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,n=(e,n)=>{if(!e)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const s=[...t.oauth2],r=s.findIndex((e=>e.key===n));if(-1===r)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));const o=[...s];return o[r]={key:s[r].key,value:e},a((0,i.Z)({},t,{oauth2:o}))},r=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||be[e]},o=(e,s,o,l,u)=>"redirect_uri"===e?(0,k.jsx)(v,{onChange:e=>{n(e.target.value,e.target.name)},name:e,value:r(e),placeholder:s,isDisabled:u}):"select"===o?l&&0!==(null==l?void 0:l.length)?(0,k.jsx)(y,{isClearable:!1,options:l,value:{value:r(e),label:ke[e][r(e)]},onChange:n=>{((e,n)=>{if(!n.value)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((t=>t.key!==e))}));const s=[...t.oauth2],r=s.findIndex((t=>t.key===e));if(-1===r)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:e,value:n.value}]}));const o=[...s];o[r]={key:s[r].key,value:n.value},a((0,i.Z)({},t,{oauth2:o}))})(e,n)},name:e,"aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1}):null:(0,k.jsx)(f,{onChange:(e,t)=>{n(e,t)},name:e,value:r(e),label:s});return(0,k.jsx)(k.Fragment,{children:_e.filter((({key:e})=>xe[r("grant_type")].has(e))).map((({key:e,label:t,type:a,options:n,disabled:s})=>(0,k.jsxs)(et,{"data-testid":`oauth2-input-${e}`,children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:t})}),(0,k.jsx)(tt,{children:o(e,t,a,n,s)})]},e)))})};var nt=a(35736),st=a(35482),rt=a(70068),ot=a(15837);const it=o().div.withConfig({displayName:"oauth2-refresh-cta__StyledRefreshCTAWrapper",componentId:"sc-1n3lw4y-0"})(["display:flex;margin-top:var(--spacing-xs);align-items:center;justify-content:left;"]),lt=o()(p.ZP).withConfig({displayName:"oauth2-refresh-cta__StyledExpiryInfoWrapper",componentId:"sc-1n3lw4y-1"})(["margin-left:var(--spacing-xs);margin-right:var(--spacing-xs);"]),ut=o()(nt.Z).withConfig({displayName:"oauth2-refresh-cta__StyledSpinner",componentId:"sc-1n3lw4y-2"})(["margin-left:var(--spacing-xs);"]),ct=()=>{var e,t;const a=s().useContext(Zt).authSessionState,[r,o]=(0,n.useState)(!1),{oAuth2Tokens:l,updateOAuth2Token:u}=Xe(),c=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,h=c?null==l?void 0:l[c]:null,d=(e,t)=>{if(e)return void o(!1);if(!t)return void o(!1);const a=h;a&&(a.data=(0,i.Z)({},a.data,t.access_token&&{access_token:t.access_token},t.id_token&&{id_token:t.id_token},t.refresh_token&&{refresh_token:t.refresh_token},t.expires_in&&{expires_in:t.expires_in},t.token_type&&{token_type:t.token_type}),a.timestamp=Date.now(),u(a.id,a),o(!1),ot.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh_successful",label:"oauth2"}))},m=()=>{if(!h)return;const e=Le(h);e?(o(!0),Qe.refreshToken(e,d),ot.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh",label:"oauth2"})):o(!1)};if(null==h||null==(t=h.data)||!t.refresh_token)return null;const v=Ve(h)||0,f=Date.now(),y=Le(h),g=De(h);if(!y||!g)return;if(r)return(0,k.jsxs)(it,{children:[(0,k.jsx)(p.ZP,{hasBottomSpacing:!0,color:"content-color-secondary",children:"Refreshing token"}),(0,k.jsx)(ut,{})]});if(!v)return(0,k.jsx)(it,{children:(0,k.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,k.jsx)("div",{onClick:m,children:"Refresh"})})});const b=Number(v),_=new Date(b).toDateString()===new Date(f).toDateString();let x=null;if(Be(h))x=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(st.Z,{name:"icon-state-error-stroke",color:"content-color-error"}),(0,k.jsx)(lt,{hasBottomSpacing:!0,color:"content-color-error",children:"Token expired."})]});else if(_){const e=(e=>`Expires at ${(0,Fe.format)(e,"h:mm aaaa")} today.`)(b);x=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(rt.Z,{color:"content-color-secondary"}),(0,k.jsx)(lt,{hasBottomSpacing:!0,color:"content-color-secondary",children:e})]})}return(0,k.jsxs)(it,{children:[x,(0,k.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,k.jsx)("div",{onClick:m,children:"Refresh"})})]})},ht=()=>{var e,t;const a=s().useContext(Zt).authSessionState,{oAuth2Tokens:n,updateKeyInOAuth2Token:r}=Xe(),o=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,i=o?null==n?void 0:n[o]:null,l=(null==i||null==(t=i.data)?void 0:t.token_key)||ye;if(null!=i&&i.data[fe])return(0,k.jsxs)(et,{"data-testid":"oauth2-input-token-key",children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Token Type"})}),(0,k.jsx)(tt,{children:(0,k.jsx)(y,{isClearable:!1,options:Object.keys(ge).map((e=>({value:e,label:ge[e],isOptionDisabled:e=>{var t;return null==i||null==(t=i.data)?void 0:t[null==e?void 0:e.value]}}))),placeholder:"Select Token Type",value:{value:l,label:ge[l]},onChange:e=>(e=>{i&&r(i.id,"token_key",e.value)})(e),name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"token_key")};var dt=a(56415),pt=a(3341);const mt=o().div.withConfig({displayName:"auth-advanced-toggle__StyledAdvancedToggleWrapper",componentId:"sc-1cboxp0-0"})(["display:flex;align-items:center;cursor:pointer;margin-bottom:var(--spacing-xs);margin-top:var(--spacing-xs);"]),kt=e=>{const{onToggleAdvancedFields:t,title:a,isOpen:n}=e;return(0,k.jsxs)(mt,{onClick:()=>t(),children:[n?(0,k.jsx)(dt.Z,{}):(0,k.jsx)(pt.Z,{}),(0,k.jsx)("div",{children:(0,k.jsx)(c.Z,{type:"primary",text:a||"Advanced configuration"})})]})};var vt=a(96497);const ft=()=>{const e=s().useContext(Zt),t=e.authState,a=e.setAuthState,n=(e,n)=>{const s=[...t.oauth2],r=s.findIndex((t=>t.key===e));return-1===r||(s[r].value=n,a((0,i.Z)({},t,{oauth2:s}))),a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:e,value:n}]}))},r=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||be[e]},o=r("authRequestParams"),l=r("tokenRequestParams"),c=r("refreshRequestParams"),h=Object.keys(me).map((e=>({value:e,label:me[e]}))),d=r("grant_type"),p=[re,oe,ie].includes(d),m=d!==ie;return(0,k.jsxs)(u.Z,{direction:"column",children:[(0,k.jsxs)(et,{"data-testid":"oauth2-input-refreshTokenUrl",children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Refresh Token URL"})}),(0,k.jsx)(tt,{children:(0,k.jsx)(f,{onChange:(e,n)=>{((e,n)=>{if(!e)return a((0,i.Z)({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const s=[...t.oauth2],r=s.findIndex((e=>e.key===n));if(-1===r)return a((0,i.Z)({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));s[r].value=e,a((0,i.Z)({},t,{oauth2:s}))})(e,n)},name:"refreshTokenUrl",value:r("refreshTokenUrl"),label:r("refreshTokenUrl")||"Enter Refresh Token URL"})})]},"refreshTokenUrl"),p&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(et,{"data-testid":"oauth2-input-authRequestParams",children:(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Auth Request"})})},"authRequestParams"),(0,k.jsx)(tt,{children:(0,k.jsx)(vt.KeyValueEditor,{tableName:"Auth Request",allowedColumns:["key","value"],showColumns:["key","value"],values:Oe(o),onChange:e=>{n("authRequestParams",Ue(e,he))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:[{label:"Text",value:"text"}]})})]}),m&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(et,{"data-testid":"oauth2-input-tokenRequestParams",children:(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Token Request"})})},"tokenRequestParams"),(0,k.jsx)(tt,{children:(0,k.jsx)(vt.KeyValueEditor,{tableName:"Token Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:Oe(l),onChange:e=>{n("tokenRequestParams",Ue(e,de))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:h})})]}),(0,k.jsx)(et,{"data-testid":"oauth2-input-refreshRequestParams",children:(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Refresh Request"})})},"refreshRequestParams"),(0,k.jsx)(tt,{children:(0,k.jsx)(vt.KeyValueEditor,{tableName:"Refresh Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:Oe(c),onChange:e=>{n("refreshRequestParams",Ue(e,de))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:h})})]})};var yt=a(19972);const gt=o().div.withConfig({displayName:"oauth2__StyledLine",componentId:"sc-r9ybfw-0"})(["border-bottom:1px solid var(--border-color-default);"]),bt=o()(H.Z).withConfig({displayName:"oauth2__StyledHeading",componentId:"sc-r9ybfw-1"})(["margin-top:var(--spacing-m);margin-bottom:var(--spacing-m);"]),_t=o()(u.Z).withConfig({displayName:"oauth2__StyledToken",componentId:"sc-r9ybfw-2"})(["padding-right:var(--spacing-l);flex:1;overflow:hidden;text-overflow:ellipsis;display:block;word-break:break-all;white-space:nowrap;"]),xt=o().div.withConfig({displayName:"oauth2__StyledManageTokenCTAWrapper",componentId:"sc-r9ybfw-3"})(["display:flex;margin-top:var(--spacing-xs);align-items:center;justify-content:left;"]),At=o().div.withConfig({displayName:"oauth2__StyledAutoRefreshTokenToggleWrapper",componentId:"sc-r9ybfw-4"})(["margin-top:var(--spacing-xxl);"]),Tt=o().div.withConfig({displayName:"oauth2__StyledAutoRefreshTokenToggle",componentId:"sc-r9ybfw-5"})(["margin-top:var(--spacing-l);margin-right:var(--spacing-l);display:flex;justify-content:space-between;"]),wt=()=>{var e;const t=s().useContext(Zt),a=t.authState,r=t.authSessionState,o=t.setAuthSessionState,l=t.setAuthState,[u,c]=(0,n.useState)(!1),h=(0,n.useRef)(null),[d,m]=(0,n.useState)(null),[b,_]=(0,n.useState)(!1),{oAuth2Tokens:x,createOAuth2Token:T,updateKeyInOAuth2Token:w,updateOAuth2Token:j}=Xe(),{data:C}=(0,Ne.useActiveVariables)(),{addToast:R}=(0,G.ZP)(),S=null==r||null==(e=r.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,P=S?null==x?void 0:x[S]:null,I=e=>{o("token_id",e)};(0,n.useEffect)((()=>{m(null)}),[x,r]);const q=(0,yt.useActiveWorkspaceId)(),U=(0,A.useNavigate)(),O=e=>{var t;return(null==(t=a.oauth2.find((t=>t.key===e)))?void 0:t.value)||be[e]},E=(e,t)=>t?t.data.error?(c(!1),void R({status:"error",description:"Authentication failed"})):(R({status:"success",description:"Authentication successful"}),T(t.id,t),(e=>{e&&I(e.id)})(t),c(!1),void ot.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token_successful",label:"oauth2"})):(c(!1),void R({status:"error",description:"Authentication failed"})),z=()=>P&&void 0!==P?{value:null==P?void 0:P.id,label:null==P?void 0:P.name}:null;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(et,{"data-testid":"oauth2-input-tokens",children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Token"})}),(0,k.jsxs)(tt,{children:[(0,k.jsx)(y,{isClearable:!1,options:(()=>{const e=Object.values(x||{}).map((e=>({value:e.id,label:e.name})));return 0===e.length?[]:e})(),placeholder:"Available Tokens",customOptionComponent:e=>{const{label:t}=e;return(0,k.jsxs)(_t,{children:[" ",t," "]})},value:z(),onChange:e=>{null!=e&&e.value&&I(e.value)},name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1},`${z()}`),(0,k.jsx)(xt,{children:(0,k.jsx)(p.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,k.jsx)("div",{onClick:()=>{U(`/workspace/${q}/openManageTokensTab`,{},{customNavEvent:A.OPEN_EXTENSION_URL})},children:"Manage Tokens"})})})]})]},"token"),ht(),(0,k.jsxs)(et,{"data-testid":"oauth2-input-token_value",children:[(0,k.jsx)(tt,{}),(0,k.jsxs)(tt,{children:[(0,k.jsx)(v,{onChange:e=>{const t=e.target.value;m(t),h.current&&clearTimeout(h.current);const a=setTimeout((()=>{(e=>{var t;let a=P;if(!a)return a={id:(0,te.v4)(),name:"Untitled Token",timestamp:Date.now(),data:{[ye]:e,token_type:"Bearer"}},T(a.id,a),I(a.id);const n=(null==P||null==(t=P.data)?void 0:t.token_key)===fe?fe:ye;w(a.id,n,e)})(t),h.current=null}),1e3);h.current=a},name:"access_token",value:(()=>{var e;const t=(null==P||null==(e=P.data)?void 0:e.token_key)===fe?P.data.id_token:null==P?void 0:P.data.access_token;return null!==d?d:t})(),placeholder:"Enter Token Here",isDisabled:!1}),ct()]})]},"token_value"),(0,k.jsxs)(et,{"data-testid":"oauth2-input-headerPrefix",children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Header Prefix"})}),(0,k.jsx)(tt,{children:(0,k.jsx)(f,{onChange:(e,t)=>{((e,t)=>{if(!e)return l((0,i.Z)({},a,{oauth2:a.oauth2.filter((e=>e.key!==t))}));const n=[...a.oauth2],s=n.findIndex((e=>e.key===t));if(-1===s)return l((0,i.Z)({},a,{oauth2:[...a.oauth2,{key:t,value:e}]}));n[s].value=e,l((0,i.Z)({},a,{oauth2:n}))})(e,t)},name:"headerPrefix",value:O("headerPrefix")||"Bearer",label:"Enter Prefix Here"})})]},"headerPrefix"),(0,k.jsxs)(et,{"data-testid":"oauth2-input-addTokenTo",children:[(0,k.jsx)(tt,{children:(0,k.jsx)(g,{children:"Add authorization data to"})}),(0,k.jsx)(tt,{children:(0,k.jsx)(y,{isClearable:!1,options:Object.keys(ve).map((e=>({value:e,label:ve[e]}))),value:{value:O("addTokenTo"),label:ve[O("addTokenTo")]},onChange:e=>{((e,t)=>{if(!t.value)return l((0,i.Z)({},a,{oauth2:a.oauth2.filter((t=>t.key!==e))}));const n=[...a.oauth2],s=n.findIndex((t=>t.key===e));if(-1===s)return l((0,i.Z)({},a,{oauth2:[...a.oauth2,{key:e,value:t.value}]}));n[s].value=t.value,l((0,i.Z)({},a,{oauth2:n}))})("addTokenTo",e)},name:"addTokenTo","aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"addTokenTo"),(0,k.jsxs)(At,{children:[(0,k.jsxs)(Tt,{children:[(0,k.jsx)(H.Z,{type:"h6",text:"Auto-refresh token",color:"content-color-secondary"}),(()=>{const e=S?null==x?void 0:x[S]:null,t=e&&De(e),a=(0,k.jsx)(M.Z,{name:"Refresh Token",onChange:t=>{const a=e;a&&(a.isTokenAutoRefreshEnabled=t,j(S,a))},isDisabled:!t,isChecked:t&&e.isTokenAutoRefreshEnabled});if(t)return a;const n=e?Le(e):null;let s;return n?n.refresh_token?n.accessTokenUrl||(s="Access token URL is not present. Generate a new token to refresh it automatically on expire."):s="Refresh token is not present. Generate a new token to refresh it automatically on expire.":s="Select a token from available tokens to refresh it automatically on expire.",(0,k.jsx)(Y.Z,{content:s,children:a})})()]}),(0,k.jsx)(p.ZP,{type:"para",hasBottomSpacing:!0,color:"content-color-secondary",children:"Your expired token will be auto-refreshed before sending a request."})]}),(0,k.jsx)(gt,{}),(0,k.jsx)(bt,{type:"h4",text:"Configure New Token"}),at(),(0,k.jsx)(kt,{onToggleAdvancedFields:()=>{_(!b)},isOpen:b}),b&&ft(),(0,k.jsx)(et,{children:(0,k.jsx)(J.Z,{onClick:()=>{const e={};for(const t of a.oauth2)e[t.key]=ee()(t.value);e.redirect_uri=Q.Z.OAUTH2_CALLBACK_URL,c(!0),Qe.startAuthorization(e,E,C||[]).catch((()=>{c(!1),R({status:"error",description:"Authentication failed"})})),ot.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token",label:"oauth2"})},type:"primary",text:"Generate Access Token",isLoading:u})})]})},jt=(0,l.observer)((()=>(0,k.jsx)(G.VW,{children:(0,k.jsx)(wt,{})})));var Ct=a(49437),Rt=a(80047);const St=o()(u.Z).withConfig({displayName:"coming-soon__ComingSoonWrapper",componentId:"sc-17z2lcs-0"})(["overflow:hidden;"]);function Pt({description:e}){return(0,k.jsx)(St,{direction:"column",height:"100%",justifyContent:"center",alignItems:"center",children:(0,k.jsx)(Ct.Z,{title:"Coming Soon",description:e,children:(0,k.jsx)(Rt.Z,{name:"illustration-no-custom-domain"})})})}const It=o()(u.Z).withConfig({displayName:"inherit__InheritAuthModeContainer",componentId:"sc-1x65xsl-0"})(["width:100%;height:100%;align-items:center;justify-content:center;"]),qt=()=>{const e=s().useContext(Zt).authDescriptions;return(0,k.jsx)(It,{children:(null==e?void 0:e.inherit)||"This request is inheriting auth from parent"})},Ut=o().div.withConfig({displayName:"auth-mode-specific-panel__AuthModeSpecificPanelWrapper",componentId:"sc-u1bwrm-0"})(["flex:0.65;padding:var(--spacing-m);overflow:auto;box-sizing:border-box;"]),Ot=(0,l.observer)((()=>{var e;const t=s().useContext(Zt),a=t.authState,n=C();if(n)return(0,k.jsx)(Pt,{description:`Support for ${(null==n?void 0:n.label)||"this auth method"} is coming soon.`});switch(a.activeAuthType){case"noauth":return null==(e=t.authDescriptions)?void 0:e.noauth;case"bearer":return(0,k.jsx)(N,{});case"basic":return(0,k.jsx)(B,{});case"apikey":return(0,k.jsx)($,{});case"inherit":return(0,k.jsx)(qt,{});case"oauth2":return(0,k.jsx)(jt,{});default:return(0,k.jsx)(E,{})}})),Et=()=>(0,k.jsx)(Ut,{children:(0,k.jsx)(Ot,{})}),zt=o().div.withConfig({displayName:"auth-panel__AuthPanelWrapper",componentId:"sc-1a0ra74-0"})(["display:flex;min-height:0;flex:1;font-size:var(--text-size-m);color:var(--content-color-secondary);border-top:var(--border-width-default) var(--border-style-solid) var(--border-color-default);"]),Zt=s().createContext({}),Nt=e=>(0,k.jsx)(Zt.Provider,{value:e,children:(0,k.jsxs)(zt,{className:"auth-editor",role:"tabpanel",children:[(0,k.jsx)(U,{}),(0,k.jsx)(Et,{})]})}),Ft=({model:e,modelId:t})=>e&&t?[e,t].join("/"):"",Vt=e=>{const t=String(e).split("/");if(2!==t.length)return"";const[a,n]=t;return a&&n?{model:a,modelId:n}:""},Lt=new Ae.KVStorage("auth-session"),Bt=e=>Lt.get(e),Dt=e=>{const t=Ft(e);return Bt(t)},Wt=e=>{const t=Ft(e);return Lt.has(t)},Kt=(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;return Lt.set(e,a)},$t=(e,t)=>{const a=Ft(e);return Kt(a,t)},Ht=e=>{const t=Ft(e);return Lt.remove(t)},Gt=(e,t)=>{const a=Ft(e);return Lt.subscribe(a,t)},Mt=()=>Lt,Yt=async e=>{var t;const a=await je(e);if(a)return[{key:"accessToken",value:(null==(t=a.data)?void 0:t.token_key)===fe?null==a?void 0:a.data[fe]:null==a?void 0:a.data[ye]},{key:"tokenType",value:null==a?void 0:a.data.tokenType}]},Jt=async e=>{var t;const a=Ft(e),n=await Bt(a);if(!n)return;const s=null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value;return{type:"oauth2",oauth2:await Yt(s)||[]}},Qt=async e=>{var t;const a=Ft(e),n=await Bt(a);if(n)return null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value},Xt=async e=>({type:"oauth2",oauth2:await Yt(e)||[]}),ea={id:"",type:"oauth2",oauth2:[]},ta=e=>(0,Ae.useKVStorage)(Mt(),Ft(e)),aa=({model:e,modelId:t})=>{const a=e&&t?Ft({model:e,modelId:t}):"";return(0,Ae.useKVStorage)(Mt(),a)}},69730:()=>{},38087:()=>{},74854:()=>{},66602:()=>{}}]);
//# sourceMappingURL=5706.3d66dc895bc8a3d3.js.map