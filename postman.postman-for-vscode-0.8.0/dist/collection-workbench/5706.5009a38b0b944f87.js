(self.webpackChunkcollection_workbench=self.webpackChunkcollection_workbench||[]).push([[5706],{6282:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ACCESS_TOKENS_KEY:()=>we,AUTH_OPTIONS:()=>g,AuthPanel:()=>Nt,OAuth2TokenFetcher:()=>Qe,composeAuthSessionId:()=>Ft,decomposeAuthSessionId:()=>Vt,defaultAuthSession:()=>Xt,getAllOAuth2AccessTokens:()=>je,getAuthSession:()=>Dt,getAuthSessionById:()=>Bt,getOAuth2AccessToken:()=>Te,getStorage:()=>Mt,getTokenIdForAuthSession:()=>Qt,getTokenStorage:()=>Oe,getTokenValuesForAuthSession:()=>Jt,getTokenValuesForTokenId:()=>Yt,hasAuthSession:()=>Lt,isTokenAutoRefreshable:()=>Le,isTokenExpired:()=>Be,removeOAuth2AccessToken:()=>Re,removeSession:()=>Kt,setAuthSession:()=>$t,setAuthSessionById:()=>Wt,setOAuth2AccessToken:()=>Ce,subscribeToAuthSession:()=>Ht,subscribeToOAuth2AccessTokens:()=>Pe,supportedAuthOptions:()=>b,updateOAuth2Token:()=>Se,useAuthSession:()=>ea,useAuthSessionSafe:()=>ta,useOAuth2Tokens:()=>Ye});var n=a(40540),s=a.n(n),r=a(25892),i=a.n(r),o=a(50916),l=a(58560),u=a(37110),c=a(34967),h=a(64382),d=a(63622),p=a(79233),m=a(52322);const k=i()(c.Z).withConfig({displayName:"components__Input",componentId:"sc-upzjhw-0"})(["&:not(:focus){border-color:var(--border-color-default);background-color:var(--background-color-secondary);}"]),v=({name:e,label:t,onChange:a,value:n,type:s="text"})=>(0,p.usePostmanInputFeatureFlag)()?(0,m.jsx)(p.AuthInput,{onChange:t=>{a(t,e)},suggestions:[],value:n,placeholder:t,ariaLabel:t,dataTestId:`${e}-input`}):(0,m.jsx)(k,{onChange:t=>{a(t.target.value,e)},name:e,value:n,placeholder:t,type:s,"data-testid":`${e}-input`}),f=i()(h.Z).withConfig({displayName:"components__Select",componentId:"sc-upzjhw-1"})([".aether-dropdown__control:not(:focus){border-color:var(--border-color-default);background-color:var(--background-color-secondary);}.aether-dropdown__control .aether-dropdown__single-value{color:var(--content-color-secondary);font-weight:600;font-size:var(--text-size-s);}"]),y=i()(d.ZP).withConfig({displayName:"components__Label",componentId:"sc-upzjhw-2"})(["color:var(--content-color-primary);"]),g={apikey:"apikey",basic:"basic",bearer:"bearer",noauth:"noauth",inherit:"inherit"},b=[{label:"Inherit auth from parent",value:"inherit"},{label:"No Auth",value:"noauth"},{label:"API Key",value:"apikey"},{label:"Basic Auth",value:"basic"},{label:"Bearer Token",value:"bearer"},{label:"OAuth 2.0",value:"oauth2"}],_=[{label:"JWT Bearer",value:"jwt"},{label:"Digest Auth",value:"digest"},{label:"OAuth 1.0",value:"oauth1"},{label:"Hawk Authentication",value:"hawk"},{label:"AWS Signature",value:"awsv4"},{label:"NTLM Authentication [Beta]",value:"ntlm"},{label:"Akamai EdgeGrid",value:"edgegrid"}];var x=a(26081),A=a(71453);const w=i()(x.Link).withConfig({displayName:"authorization-desc-link__AuthorizationLink",componentId:"sc-1qw9ls9-0"})(["display:inline-flex;align-items:center;text-decoration:underline;color:var(--content-color-secondary);"]),T=()=>(0,m.jsxs)(w,{type:"link-default",to:"https://go.pstmn.io/docs-auth",target:"_blank",rel:"noopener noreferer",children:["authorization",(0,m.jsx)(A.Z,{})]}),j=()=>{const e=(0,n.useContext)(Et).authState;return(0,n.useMemo)((()=>_.find((t=>t.value===e.activeAuthType))),[e])},C=()=>{const e=s().useContext(Et).disabledAuthTypes;return b.filter((t=>!(null!=e&&e.includes(t.value))))},R=i().div.withConfig({displayName:"auth-type-selector__AuthTypeSection",componentId:"sc-hfgzzs-0"})(["flex:0.35;padding:var(--spacing-m);border-right:var(--border-width-default) var(--border-style-solid) var(--border-color-default);height:100%;box-sizing:border-box;"]),S=i()(l.Z).withConfig({displayName:"auth-type-selector__AuthTypeWrapper",componentId:"sc-hfgzzs-1"})(["align-items:center;padding:var(--spacing-s) var(--spacing-zero);flex-wrap:wrap;"]),P=i().div.withConfig({displayName:"auth-type-selector__AuthFlexContentWrapper",componentId:"sc-hfgzzs-2"})(["flex:1;"]),O=i().div.withConfig({displayName:"auth-type-selector__AutoAuthTypeDescription",componentId:"sc-hfgzzs-3"})(["padding:var(--spacing-s) var(--spacing-zero);"]),I=(0,o.observer)((()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,n=C(),r=j();return(0,m.jsxs)(R,{"data-testid":"auth-type-selector",children:[(0,m.jsxs)(S,{children:[(0,m.jsx)(P,{children:(0,m.jsx)(u.Z,{text:"Type",htmlFor:"auth-type-selector-dropdown"})}),(0,m.jsx)(P,{children:(0,m.jsx)(f,{onChange:({value:e})=>{a(Object.assign({},t,{activeAuthType:e}))},options:n,value:n.find((e=>e.value===t.activeAuthType)),id:"auth-type-selector-dropdown",isSearchable:!1,isClearable:!1,viaPortal:!0,placeholder:r?r.label:""})})]}),"noauth"!==t.activeAuthType&&(0,m.jsxs)(O,{children:["The authorization header will be automatically generated when you send the request. Learn more about"," ",(0,m.jsx)(T,{})]})]})})),q=i()(l.Z).withConfig({displayName:"default__DefaultAuthModeContainer",componentId:"sc-197g8ur-0"})(["width:100%;height:100%;align-items:center;justify-content:center;"]),U=()=>(0,m.jsx)(q,{children:"This request is not inheriting any authorization helper at the moment."}),z=i()(l.Z).withConfig({displayName:"bearer__BearerTokenAuthWrapper",componentId:"sc-3o7qx8-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),E=i().div.withConfig({displayName:"bearer__BearerTokenAuthContentWrapper",componentId:"sc-3o7qx8-1"})(["flex:1;"]),N=(0,o.observer)((()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)((e=>{if(!e)return a(Object.assign({},t,{bearer:[]}));a(Object.assign({},t,{bearer:[{key:"token",value:e}]}))}),[t,a]),i=(0,n.useMemo)((()=>{var e;return(null==(e=t.bearer)||null==(e=e.find((e=>"token"===e.key)))?void 0:e.value)||""}),[t]);return(0,m.jsxs)(z,{"data-testid":"bearer-auth",children:[(0,m.jsx)(E,{children:(0,m.jsx)(y,{children:"Token"})}),(0,m.jsx)(E,{children:(0,m.jsx)(v,{name:"token",label:"token",value:i,onChange:r})})]})})),F=i()(l.Z).withConfig({displayName:"basic__BasicAuthWrapper",componentId:"sc-yqegjr-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),V=i().div.withConfig({displayName:"basic__BasicAuthContentWrapper",componentId:"sc-yqegjr-1"})(["flex:1;"]),Z=[{key:"username",label:"Username",type:"text"},{key:"password",label:"Password",type:"password"}],B=(0,o.observer)((()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)(((e,n)=>{var s;if(!e)return a(Object.assign({},t,{basic:(null==(s=t.basic)?void 0:s.filter((e=>e.key!==n)))||null}));const r=[...t.basic||[]],i=r.findIndex((e=>e.key===n));if(-1===i)return a(Object.assign({},t,{basic:[...t.basic||[],{key:n,value:e}]}));r[i].value=e,a(Object.assign({},t,{basic:r}))}),[t,a]),i=e=>{var a;return(null==(a=t.basic)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,m.jsx)(m.Fragment,{children:Z.map((({key:e,label:t,type:a})=>(0,m.jsxs)(F,{"data-testid":"basic-input",children:[(0,m.jsx)(V,{children:(0,m.jsx)(y,{children:t})}),(0,m.jsx)(V,{children:(0,m.jsx)(v,{name:e,label:t,value:i(e),onChange:r,type:a})})]},e)))})})),D=i()(l.Z).withConfig({displayName:"api-key__APIKeyAuthWrapper",componentId:"sc-8dfplk-0"})(["align-items:center;padding-top:var(--spacing-s);max-width:500px;"]),L=i().div.withConfig({displayName:"api-key__APIKeyAuthContentWrapper",componentId:"sc-8dfplk-1"})(["flex:1;"]),W=[{key:"key",label:"Key"},{key:"value",label:"Value"},{key:"in",label:"Add To",type:"select",options:[{label:"Headers",value:""},{label:"Query Params",value:"query"}]}],$=(0,o.observer)((()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,r=(0,n.useCallback)(((e,n)=>{var s;if(!e)return a(Object.assign({},t,{apikey:(null==(s=t.apikey)?void 0:s.filter((e=>e.key!==n)))||null}));const r=[...t.apikey||[]],i=r.findIndex((e=>e.key===n));if(-1===i)return a(Object.assign({},t,{apikey:[...t.apikey||[],{key:n,value:e}]}));r[i].value=e,a(Object.assign({},t,{apikey:r}))}),[t,a]),i=(0,n.useCallback)((e=>{var n;return e.value?a(Object.assign({},t,{apikey:[...t.apikey||[],{key:"in",value:e.value}]})):a(Object.assign({},t,{apikey:(null==(n=t.apikey)?void 0:n.filter((e=>"in"!==e.key)))||null}))}),[t,a]),o=e=>{var a;return(null==(a=t.apikey)||null==(a=a.find((t=>t.key===e)))?void 0:a.value)||""};return(0,m.jsx)(m.Fragment,{children:W.map((({key:e,label:a,type:n,options:s})=>{return(0,m.jsxs)(D,{"data-testid":"apikey-input",children:[(0,m.jsx)(L,{children:(0,m.jsx)(y,{children:a})}),(0,m.jsx)(L,{children:"select"===n&&null!=s&&s.length?(0,m.jsx)(f,{isClearable:!1,options:s,value:(null==(l=t.apikey)?void 0:l.find((e=>"in"===e.key)))?{label:"Query Params",value:"query"}:{label:"Headers",value:""},onChange:i,name:e,"aria-label":"add auth to",viaPortal:!0}):(0,m.jsx)(v,{name:e,label:a,value:o(e),onChange:r})})]},e);var l}))})}));var K=a(74962),H=a(36306),M=a(1078),G=a(81397),J=a(80429),Q=a(84492),Y=a(32018),X=a.n(Y),ee=a(48722),te=a(9029),ae=a(54302),ne=a(5634);const se="authorization_code",re="authorization_code_with_pkce",ie="implicit",oe={authorization_code:"Authorization Code",authorization_code_with_pkce:"Authorization Code (With PKCE)",implicit:"Implicit",password_credentials:"Password Credentials",client_credentials:"Client Credentials"},le={S256:"SHA-256",plain:"Plain"},ue={header:"Send as Basic Auth header",body:"Send client credentials in body"},ce="request_url",he="request_body",de="request_header",pe={[he]:"Request Body",[ce]:"Request URL",[de]:"Request Headers"},me={grant_type:oe,client_authentication:ue,challengeAlgorithm:le},ke={header:"Request Headers",queryParams:"Request URL"},ve="id_token",fe="access_token",ye={[fe]:"Access token",[ve]:"ID token"},ge={accessTokenUrl:"",refreshTokenUrl:"",refreshToken:"",client_authentication:"header",authUrl:"",clientId:"",clientSecret:"",grant_type:"authorization_code",password:"",redirect_uri:Q.Z.OAUTH2_CALLBACK_URL,scope:"",state:"",username:"",challengeAlgorithm:"S256",code_verifier:"",name:"Untitled Token",authRequestParams:[],tokenRequestParams:[],refreshRequestParams:[],addTokenTo:"header"},be=[{key:"tokenName",label:"Token Name"},{key:"grant_type",label:"Grant Type",type:"select",options:Object.keys(oe).map((e=>({label:oe[e],value:e})))},{key:"redirect_uri",label:"Callback URL",disabled:!0},{key:"authUrl",label:"Auth URL"},{key:"accessTokenUrl",label:"Access Token URL"},{key:"clientId",label:"Client ID"},{key:"clientSecret",label:"Client Secret"},{key:"username",label:"Username"},{key:"password",label:"Password"},{key:"challengeAlgorithm",label:"Code Challenge Method",type:"select",options:Object.keys(le).map((e=>({label:le[e],value:e})))},{key:"code_verifier",label:"Code Verifier"},{key:"scope",label:"Scope"},{key:"state",label:"State"},{key:"client_authentication",label:"Client Authentication",type:"select",options:Object.keys(ue).map((e=>({label:ue[e],value:e})))}],_e={authorization_code:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","scope","state","client_authentication"]),authorization_code_with_pkce:new Set(["tokenName","grant_type","redirect_uri","authUrl","accessTokenUrl","clientId","clientSecret","challengeAlgorithm","code_verifier","scope","state","client_authentication"]),implicit:new Set(["tokenName","grant_type","redirect_uri","authUrl","clientId","scope","state","client_authentication"]),password_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","username","password","scope","client_authentication"]),client_credentials:new Set(["tokenName","grant_type","accessTokenUrl","clientId","clientSecret","scope","client_authentication"])};var xe=a(50747);const Ae=new xe.KVStorage("oauth2-access-tokens"),we="access-tokens",Te=async e=>{const t=await Ae.get(we);return t?t[e]:null},je=async()=>await Ae.get(we)||{},Ce=async(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;let s=await Ae.get(we);return s||(s={}),s[e]=a,Ae.set(we,s)},Re=async e=>{let t=await Ae.get(we);return t||(t={}),delete t[e],Ae.set(we,t)},Se=async(e,t)=>{const a=await Ae.get(we);if(!a||a&&!a[e])return;const n=Object.assign({},a[e].data,t.data),s=Object.assign({},a[e],t);s.data=n,await Ce(e,s)},Pe=e=>Ae.subscribe(we,e),Oe=()=>Ae,Ie=(e,t)=>{const a=[];for(const n of e)if(n){const e={key:n.key,value:n.value,enabled:n.enabled,send_as:t};n.options&&(e.send_as=n.options.value),a.push(e)}return a};function qe(e){const t=[];for(const a of e)if(a){const e={key:a.key,value:a.value,type:"text",enabled:a.enabled};a.send_as&&(e.options={value:a.send_as,label:pe[a.send_as]}),t.push(e)}return t}function Ue(e,t){if(!e||!Array.isArray(e))return;const a=e.find((e=>(null==e?void 0:e.key)===t&&!0===(null==e?void 0:e.enabled)));return null==a?void 0:a.value}function ze(e,t){let a=t;for(const t of e)t.enabled&&(a=`${a}${a.includes("?")?"&":"?"}${t.key}=${t.value}`);return a}function Ee(e,t){for(const a of e)if(a.enabled)switch(a.send_as){case ce:t.url=ze([a],t.url);break;case de:if(!a.key)continue;t.headerData.push({key:a.key,value:a.value,enabled:!0,type:"text"});break;default:t.data.push({key:a.key,value:a.value,enabled:!0,type:"text"})}return t}var Ne=a(21219),Fe=a(24926);const Ve=e=>{var t;const a=null==e?void 0:e.timestamp,n=null==e||null==(t=e.data)?void 0:t.expires_in;if(a&&n)return Number(a)+1e3*Number(n)},Ze=e=>e?{refresh_token:e.data.refresh_token||"",accessTokenUrl:e.data.accessTokenUrl||"",refreshTokenUrl:e.data.refreshTokenUrl||"",clientId:e.data.clientId||"",clientSecret:e.data.clientSecret||"",refreshRequestParams:e.data.refreshRequestParams||""}:null,Be=(e,t)=>{if(!e)return!1;t||(t=0);const a=Ve(e);return!!a&&a<Date.now()+1e3*t},De=e=>{if(!e)return!1;const t=Ze(e);return(null==t?void 0:t.refresh_token)&&((null==t?void 0:t.refreshTokenUrl)||(null==t?void 0:t.accessTokenUrl))},Le=e=>!!e&&Be(e,59)&&(null==e?void 0:e.isTokenAutoRefreshEnabled)&&De(e),We=e=>{let t=e.toString("base64");return t=t.split("=")[0],t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t},$e=e=>{for(const t of Object.keys(ge))e[t]||(e[t]=X()(ge[t]));const{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:s,refreshTokenUrl:r,refresh_token:i,client_authentication:o,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:m,challengeAlgorithm:k,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:g}=e;return{tokenName:t,grant_type:a,authUrl:n,accessTokenUrl:s,refreshTokenUrl:r,refreshToken:i,client_authentication:o,clientId:l,clientSecret:u,redirect_uri:c,scope:h,state:d,username:p,password:m,challengeAlgorithm:k,code_verifier:v,authRequestParams:f,tokenRequestParams:y,refreshRequestParams:g}},Ke=new Set(["iso-2022-cn","iso-2022-cn-ext"]),He="authorization_code",Me="authorization_code_with_pkce",Ge="implicit",Je="client_credentials",Qe=new class{constructor(){this.tokenGenerationCallback=null,this.tokenRefreshCallback=null,this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null,this.timeoutId=null,this.id=null,this.params=null,ae.VSCodeCommunicationsService.subscribe("OAUTH2_CALLBACK",(e=>{this.handleAuthCallback(e)})),ae.VSCodeCommunicationsService.subscribe("RESOLVED_VARIABLES",(e=>{var t;if(!e)return;const{id:a,resolvedObject:n}=e;a===this.id&&(null==(t=this.resolveVariablesPromiseResolve)||t.call(this,n))}))}async getResolvedParams(e,t,a){if(!t||0===t.length)return e;const n=function(){const e={};return e.promise=new Promise(((t,a)=>{e.resolve=t,e.reject=a})),e}();return this.resolveVariablesPromise=n.promise,this.resolveVariablesPromiseResolve=n.resolve,this.resolveVariablesPromiseReject=n.reject,(0,Ne.resolveVariablesInObject)(e,t,a),setTimeout((()=>{var e;null==(e=this.resolveVariablesPromiseReject)||e.call(this,new Error("Failed to resolve variables"))}),1e4),this.resolveVariablesPromise}handleRedirectToBrowser(e){if(!e.startsWith("https")&&!e.startsWith("http"))return this.finishAuthorizationFlow(new Error("Invalid protocol for auth URL. Only HTTP and HTTPS protocol are allowed."));(0,x.openExternalLink)(e)}async startAuthorization(e,t,a){var n;if(this.id)throw new Error("OAuth2 authorization already in progress");let s=e;if(this.id=(0,ee.v4)(),a)try{s=await this.getResolvedParams(X()(e),a,this.id)}finally{this.resolveVariablesPromise=null,this.resolveVariablesPromiseResolve=null,this.resolveVariablesPromiseReject=null}var r;if(this.params=$e(s),!this.params)return null==(r=this.finishAuthorizationFlow)?void 0:r.call(this,new Error("OAuth2 authorization params not provided"));switch(this.tokenGenerationCallback=t,this.timeoutId=setTimeout((()=>{this.finishAuthorizationFlow(new Error("OAuth2 authorization timed out"))}),3e4),this.params.grant_type){case He:case Me:return this.handleAuthorizationCodeType();case Ge:return this.handleImplicitType();case"password_credentials":return this.handlePasswordCredentialsType();case Je:return this.handleClientCredentialsType();default:return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("Could not complete OAuth 2.0 authorization, grant type is invalid"))}}async refreshTokenByTokenId(e,t){const a=await Te(e),n=a&&Ze(a);n&&this.refreshToken(n,t)}async refreshToken(e,t){if(this.id)throw new Error("OAuth2 authorization already in progress");this.params=$e(e);const a=(0,ee.v4)();var n;if(this.id=a,this.tokenRefreshCallback=t,!this.params)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2 authorization params not provided"));this.timeoutId=setTimeout((()=>{this.finishRefreshFlow(new Error("OAuth2 authorization timed out"))}),3e4);const s=this.params.refreshTokenUrl||this.params.accessTokenUrl,r=Ue(this.params.refreshRequestParams,"grant_type"),i=Ue(this.params.refreshRequestParams,"refresh_token"),o=this.getOAuth2TokenRequest(s);!i&&o.data.push({key:"refresh_token",value:this.params.refreshToken,enabled:!0,type:"text"}),!r&&o.data.push({key:"grant_type",value:"refresh_token",enabled:!0,type:"text"}),this.addClientAuthentication(o,this.params);const l=Ee(this.params.refreshRequestParams,o);this.requestAccessToken(l,{refresh:!0})}handleClientCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),s=Ue(e.tokenRequestParams,"grant_type"),r=Ue(e.tokenRequestParams,"scope"),i=Ue(e.tokenRequestParams,"client_id"),o=Ue(e.tokenRequestParams,"client_secret");!s&&n.data.push({key:"grant_type",value:Je,type:"text",enabled:!0}),!r&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),(!i||!o)&&this.addClientAuthentication(n,e);const l=Ee(e.tokenRequestParams,n);this.requestAccessToken(l)}handlePasswordCredentialsType(){const{params:e}=this;var t,a;if(!e)return null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,new Error("OAuth2TokenFetcher: params not found"));if(!e.accessTokenUrl||"string"!=typeof e.accessTokenUrl)return null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const n=this.getOAuth2TokenRequest(e.accessTokenUrl),s=Ue(e.tokenRequestParams,"grant_type"),r=Ue(e.tokenRequestParams,"username"),i=Ue(e.tokenRequestParams,"password"),o=Ue(e.tokenRequestParams,"scope"),l=Ue(e.tokenRequestParams,"client_id"),u=Ue(e.tokenRequestParams,"client_secret"),c=Ue(e.tokenRequestParams,"redirect_uri");(!l||!u)&&this.addClientAuthentication(n,e),!s&&n.data.push({key:"grant_type",value:"password",type:"text",enabled:!0}),!r&&n.data.push({key:"username",value:e.username,type:"text",enabled:!0}),!i&&n.data.push({key:"password",value:e.password,type:"text",enabled:!0}),!o&&n.data.push({key:"scope",value:e.scope,type:"text",enabled:!0}),!c&&n.data.push({key:"redirect_uri",value:e.redirect_uri,type:"text",enabled:!0});const h=Ee(e.tokenRequestParams,n);this.requestAccessToken(h)}handleAuthorizationCodeType(){if(!this.params)return;let e=this.params.authUrl;if(!e)return this.finishAuthorizationFlow(new Error("Auth URL not found"));const t=Ue(this.params.authRequestParams,"response_type"),a=Ue(this.params.authRequestParams,"client_id"),n=Ue(this.params.authRequestParams,"state"),s=Ue(this.params.authRequestParams,"scope"),r=Ue(this.params.authRequestParams,"redirect_uri");if(e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("code")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!s&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!r&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),this.params.grant_type===Me){const t=Ue(this.params.authRequestParams,"code_challenge"),a=Ue(this.params.authRequestParams,"code_challenge_method");this.params.code_verifier=this.params.code_verifier||((e=32)=>{const t=ne.O6(e);return We(t)})(),!t&&(e+=`&code_challenge=${encodeURIComponent(((e,t)=>{if(!e||"plain"===t)return e||"";const a=ne.js("sha256").update(e).digest();return We(a)})(this.params.code_verifier,this.params.challengeAlgorithm))}`),!a&&(e+=`&code_challenge_method=${encodeURIComponent(this.params.challengeAlgorithm)}`)}e=ze(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleImplicitType(){if(!this.params)return;let e=this.params.authUrl;const t=Ue(this.params.authRequestParams,"response_type"),a=Ue(this.params.authRequestParams,"client_id"),n=Ue(this.params.authRequestParams,"state"),s=Ue(this.params.authRequestParams,"scope"),r=Ue(this.params.authRequestParams,"redirect_uri");e+=e.includes("?")?"&":"?",!t&&(e+=`response_type=${encodeURIComponent("token")}`),!a&&(e+=`&client_id=${encodeURIComponent(this.params.clientId)}`),!n&&this.params.state&&(e+=`&state=${encodeURIComponent(this.params.state)}`),!s&&this.params.scope&&(e+=`&scope=${encodeURIComponent(this.params.scope)}`),!r&&this.params.redirect_uri&&(e+=`&redirect_uri=${encodeURIComponent(this.params.redirect_uri)}`),e=ze(this.params.authRequestParams,e),this.handleRedirectToBrowser(e)}handleAuthCallback(e){if(!this.params||!this.id)return;var t,a,n,s;if(this.params.grant_type===Ge)return e.access_token?null==(t=this.finishAuthorizationFlow)?void 0:t.call(this,null,e):null==(a=this.finishAuthorizationFlow)?void 0:a.call(this,new Error("OAuth2TokenFetcher~Implicit: access_token not found"));if(!e.code)return null==(n=this.finishAuthorizationFlow)?void 0:n.call(this,new Error("OAuth2TokenFetcher: code not found"));if(!this.params.accessTokenUrl)return null==(s=this.finishAuthorizationFlow)?void 0:s.call(this,new Error("OAuth2TokenFetcher: tokenUrl not found"));const r=Ue(this.params.tokenRequestParams,"grant_type"),i=Ue(this.params.tokenRequestParams,"client_id"),o=Ue(this.params.tokenRequestParams,"client_secret"),l=Ue(this.params.tokenRequestParams,"redirect_uri"),u=Ue(this.params.tokenRequestParams,"code_verifier"),c=Ue(this.params.tokenRequestParams,"code"),h=this.getOAuth2TokenRequest(this.params.accessTokenUrl);!r&&h.data.push({key:"grant_type",value:He,type:"text",enabled:!0}),!c&&h.data.push({key:"code",value:e.code,type:"text",enabled:!0}),!l&&h.data.push({key:"redirect_uri",value:this.params.redirect_uri,type:"text",enabled:!0}),this.params.grant_type===Me&&!u&&h.data.push({key:"code_verifier",value:this.params.code_verifier,type:"text",enabled:!0}),(!i||!o)&&this.addClientAuthentication(h,this.params);const d=Ee(this.params.tokenRequestParams,h);this.requestAccessToken(d)}addClientAuthentication(e,t){if("body"!==t.client_authentication)e.auth={type:"basic",basic:[{key:"username",value:t.clientId},{key:"password",value:t.clientSecret}]};else{if(e.data.push({key:"client_id",value:t.clientId,enabled:!0,type:"string"}),t.grant_type===Me&&!t.clientSecret)return;e.data.push({key:"client_secret",value:t.clientSecret,enabled:!0,type:"string"})}}getOAuth2TokenRequest(e){if(!this.params||!this.id)throw new Error("OAuth2TokenFetcher: params or id not found");return{id:this.id,method:"POST",dataMode:"urlencoded",url:e,headerData:[{key:"Content-Type",value:"application/x-www-form-urlencoded",type:"text",enabled:!0}],auth:{type:"noauth"},data:[]}}finishAuthorizationFlow(e,t){var a;if(!this.id||!this.params)throw new Error("OAuth2TokenFetcher: params or id not found");const n=this.params.tokenName||"Untitled Token",s=this.params.accessTokenUrl,r=this.params.refreshTokenUrl,i=this.params.clientId,o=this.params.clientSecret,l=this.params.refreshRequestParams;var u,c;if(this.id=null,this.params=null,this.timeoutId&&clearTimeout(this.timeoutId),e)return null==(u=this.tokenGenerationCallback)?void 0:u.call(this,e);if(!t)return null==(c=this.tokenGenerationCallback)?void 0:c.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));const h={name:n||"Untitled Token",id:(0,ee.v4)(),timestamp:Date.now(),data:Object.assign({},t,{accessTokenUrl:s,clientId:i,clientSecret:o,refreshRequestParams:l,refreshTokenUrl:r})};null==(a=this.tokenGenerationCallback)||a.call(this,null,h)}finishRefreshFlow(e,t){var a;if(this.id||this.params){var n,s;if(this.id=null,this.params=null,e)return null==(n=this.tokenRefreshCallback)?void 0:n.call(this,e);if(this.timeoutId&&clearTimeout(this.timeoutId),!t)return null==(s=this.tokenRefreshCallback)?void 0:s.call(this,new Error("OAuth2TokenFetcher: authResponse not found"));null==(a=this.tokenRefreshCallback)||a.call(this,null,t)}}async requestAccessToken(e,t){var a=this;(0,te.sendRequestViaAgent)(e,{variables:{},runOptionsOverrides:{timeout:{global:null,request:3e4,script:null}},exception:({error:e})=>null!=t&&t.refresh?this.finishRefreshFlow(e):this.finishAuthorizationFlow(e),response:async function({error:e,response:n}){if(e)return null!=t&&t.refresh?a.finishRefreshFlow(e):void a.finishAuthorizationFlow(e);if(!n||!n.stream)return null!=t&&t.refresh?a.finishRefreshFlow(new Error("OAuth2TokenFetcher: response not found")):a.finishAuthorizationFlow(new Error("OAuth2TokenFetcher: response not found"));n.stream instanceof ArrayBuffer&&(n.stream=new Uint8Array(n.stream));const s=(r=n.stream,i=n.contentInfo.charset,Ke.has(i)?"":("utf-16"===i&&r.length>=2&&254===r[0]&&255===r[1]&&(i="utf-16be"),new TextDecoder(i||"utf8").decode(r)));var r,i;return null!=t&&t.refresh?a.finishRefreshFlow(null,JSON.parse(s)):a.finishAuthorizationFlow(null,JSON.parse(s))},console:()=>null,start:()=>null,responseStart:()=>null,assertion:()=>null,script:()=>null})}},Ye=()=>{const{value:e,setValue:t}=(0,xe.useKVStorage)(Oe(),we),a=(a,n)=>{const s=null==e?void 0:e[a];if(s){for(const e of Object.keys(n.data))s.data[e]=n.data[e];return n.name&&(s.name=n.name),n.timestamp&&(s.timestamp=n.timestamp),e[a]=s,t(e)}};return{oAuth2Tokens:e,createOAuth2Token:(a,n)=>{const s=e||{};return s[a]=n,t(s)},updateOAuth2Token:a,updateKeyInOAuth2Token:(t,n,s)=>{const r=null==e?void 0:e[t];r&&(r.data[n]=s,a(t,r))},deleteOAuth2TokenById:a=>{if(null==e?void 0:e[a])return delete e[`${a}`],t(e)},deleteAllOAuth2Token:()=>t({}),deleteAllExpiredOAuth2Token:()=>{if(e){for(const[t,a]of Object.entries(e))Be(a)&&delete e[`${t}`];return t(e)}}}},Xe=i()(l.Z).withConfig({displayName:"oauth2-standard-wrappers__OAuth2AuthWrapper",componentId:"sc-gjg45q-0"})(["align-items:center;padding-top:var(--spacing-s);padding-bottom:var(--spacing-s);max-width:500px;"]),et=i().div.withConfig({displayName:"oauth2-standard-wrappers__OAuth2AuthContentWrapper",componentId:"sc-gjg45q-1"})(["flex:1;"]),tt=()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,n=(e,n)=>{if(!e)return a(Object.assign({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const s=[...t.oauth2],r=s.findIndex((e=>e.key===n));if(-1===r)return a(Object.assign({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));const i=[...s];return i[r]={key:s[r].key,value:e},a(Object.assign({},t,{oauth2:i}))},r=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||ge[e]},i=(e,s,i,o,l)=>"redirect_uri"===e?(0,m.jsx)(k,{onChange:e=>{n(e.target.value,e.target.name)},name:e,value:r(e),placeholder:s,isDisabled:l}):"select"===i?o&&0!==(null==o?void 0:o.length)?(0,m.jsx)(f,{isClearable:!1,options:o,value:{value:r(e),label:me[e][r(e)]},onChange:n=>{((e,n)=>{if(!n.value)return a(Object.assign({},t,{oauth2:t.oauth2.filter((t=>t.key!==e))}));const s=[...t.oauth2],r=s.findIndex((t=>t.key===e));if(-1===r)return a(Object.assign({},t,{oauth2:[...t.oauth2,{key:e,value:n.value}]}));const i=[...s];i[r]={key:s[r].key,value:n.value},a(Object.assign({},t,{oauth2:i}))})(e,n)},name:e,"aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1}):null:(0,m.jsx)(v,{onChange:(e,t)=>{n(e,t)},name:e,value:r(e),label:s});return(0,m.jsx)(m.Fragment,{children:be.filter((({key:e})=>_e[r("grant_type")].has(e))).map((({key:e,label:t,type:a,options:n,disabled:s})=>(0,m.jsxs)(Xe,{"data-testid":`oauth2-input-${e}`,children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:t})}),(0,m.jsx)(et,{children:i(e,t,a,n,s)})]},e)))})};var at=a(35736),nt=a(35482),st=a(70068),rt=a(15837);const it=i().div.withConfig({displayName:"oauth2-refresh-cta__StyledRefreshCTAWrapper",componentId:"sc-1n3lw4y-0"})(["display:flex;margin-top:var(--spacing-xs);align-items:center;justify-content:left;"]),ot=i()(d.ZP).withConfig({displayName:"oauth2-refresh-cta__StyledExpiryInfoWrapper",componentId:"sc-1n3lw4y-1"})(["margin-left:var(--spacing-xs);margin-right:var(--spacing-xs);"]),lt=i()(at.Z).withConfig({displayName:"oauth2-refresh-cta__StyledSpinner",componentId:"sc-1n3lw4y-2"})(["margin-left:var(--spacing-xs);"]),ut=()=>{var e,t;const a=s().useContext(Et).authSessionState,[r,i]=(0,n.useState)(!1),{oAuth2Tokens:o,updateOAuth2Token:l}=Ye(),u=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,c=u?null==o?void 0:o[u]:null,h=(e,t)=>{if(e)return void i(!1);if(!t)return void i(!1);const a=c;a&&(a.data=Object.assign({},a.data,t.access_token&&{access_token:t.access_token},t.id_token&&{id_token:t.id_token},t.refresh_token&&{refresh_token:t.refresh_token},t.expires_in&&{expires_in:t.expires_in},t.token_type&&{token_type:t.token_type}),a.timestamp=Date.now(),l(a.id,a),i(!1),rt.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh_successful",label:"oauth2"}))},p=()=>{if(!c)return;const e=Ze(c);e?(i(!0),Qe.refreshToken(e,h),rt.AnalyticsService.addEventV2({category:"authorization",action:"manual_token_refresh",label:"oauth2"})):i(!1)};if(null==c||null==(t=c.data)||!t.refresh_token)return null;const k=Ve(c)||0,v=Date.now(),f=Ze(c),y=De(c);if(!f||!y)return;if(r)return(0,m.jsxs)(it,{children:[(0,m.jsx)(d.ZP,{hasBottomSpacing:!0,color:"content-color-secondary",children:"Refreshing token"}),(0,m.jsx)(lt,{})]});if(!k)return(0,m.jsx)(it,{children:(0,m.jsx)(d.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:p,children:"Refresh"})})});const g=Number(k),b=new Date(g).toDateString()===new Date(v).toDateString();let _=null;if(Be(c))_=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(nt.Z,{name:"icon-state-error-stroke",color:"content-color-error"}),(0,m.jsx)(ot,{hasBottomSpacing:!0,color:"content-color-error",children:"Token expired."})]});else if(b){const e=(e=>`Expires at ${(0,Fe.format)(e,"h:mm aaaa")} today.`)(g);_=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(st.Z,{color:"content-color-secondary"}),(0,m.jsx)(ot,{hasBottomSpacing:!0,color:"content-color-secondary",children:e})]})}return(0,m.jsxs)(it,{children:[_,(0,m.jsx)(d.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:p,children:"Refresh"})})]})},ct=()=>{var e,t;const a=s().useContext(Et).authSessionState,{oAuth2Tokens:n,updateKeyInOAuth2Token:r}=Ye(),i=null==(e=a.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,o=i?null==n?void 0:n[i]:null,l=(null==o||null==(t=o.data)?void 0:t.token_key)||fe;if(null!=o&&o.data[ve])return(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-token-key",children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Token Type"})}),(0,m.jsx)(et,{children:(0,m.jsx)(f,{isClearable:!1,options:Object.keys(ye).map((e=>({value:e,label:ye[e],isOptionDisabled:e=>{var t;return null==o||null==(t=o.data)?void 0:t[null==e?void 0:e.value]}}))),placeholder:"Select Token Type",value:{value:l,label:ye[l]},onChange:e=>(e=>{o&&r(o.id,"token_key",e.value)})(e),name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"token_key")};var ht=a(56415),dt=a(3341);const pt=i().div.withConfig({displayName:"auth-advanced-toggle__StyledAdvancedToggleWrapper",componentId:"sc-1cboxp0-0"})(["display:flex;align-items:center;cursor:pointer;margin-bottom:var(--spacing-xs);margin-top:var(--spacing-xs);"]),mt=e=>{const{onToggleAdvancedFields:t,title:a,isOpen:n}=e;return(0,m.jsxs)(pt,{onClick:()=>t(),children:[n?(0,m.jsx)(ht.Z,{}):(0,m.jsx)(dt.Z,{}),(0,m.jsx)("div",{children:(0,m.jsx)(u.Z,{type:"primary",text:a||"Advanced configuration"})})]})};var kt=a(96497);const vt=()=>{const e=s().useContext(Et),t=e.authState,a=e.setAuthState,n=(e,n)=>{const s=[...t.oauth2],r=s.findIndex((t=>t.key===e));return-1===r||(s[r].value=n,a(Object.assign({},t,{oauth2:s}))),a(Object.assign({},t,{oauth2:[...t.oauth2,{key:e,value:n}]}))},r=e=>{var a;return(null==(a=t.oauth2.find((t=>t.key===e)))?void 0:a.value)||ge[e]},i=r("authRequestParams"),o=r("tokenRequestParams"),u=r("refreshRequestParams"),c=Object.keys(pe).map((e=>({value:e,label:pe[e]}))),h=r("grant_type"),d=[se,re,ie].includes(h),p=h!==ie;return(0,m.jsxs)(l.Z,{direction:"column",children:[(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-refreshTokenUrl",children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Refresh Token URL"})}),(0,m.jsx)(et,{children:(0,m.jsx)(v,{onChange:(e,n)=>{((e,n)=>{if(!e)return a(Object.assign({},t,{oauth2:t.oauth2.filter((e=>e.key!==n))}));const s=[...t.oauth2],r=s.findIndex((e=>e.key===n));if(-1===r)return a(Object.assign({},t,{oauth2:[...t.oauth2,{key:n,value:e}]}));s[r].value=e,a(Object.assign({},t,{oauth2:s}))})(e,n)},name:"refreshTokenUrl",value:r("refreshTokenUrl"),label:r("refreshTokenUrl")||"Enter Refresh Token URL"})})]},"refreshTokenUrl"),d&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Xe,{"data-testid":"oauth2-input-authRequestParams",children:(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Auth Request"})})},"authRequestParams"),(0,m.jsx)(et,{children:(0,m.jsx)(kt.KeyValueEditor,{tableName:"Auth Request",allowedColumns:["key","value"],showColumns:["key","value"],values:qe(i),onChange:e=>{n("authRequestParams",Ie(e,ce))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:[{label:"Text",value:"text"}]})})]}),p&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Xe,{"data-testid":"oauth2-input-tokenRequestParams",children:(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Token Request"})})},"tokenRequestParams"),(0,m.jsx)(et,{children:(0,m.jsx)(kt.KeyValueEditor,{tableName:"Token Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:qe(o),onChange:e=>{n("tokenRequestParams",Ie(e,he))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:c})})]}),(0,m.jsx)(Xe,{"data-testid":"oauth2-input-refreshRequestParams",children:(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Refresh Request"})})},"refreshRequestParams"),(0,m.jsx)(et,{children:(0,m.jsx)(kt.KeyValueEditor,{tableName:"Refresh Request",allowedColumns:["key","value","options"],showColumns:["key","value","options"],values:qe(u),onChange:e=>{n("refreshRequestParams",Ie(e,he))},disableSorting:!0,nonEditableKeys:!1,nonEditableValues:!1,nonEditableToggles:!1,disableBulkEdit:!0,enableVariableSuggestions:!0,optionsDropdownValues:c})})]})};var ft=a(19972);const yt=i().div.withConfig({displayName:"oauth2__StyledLine",componentId:"sc-r9ybfw-0"})(["border-bottom:1px solid var(--border-color-default);"]),gt=i()(K.Z).withConfig({displayName:"oauth2__StyledHeading",componentId:"sc-r9ybfw-1"})(["margin-top:var(--spacing-m);margin-bottom:var(--spacing-m);"]),bt=i()(l.Z).withConfig({displayName:"oauth2__StyledToken",componentId:"sc-r9ybfw-2"})(["padding-right:var(--spacing-l);flex:1;overflow:hidden;text-overflow:ellipsis;display:block;word-break:break-all;white-space:nowrap;"]),_t=i().div.withConfig({displayName:"oauth2__StyledManageTokenCTAWrapper",componentId:"sc-r9ybfw-3"})(["display:flex;margin-top:var(--spacing-xs);align-items:center;justify-content:left;"]),xt=i().div.withConfig({displayName:"oauth2__StyledAutoRefreshTokenToggleWrapper",componentId:"sc-r9ybfw-4"})(["margin-top:var(--spacing-xxl);"]),At=i().div.withConfig({displayName:"oauth2__StyledAutoRefreshTokenToggle",componentId:"sc-r9ybfw-5"})(["margin-top:var(--spacing-l);margin-right:var(--spacing-l);display:flex;justify-content:space-between;"]),wt=()=>{var e;const t=s().useContext(Et),a=t.authState,r=t.authSessionState,i=t.setAuthSessionState,o=t.setAuthState,[l,u]=(0,n.useState)(!1),c=(0,n.useRef)(null),[h,p]=(0,n.useState)(null),[g,b]=(0,n.useState)(!1),{oAuth2Tokens:_,createOAuth2Token:A,updateKeyInOAuth2Token:w,updateOAuth2Token:T}=Ye(),{data:j}=(0,Ne.useActiveVariables)(),{addToast:C}=(0,H.ZP)(),R=null==r||null==(e=r.oauth2)||null==(e=e.find((e=>"token_id"===e.key)))?void 0:e.value,S=R?null==_?void 0:_[R]:null,P=e=>{i("token_id",e)};(0,n.useEffect)((()=>{p(null)}),[_,r]);const O=(0,ft.useActiveWorkspaceId)(),I=(0,x.useNavigate)(),q=e=>{var t;return(null==(t=a.oauth2.find((t=>t.key===e)))?void 0:t.value)||ge[e]},U=(e,t)=>t?t.data.error?(u(!1),void C({status:"error",description:"Authentication failed"})):(C({status:"success",description:"Authentication successful"}),A(t.id,t),(e=>{e&&P(e.id)})(t),u(!1),void rt.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token_successful",label:"oauth2"})):(u(!1),void C({status:"error",description:"Authentication failed"})),z=()=>S&&void 0!==S?{value:null==S?void 0:S.id,label:null==S?void 0:S.name}:null;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-tokens",children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Token"})}),(0,m.jsxs)(et,{children:[(0,m.jsx)(f,{isClearable:!1,options:(()=>{const e=Object.values(_||{}).map((e=>({value:e.id,label:e.name})));return 0===e.length?[]:e})(),placeholder:"Available Tokens",customOptionComponent:e=>{const{label:t}=e;return(0,m.jsxs)(bt,{children:[" ",t," "]})},value:z(),onChange:e=>{null!=e&&e.value&&P(e.value)},name:"token","aria-label":"Select token",viaPortal:!0,isDisabled:!1,isSearchable:!1},`${z()}`),(0,m.jsx)(_t,{children:(0,m.jsx)(d.ZP,{type:"link-default",hasBottomSpacing:!0,children:(0,m.jsx)("div",{onClick:()=>{I(`/workspace/${O}/openManageTokensTab`,{},{customNavEvent:x.OPEN_EXTENSION_URL})},children:"Manage Tokens"})})})]})]},"token"),ct(),(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-token_value",children:[(0,m.jsx)(et,{}),(0,m.jsxs)(et,{children:[(0,m.jsx)(k,{onChange:e=>{const t=e.target.value;p(t),c.current&&clearTimeout(c.current);const a=setTimeout((()=>{(e=>{var t;let a=S;if(!a)return a={id:(0,ee.v4)(),name:"Untitled Token",timestamp:Date.now(),data:{[fe]:e,token_type:"Bearer"}},A(a.id,a),P(a.id);const n=(null==S||null==(t=S.data)?void 0:t.token_key)===ve?ve:fe;w(a.id,n,e)})(t),c.current=null}),1e3);c.current=a},name:"access_token",value:(()=>{var e;const t=(null==S||null==(e=S.data)?void 0:e.token_key)===ve?S.data.id_token:null==S?void 0:S.data.access_token;return null!==h?h:t})(),placeholder:"Enter Token Here",isDisabled:!1}),ut()]})]},"token_value"),(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-headerPrefix",children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Header Prefix"})}),(0,m.jsx)(et,{children:(0,m.jsx)(v,{onChange:(e,t)=>{((e,t)=>{if(!e)return o(Object.assign({},a,{oauth2:a.oauth2.filter((e=>e.key!==t))}));const n=[...a.oauth2],s=n.findIndex((e=>e.key===t));if(-1===s)return o(Object.assign({},a,{oauth2:[...a.oauth2,{key:t,value:e}]}));n[s].value=e,o(Object.assign({},a,{oauth2:n}))})(e,t)},name:"headerPrefix",value:q("headerPrefix")||"Bearer",label:"Enter Prefix Here"})})]},"headerPrefix"),(0,m.jsxs)(Xe,{"data-testid":"oauth2-input-addTokenTo",children:[(0,m.jsx)(et,{children:(0,m.jsx)(y,{children:"Add authorization data to"})}),(0,m.jsx)(et,{children:(0,m.jsx)(f,{isClearable:!1,options:Object.keys(ke).map((e=>({value:e,label:ke[e]}))),value:{value:q("addTokenTo"),label:ke[q("addTokenTo")]},onChange:e=>{((e,t)=>{if(!t.value)return o(Object.assign({},a,{oauth2:a.oauth2.filter((t=>t.key!==e))}));const n=[...a.oauth2],s=n.findIndex((t=>t.key===e));if(-1===s)return o(Object.assign({},a,{oauth2:[...a.oauth2,{key:e,value:t.value}]}));n[s].value=t.value,o(Object.assign({},a,{oauth2:n}))})("addTokenTo",e)},name:"addTokenTo","aria-label":"add auth to",viaPortal:!0,isDisabled:!1,isSearchable:!1})})]},"addTokenTo"),(0,m.jsxs)(xt,{children:[(0,m.jsxs)(At,{children:[(0,m.jsx)(K.Z,{type:"h6",text:"Auto-refresh token",color:"content-color-secondary"}),(()=>{const e=R?null==_?void 0:_[R]:null,t=e&&De(e),a=(0,m.jsx)(M.Z,{name:"Refresh Token",onChange:t=>{const a=e;a&&(a.isTokenAutoRefreshEnabled=t,T(R,a))},isDisabled:!t,isChecked:t&&e.isTokenAutoRefreshEnabled});if(t)return a;const n=e?Ze(e):null;let s;return n?n.refresh_token?n.accessTokenUrl||(s="Access token URL is not present. Generate a new token to refresh it automatically on expire."):s="Refresh token is not present. Generate a new token to refresh it automatically on expire.":s="Select a token from available tokens to refresh it automatically on expire.",(0,m.jsx)(G.Z,{content:s,children:a})})()]}),(0,m.jsx)(d.ZP,{type:"para",hasBottomSpacing:!0,color:"content-color-secondary",children:"Your expired token will be auto-refreshed before sending a request."})]}),(0,m.jsx)(yt,{}),(0,m.jsx)(gt,{type:"h4",text:"Configure New Token"}),tt(),(0,m.jsx)(mt,{onToggleAdvancedFields:()=>{b(!g)},isOpen:g}),g&&vt(),(0,m.jsx)(Xe,{children:(0,m.jsx)(J.Z,{onClick:()=>{const e={};for(const t of a.oauth2)e[t.key]=X()(t.value);e.redirect_uri=Q.Z.OAUTH2_CALLBACK_URL,u(!0),Qe.startAuthorization(e,U,j||[]).catch((()=>{u(!1),C({status:"error",description:"Authentication failed"})})),rt.AnalyticsService.addEventV2({category:"authorization",action:"get_access_token",label:"oauth2"})},type:"primary",text:"Generate Access Token",isLoading:l})})]})},Tt=(0,o.observer)((()=>(0,m.jsx)(H.VW,{children:(0,m.jsx)(wt,{})})));var jt=a(49437),Ct=a(80047);const Rt=i()(l.Z).withConfig({displayName:"coming-soon__ComingSoonWrapper",componentId:"sc-17z2lcs-0"})(["overflow:hidden;"]);function St({description:e}){return(0,m.jsx)(Rt,{direction:"column",height:"100%",justifyContent:"center",alignItems:"center",children:(0,m.jsx)(jt.Z,{title:"Coming Soon",description:e,children:(0,m.jsx)(Ct.Z,{name:"illustration-no-custom-domain"})})})}const Pt=i()(l.Z).withConfig({displayName:"inherit__InheritAuthModeContainer",componentId:"sc-1x65xsl-0"})(["width:100%;height:100%;align-items:center;justify-content:center;"]),Ot=()=>{const e=s().useContext(Et).authDescriptions;return(0,m.jsx)(Pt,{children:(null==e?void 0:e.inherit)||"This request is inheriting auth from parent"})},It=i().div.withConfig({displayName:"auth-mode-specific-panel__AuthModeSpecificPanelWrapper",componentId:"sc-u1bwrm-0"})(["flex:0.65;padding:var(--spacing-m);overflow:auto;box-sizing:border-box;"]),qt=(0,o.observer)((()=>{var e;const t=s().useContext(Et),a=t.authState,n=j();if(n)return(0,m.jsx)(St,{description:`Support for ${(null==n?void 0:n.label)||"this auth method"} is coming soon.`});switch(a.activeAuthType){case"noauth":return null==(e=t.authDescriptions)?void 0:e.noauth;case"bearer":return(0,m.jsx)(N,{});case"basic":return(0,m.jsx)(B,{});case"apikey":return(0,m.jsx)($,{});case"inherit":return(0,m.jsx)(Ot,{});case"oauth2":return(0,m.jsx)(Tt,{});default:return(0,m.jsx)(U,{})}})),Ut=()=>(0,m.jsx)(It,{children:(0,m.jsx)(qt,{})}),zt=i().div.withConfig({displayName:"auth-panel__AuthPanelWrapper",componentId:"sc-1a0ra74-0"})(["display:flex;min-height:0;flex:1;font-size:var(--text-size-m);color:var(--content-color-secondary);border-top:var(--border-width-default) var(--border-style-solid) var(--border-color-default);"]),Et=s().createContext({}),Nt=e=>(0,m.jsx)(Et.Provider,{value:e,children:(0,m.jsxs)(zt,{className:"auth-editor",role:"tabpanel",children:[(0,m.jsx)(I,{}),(0,m.jsx)(Ut,{})]})}),Ft=({model:e,modelId:t})=>e&&t?[e,t].join("/"):"",Vt=e=>{const t=String(e).split("/");if(2!==t.length)return"";const[a,n]=t;return a&&n?{model:a,modelId:n}:""},Zt=new xe.KVStorage("auth-session"),Bt=e=>Zt.get(e),Dt=e=>{const t=Ft(e);return Bt(t)},Lt=e=>{const t=Ft(e);return Zt.has(t)},Wt=(e,t)=>{const a=(n=t,JSON.parse(JSON.stringify(n)));var n;return Zt.set(e,a)},$t=(e,t)=>{const a=Ft(e);return Wt(a,t)},Kt=e=>{const t=Ft(e);return Zt.remove(t)},Ht=(e,t)=>{const a=Ft(e);return Zt.subscribe(a,t)},Mt=()=>Zt,Gt=async e=>{var t;const a=await Te(e);if(a)return[{key:"accessToken",value:(null==(t=a.data)?void 0:t.token_key)===ve?null==a?void 0:a.data[ve]:null==a?void 0:a.data[fe]},{key:"tokenType",value:null==a?void 0:a.data.tokenType}]},Jt=async e=>{var t;const a=Ft(e),n=await Bt(a);if(!n)return;const s=null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value;return{type:"oauth2",oauth2:await Gt(s)||[]}},Qt=async e=>{var t;const a=Ft(e),n=await Bt(a);if(n)return null==(t=n.oauth2.find((e=>"token_id"===e.key)))?void 0:t.value},Yt=async e=>({type:"oauth2",oauth2:await Gt(e)||[]}),Xt={id:"",type:"oauth2",oauth2:[]},ea=e=>(0,xe.useKVStorage)(Mt(),Ft(e)),ta=({model:e,modelId:t})=>{const a=e&&t?Ft({model:e,modelId:t}):"";return(0,xe.useKVStorage)(Mt(),a)}},38087:()=>{},74854:()=>{},66602:()=>{}}]);
//# sourceMappingURL=5706.5009a38b0b944f87.js.map